
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int vec3_t ;
typedef int entity_t ;
typedef int bspShader_t ;
typedef int bspModel_t ;
typedef int FILE ;


 int ConvertModel (int *,int *,int,int ) ;
 int ConvertShader (int *,int *,int) ;
 int Error (char*,char*) ;
 int ExtractFileBase (char*,char*) ;
 int GetVectorForKey (int *,char*,int ) ;
 int StripExtension (char*) ;
 int Sys_Printf (char*,...) ;
 char* ValueForKey (int *,char*) ;
 int VectorClear (int ) ;
 int atoi (char const*) ;
 int * bspModels ;
 int * bspShaders ;
 int * entities ;
 int fclose (int *) ;
 int * fopen (char*,char*) ;
 int fprintf (int *,char*,...) ;
 int numBSPShaders ;
 int numEntities ;
 int strcat (char*,char*) ;
 int strcpy (char*,char*) ;

int ConvertBSPToASE( char *bspName ){
 int i, modelNum;
 FILE *f;
 bspShader_t *shader;
 bspModel_t *model;
 entity_t *e;
 vec3_t origin;
 const char *key;
 char name[ 1024 ], base[ 1024 ];



 Sys_Printf( "--- Convert BSP to ASE ---\n" );


 strcpy( name, bspName );
 StripExtension( name );
 strcat( name, ".ase" );
 Sys_Printf( "writing %s\n", name );

 ExtractFileBase( bspName, base );
 strcat( base, ".bsp" );


 f = fopen( name, "wb" );
 if ( f == ((void*)0) ) {
  Error( "Open failed on %s\n", name );
 }


 fprintf( f, "*3DSMAX_ASCIIEXPORT\t200\r\n" );
 fprintf( f, "*COMMENT\t\"Generated by Q3Map2 (ydnar) -convert -format ase\"\r\n" );
 fprintf( f, "*SCENE\t{\r\n" );
 fprintf( f, "\t*SCENE_FILENAME\t\"%s\"\r\n", base );
 fprintf( f, "\t*SCENE_FIRSTFRAME\t0\r\n" );
 fprintf( f, "\t*SCENE_LASTFRAME\t100\r\n" );
 fprintf( f, "\t*SCENE_FRAMESPEED\t30\r\n" );
 fprintf( f, "\t*SCENE_TICKSPERFRAME\t160\r\n" );
 fprintf( f, "\t*SCENE_BACKGROUND_STATIC\t0.0000\t0.0000\t0.0000\r\n" );
 fprintf( f, "\t*SCENE_AMBIENT_STATIC\t0.0000\t0.0000\t0.0000\r\n" );
 fprintf( f, "}\r\n" );


 fprintf( f, "*MATERIAL_LIST\t{\r\n" );
 fprintf( f, "\t*MATERIAL_COUNT\t%d\r\n", numBSPShaders );
 for ( i = 0; i < numBSPShaders; i++ )
 {
  shader = &bspShaders[ i ];
  ConvertShader( f, shader, i );
 }
 fprintf( f, "}\r\n" );


 for ( i = 0; i < numEntities; i++ )
 {

  e = &entities[ i ];
  if ( i == 0 ) {
   modelNum = 0;
  }
  else
  {
   key = ValueForKey( e, "model" );
   if ( key[ 0 ] != '*' ) {
    continue;
   }
   modelNum = atoi( key + 1 );
  }
  model = &bspModels[ modelNum ];


  key = ValueForKey( e, "origin" );
  if ( key[ 0 ] == '\0' ) {
   VectorClear( origin );
  }
  else{
   GetVectorForKey( e, "origin", origin );
  }


  ConvertModel( f, model, modelNum, origin );
 }


 fclose( f );


 return 0;
}
