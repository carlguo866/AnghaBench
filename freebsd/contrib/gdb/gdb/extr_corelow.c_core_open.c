
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_4__ TYPE_1__ ;


struct cleanup {int dummy; } ;
typedef int bfd ;
struct TYPE_4__ {int to_sections_end; int to_sections; } ;


 int O_BINARY ;
 int O_RDONLY ;
 int O_RDWR ;
 int RETURN_MASK_ALL ;
 int add_to_thread_list ;
 int bfd_check_format (int *,int ) ;
 int bfd_core ;
 char* bfd_core_file_failing_command (int *) ;
 int bfd_core_file_failing_signal (int *) ;
 char* bfd_errmsg (int ) ;
 int * bfd_fdopenr (char*,int ,int) ;
 int bfd_get_error () ;
 char* bfd_get_filename (int *) ;
 int bfd_get_section_by_name (int *,char*) ;
 int bfd_map_over_sections (int *,int ,int ) ;
 scalar_t__ build_section_table (int *,int *,int *) ;
 int catch_errors (int ,int*,char*,int ) ;
 char* concat (int ,char*,char*,int *) ;
 int * core_bfd ;
 int core_close_cleanup (char*) ;
 int core_gdbarch ;
 TYPE_1__ core_ops ;
 int core_vec ;
 int current_directory ;
 int deprecated_selected_frame ;
 int discard_cleanups (struct cleanup*) ;
 int error (char*,...) ;
 int exec_bfd ;
 int flush_cached_frames () ;
 int frame_relative_level (int ) ;
 int gdb_check_format (int *) ;
 int gdbarch_from_bfd (int *) ;
 int get_current_frame () ;
 int gnutarget ;
 int init_thread_list () ;
 struct cleanup* make_cleanup (int (*) (char*),char*) ;
 int make_cleanup_bfd_close (int *) ;
 int open (char*,int,int ) ;
 int perror_with_name (char*) ;
 int print_stack_frame (int ,int ,int) ;
 int printf_filtered (char*,...) ;
 int push_target (TYPE_1__*) ;
 int select_frame (int ) ;
 int set_gdbarch_from_file (int *) ;
 int sniff_core_bfd (int *) ;
 int solib_add_stub ;
 int target_fetch_registers (int) ;
 int target_longname ;
 int target_preopen (int) ;
 int target_signal_from_host (int) ;
 int target_signal_to_string (int ) ;
 char* tilde_expand (char*) ;
 int unpush_target (TYPE_1__*) ;
 int validate_files () ;
 int warning (char*,int ) ;
 scalar_t__ write_files ;
 int xfree (char*) ;

__attribute__((used)) static void
core_open (char *filename, int from_tty)
{
  const char *p;
  int siggy;
  struct cleanup *old_chain;
  char *temp;
  bfd *temp_bfd;
  int ontop;
  int scratch_chan;

  target_preopen (from_tty);
  if (!filename)
    {
      error (core_bfd ?
      "No core file specified.  (Use `detach' to stop debugging a core file.)"
      : "No core file specified.");
    }

  filename = tilde_expand (filename);
  if (filename[0] != '/')
    {
      temp = concat (current_directory, "/", filename, ((void*)0));
      xfree (filename);
      filename = temp;
    }

  old_chain = make_cleanup (xfree, filename);

  scratch_chan = open (filename, O_BINARY | ( write_files ? O_RDWR : O_RDONLY ), 0);
  if (scratch_chan < 0)
    perror_with_name (filename);

  temp_bfd = bfd_fdopenr (filename, gnutarget, scratch_chan);
  if (temp_bfd == ((void*)0))
    perror_with_name (filename);

  if (!bfd_check_format (temp_bfd, bfd_core) &&
      !gdb_check_format (temp_bfd))
    {




      make_cleanup_bfd_close (temp_bfd);
      error ("\"%s\" is not a core dump: %s",
      filename, bfd_errmsg (bfd_get_error ()));
    }



  discard_cleanups (old_chain);
  unpush_target (&core_ops);
  core_bfd = temp_bfd;
  old_chain = make_cleanup (core_close_cleanup, 0 );







  core_gdbarch = gdbarch_from_bfd (core_bfd);


  core_vec = sniff_core_bfd (core_bfd);

  validate_files ();


  if (build_section_table (core_bfd, &core_ops.to_sections,
      &core_ops.to_sections_end))
    error ("\"%s\": Can't find sections: %s",
    bfd_get_filename (core_bfd), bfd_errmsg (bfd_get_error ()));





  if (!exec_bfd)
    set_gdbarch_from_file (core_bfd);

  ontop = !push_target (&core_ops);
  discard_cleanups (old_chain);

  p = bfd_core_file_failing_command (core_bfd);
  if (p)
    printf_filtered ("Core was generated by `%s'.\n", p);

  siggy = bfd_core_file_failing_signal (core_bfd);
  if (siggy > 0)




    printf_filtered ("Program terminated with signal %d, %s.\n", siggy,
       target_signal_to_string (target_signal_from_host (siggy)));



  init_thread_list ();
  bfd_map_over_sections (core_bfd, add_to_thread_list,
    bfd_get_section_by_name (core_bfd, ".reg"));

  if (ontop)
    {

      target_fetch_registers (-1);
      flush_cached_frames ();
      select_frame (get_current_frame ());
      print_stack_frame (deprecated_selected_frame,
    frame_relative_level (deprecated_selected_frame), 1);
    }
  else
    {
      warning (
  "you won't be able to access this core file until you terminate\nyour %s; do ``info files''", target_longname);

    }
}
