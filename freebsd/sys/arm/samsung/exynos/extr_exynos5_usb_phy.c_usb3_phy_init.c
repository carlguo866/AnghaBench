
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct usb_phy_softc {int dummy; } ;


 int DELAY (int) ;
 int LINKSYSTEM_FLADJ (int) ;
 int LINKSYSTEM_XHCI_VERSION_CTRL ;
 int PHYCLKRST_COMMONONN ;
 int PHYCLKRST_FSEL (int ) ;
 int PHYCLKRST_FSEL_24MHZ ;
 int PHYCLKRST_MPLL_MLTPR_24MHZ ;
 int PHYCLKRST_PORTRESET ;
 int PHYCLKRST_REFCLKSEL_EXT_REFCLK ;
 int PHYCLKRST_REF_SSP_EN ;
 int PHYCLKRST_RETENABLEN ;
 int PHYCLKRST_SSC_EN ;
 int PHYCLKRST_SSC_REFCLKSEL (int) ;
 int PHYPARAM0_REF_LOSLEVEL ;
 int PHYPARAM0_REF_LOSLEVEL_MASK ;
 int PHYPARAM0_REF_USE_PAD ;
 int PHYPARAM1_PCS_TXDEEMPH ;
 int PHYPARAM1_PCS_TXDEEMPH_MASK ;
 int PHYTEST_POWERDOWN_HSP ;
 int PHYTEST_POWERDOWN_SSP ;
 int PHYUTMICLKSEL_UTMI_CLKSEL ;
 int PHYUTMI_OTGDISABLE ;
 int READ4 (struct usb_phy_softc*,int ) ;
 int USB_DRD_LINKSYSTEM ;
 int USB_DRD_PHYCLKRST ;
 int USB_DRD_PHYPARAM0 ;
 int USB_DRD_PHYPARAM1 ;
 int USB_DRD_PHYREG0 ;
 int USB_DRD_PHYRESUME ;
 int USB_DRD_PHYTEST ;
 int USB_DRD_PHYUTMI ;
 int USB_DRD_PHYUTMICLKSEL ;
 int WRITE4 (struct usb_phy_softc*,int ,int) ;

__attribute__((used)) static int
usb3_phy_init(struct usb_phy_softc *sc)
{
 int reg;


 WRITE4(sc, USB_DRD_PHYREG0, 0);

 reg = READ4(sc, USB_DRD_PHYPARAM0);

 reg &= ~(PHYPARAM0_REF_USE_PAD);
 reg &= ~(PHYPARAM0_REF_LOSLEVEL_MASK);
 reg |= (PHYPARAM0_REF_LOSLEVEL);
 WRITE4(sc, USB_DRD_PHYPARAM0, reg);
 WRITE4(sc, USB_DRD_PHYRESUME, 0);

 reg = (LINKSYSTEM_XHCI_VERSION_CTRL |
     LINKSYSTEM_FLADJ(0x20));
 WRITE4(sc, USB_DRD_LINKSYSTEM, reg);

 reg = READ4(sc, USB_DRD_PHYPARAM1);
 reg &= ~(PHYPARAM1_PCS_TXDEEMPH_MASK);
 reg |= (PHYPARAM1_PCS_TXDEEMPH);
 WRITE4(sc, USB_DRD_PHYPARAM1, reg);

 reg = READ4(sc, USB_DRD_PHYUTMICLKSEL);
 reg |= (PHYUTMICLKSEL_UTMI_CLKSEL);
 WRITE4(sc, USB_DRD_PHYUTMICLKSEL, reg);

 reg = READ4(sc, USB_DRD_PHYTEST);
 reg &= ~(PHYTEST_POWERDOWN_HSP);
 reg &= ~(PHYTEST_POWERDOWN_SSP);
 WRITE4(sc, USB_DRD_PHYTEST, reg);

 WRITE4(sc, USB_DRD_PHYUTMI, PHYUTMI_OTGDISABLE);


 reg = (PHYCLKRST_REFCLKSEL_EXT_REFCLK);
 reg |= (PHYCLKRST_FSEL(PHYCLKRST_FSEL_24MHZ));
 reg |= (PHYCLKRST_MPLL_MLTPR_24MHZ);
 reg |= (PHYCLKRST_SSC_REFCLKSEL(0x88));
 reg |= (PHYCLKRST_RETENABLEN |
     PHYCLKRST_REF_SSP_EN |
     PHYCLKRST_SSC_EN |
     PHYCLKRST_COMMONONN |
     PHYCLKRST_PORTRESET);

 WRITE4(sc, USB_DRD_PHYCLKRST, reg);
 DELAY(50000);
 reg &= ~PHYCLKRST_PORTRESET;
 WRITE4(sc, USB_DRD_PHYCLKRST, reg);

 return (0);
}
