
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


typedef int bufmax ;
typedef int WebBanner ;
typedef int Version ;
struct TYPE_2__ {char* t; } ;
typedef int SOCKET ;
typedef int ModJK ;


 int do_connect (char*,int) ;
 int memset (char*,int ,int) ;
 int printf (char*,...) ;
 int recv (int,char*,int,int ) ;
 int send (int,char*,int,int ) ;
 int strlen (char*) ;
 int strncpy (char*,char*,int) ;
 char* strstr (char*,char*) ;
 TYPE_1__* targets ;

int get_version(char * remotehost, int port, int * target)
{

 char bufmax[4096], * lp, *lp2, WebBanner[1000], Version[1000], ModJK[1000];
 int bytes,j,x;
 SOCKET sock;

 memset(bufmax,0,sizeof(bufmax));
 memset(WebBanner,0,sizeof(WebBanner));
 memset(Version,0,sizeof(Version));
 memset(ModJK,0,sizeof(ModJK));
 sock = do_connect(remotehost, port);

 if (sock == -1) return -1;
 send(sock, "GET /a.html HTTP/1.0\r\n\r\n",(int)strlen("GET /a.html HTTP/1.0\r\n\r\n"),0);

 if ((bytes = recv(sock, bufmax, sizeof(bufmax),0 )) <= 0) return -1;
 bufmax[sizeof(bufmax)-1]=0;

 if((lp=strstr(bufmax,"Server:"))==((void*)0)) return -1;
 if((lp2=strstr(lp,"\r\n"))==((void*)0)) return -1;

 strncpy(WebBanner, lp, lp2-lp);
 if((lp=strstr(WebBanner,"Win32"))==((void*)0))
 {
  printf("   [-] OS is not a Win32\n");
  return -1;
 }

 if((lp=strstr(WebBanner,"Apache/"))==((void*)0))
 {
  printf("   [-] No Apache\n");
  return -1;
 }
 if(lp+strlen("Apache/")>WebBanner+strlen(WebBanner)-1) return -1;
 lp+=strlen("Apache/");
 if((lp2=strstr(lp," "))==((void*)0)) return -1;

 strncpy(Version, lp, lp2-lp);

 printf("   [+] Version of Apache is %s\n", Version);

 x=0;
 for(j=0; targets[j].t!=0;j++)
 {
  if(strstr(targets[j].t,Version)!=((void*)0))
  {
   x=1;
   break;
  }
 }
 if(x==0)
 {
  printf("   [-] This version of Apache is UNSUPPORTED\n");
  return -1;
 }
 printf("   [+] This version of Apache is SUPPORTED\n");

 strncpy(WebBanner, lp, lp2-lp);

 if((lp=strstr(WebBanner,"mod_jk2/"))==((void*)0))
 {
  printf("   [-] No mod_jk2\n");
  return -1;
 }
 if((lp2=strstr(lp," "))==((void*)0)) lp2=WebBanner+strlen(WebBanner);

 strncpy(ModJK, lp, lp2-lp);

 printf("   [+] mod_jk2 is %s\n", ModJK);
 x=0;
 for(j=0; targets[j].t!=0;j++)
 {
  if(strstr(targets[j].t,ModJK)!=((void*)0))
  {
   *target=j;
   x=1;
   break;
  }
 }
 if(x==0)
 {
  printf("   [-] This version of mod_jk2 is UNSUPPORTED\n");
  return -1;
 }
 printf("   [+] This version of mod_jk2 is SUPPORTED\n");
 return 0;
}
