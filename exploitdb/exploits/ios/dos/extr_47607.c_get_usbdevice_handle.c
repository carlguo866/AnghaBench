
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_5__ TYPE_1__ ;


typedef scalar_t__ kern_return_t ;
typedef int io_service_t ;
struct TYPE_5__ {scalar_t__ (* QueryInterface ) (TYPE_1__**,int ,int *) ;int (* Release ) (TYPE_1__**) ;} ;
typedef int SInt32 ;
typedef int LPVOID ;
typedef int IOUSBDeviceInterface ;
typedef TYPE_1__ IOCFPlugInInterface ;


 int CFUUIDGetUUIDBytes (int ) ;
 scalar_t__ IOCreatePlugInInterfaceForService (int ,int ,int ,TYPE_1__***,int *) ;
 int KERN_FAILURE ;
 scalar_t__ KERN_SUCCESS ;
 int kIOCFPlugInInterfaceID ;
 scalar_t__ kIOReturnSuccess ;
 int kIOUSBDeviceInterfaceID ;
 int kIOUSBDeviceUserClientTypeID ;
 scalar_t__ stub1 (TYPE_1__**,int ,int *) ;
 int stub2 (TYPE_1__**) ;

__attribute__((used)) static int get_usbdevice_handle(io_service_t device, IOUSBDeviceInterface* dev){

    kern_return_t err = KERN_SUCCESS;
    SInt32 score;
    IOCFPlugInInterface** plugInInterface = ((void*)0);

    err = IOCreatePlugInInterfaceForService(device,
                                            kIOUSBDeviceUserClientTypeID,
                                            kIOCFPlugInInterfaceID,
                                            &plugInInterface, &score);

    if (err != KERN_SUCCESS || plugInInterface == ((void*)0))
        return err;

    err = (*plugInInterface)->QueryInterface(plugInInterface, CFUUIDGetUUIDBytes(kIOUSBDeviceInterfaceID), (LPVOID*)dev);

    if(err != kIOReturnSuccess)
        return err;


    (*plugInInterface)->Release(plugInInterface);


    if(!dev)
        return KERN_FAILURE;

    return err;
}
