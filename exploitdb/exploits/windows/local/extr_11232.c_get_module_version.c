
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct ioctl_ver_req {int action; int hEvent; int * rel; int * min; int * med; int * maj; int * result; struct ioctl_ver_req* args; } ;
struct ioctl_req {int action; int hEvent; int * rel; int * min; int * med; int * maj; int * result; struct ioctl_req* args; } ;
typedef struct ioctl_ver_req OVERLAPPED ;
typedef int HANDLE ;
typedef int DWORD ;
typedef scalar_t__ BOOL ;


 int CloseHandle (int ) ;
 int CreateEventW (int *,int ,int ,int *) ;
 scalar_t__ DeviceIoControl (int ,int ,struct ioctl_ver_req*,int,int *,int ,int *,struct ioctl_ver_req*) ;
 int EXIT_FAILURE ;
 int FALSE ;
 scalar_t__ GetOverlappedResult (int ,struct ioctl_ver_req*,int *,int) ;
 int SAFECNTRL_IOCTL ;
 int TRUE ;
 int exit (int ) ;
 int fprintf (int ,char*) ;
 int memset (struct ioctl_ver_req*,int,int) ;
 int stderr ;

__attribute__((used)) static DWORD
get_module_version (HANDLE hFile, DWORD *maj, DWORD *med, DWORD *min, DWORD *rel)
{
  struct ioctl_ver_req ver_req;
  struct ioctl_req req;
  DWORD req_result, rlen;
  OVERLAPPED olStruct;
  BOOL bResult;

  memset (&req, 0, sizeof req);
  req.action = 10;
  req.args = &ver_req;
  req.result = &req_result;

  memset (&ver_req, 0xCC, sizeof ver_req);
  ver_req.maj = maj;
  ver_req.med = med;
  ver_req.min = min;
  ver_req.rel = rel;

  memset (&olStruct, 0, sizeof olStruct);
  olStruct.hEvent = CreateEventW (((void*)0), TRUE, FALSE, ((void*)0));
  if (!olStruct.hEvent)
    {
      fprintf (stderr, "* CreateEventW failed\n");
      exit (EXIT_FAILURE);
    }

  bResult = DeviceIoControl (hFile, SAFECNTRL_IOCTL,
                             &req, sizeof req, ((void*)0), 0, &rlen, &olStruct);
  if (!bResult)
    {
      fprintf (stderr, "* DeviceIoControl failed\n");
      exit (EXIT_FAILURE);
    }

  bResult = GetOverlappedResult (hFile, &olStruct, &rlen, 1);
  if (!bResult)
    {
      fprintf (stderr, "* GetOverlappedResult failed\n");
      exit (EXIT_FAILURE);
    }

  CloseHandle (olStruct.hEvent);

  return (req_result);
}
