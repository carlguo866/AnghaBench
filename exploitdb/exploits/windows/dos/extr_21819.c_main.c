
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_4__ TYPE_2__ ;
typedef struct TYPE_3__ TYPE_1__ ;


struct sockaddr {int dummy; } ;
typedef int WSADATA ;
struct TYPE_3__ {int s_addr; } ;
struct TYPE_4__ {TYPE_1__ sin_addr; int sin_family; int sin_port; } ;
typedef int SOCKET ;
typedef TYPE_2__ SOCKADDR_IN ;
typedef int LPSOCKADDR ;


 int AF_INET ;
 int INADDR_ANY ;
 scalar_t__ INVALID_SOCKET ;
 int IPPROTO_TCP ;
 int MAKEWORD (int,int) ;
 char* PART ;
 int PF_INET ;
 char* SERVER ;
 int SOCKET_ERROR ;
 int SOCK_STREAM ;
 int WSACleanup () ;
 scalar_t__ WSAStartup (int ,int *) ;
 int accept (scalar_t__,int *,int *) ;
 int bind (scalar_t__,int ,int) ;
 int htons (int) ;
 int listen (scalar_t__,int) ;
 int memset (char*,char,int) ;
 int printf (char*) ;
 scalar_t__ s ;
 int send (int,char*,int,int ) ;
 int sleep (int) ;
 scalar_t__ socket (int ,int ,int ) ;
 scalar_t__ strcmp (char*,char*) ;
 int strlen (char*) ;
 int usage () ;

int main(int argc, char *argv[]) {
   SOCKET TempSock = SOCKET_ERROR;
   WSADATA WsaDat;
   SOCKADDR_IN Sockaddr;
   int nRet;
   char payload[4096];
   if (argc < 2) {
      usage();
      return 1;
   }
   if ((!strcmp(argv[1],"raw")) && (argc < 3) || (strcmp(argv[1],"raw")) &&
(strcmp(argv[1],"part")) && (strcmp(argv[1],"data"))) {
      usage();
      return 1;
   }

   printf("Listening on port 6667 for connections....\n");
   if (WSAStartup(MAKEWORD(1, 1), &WsaDat) != 0) {
           printf("ERROR: WSA Initialization failed.");
      return 0;
   }



   s = socket(PF_INET, SOCK_STREAM, IPPROTO_TCP);
   if (s == INVALID_SOCKET) {
      printf("ERROR: Could Not Create Socket. Exiting\n");
      WSACleanup();
      return 0;
   }

   Sockaddr.sin_port = htons(6667);
   Sockaddr.sin_family = AF_INET;
   Sockaddr.sin_addr.s_addr = INADDR_ANY;


        nRet = bind(s, (LPSOCKADDR)&Sockaddr, sizeof(struct sockaddr));
   if (nRet == SOCKET_ERROR) {
      printf("ERROR Binding Socket");
      WSACleanup();
      return 0;
   }


   if (listen(s, 10) == SOCKET_ERROR) {
      printf("ERROR: Couldnt Make Listening Socket\n");
      WSACleanup();
      return 0;
   }

   while (TempSock == SOCKET_ERROR) {
         TempSock = accept(s, ((void*)0), ((void*)0));
   }

   printf("Client Connected, Sending Payload\n");


   if (!strcmp(argv[1],"part")) {
      send(TempSock,PART,strlen(PART),0);
   }
   if (!strcmp(argv[1],"raw")) {
      send(TempSock,SERVER,strlen(SERVER),0);
      send(TempSock,argv[2],strlen(argv[2]),0);
      send(TempSock,"\n",1,0);
   }
   if (!strcmp(argv[1],"data")) {
      memset(payload,'A',4096);
      send(TempSock,payload,strlen(payload),0);
   }
   printf("Exiting\n");
   sleep(100);
   WSACleanup();
   return 0;
}
