
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_7__ TYPE_1__ ;


typedef scalar_t__ uint16_t ;
struct TYPE_7__ {int wct; int total_param_cnt; int param_cnt; int param_offset; int detail_level; int recv_buffer_len; int data_offset; int bcc; int return_descriptor; int param_descriptor; scalar_t__ function_code; scalar_t__ user_id; scalar_t__ tree_id; } ;
typedef TYPE_1__ transaction_request ;
typedef TYPE_1__ smb_header ;
typedef TYPE_1__ parameters ;


 unsigned char SESSION_MESSAGE ;
 int SMB_COM_TRANSACTION ;
 scalar_t__ bswap16 (scalar_t__) ;
 int build_smb_header (TYPE_1__*,int ,int ,int ,scalar_t__,scalar_t__,scalar_t__,int ) ;
 int memcpy (unsigned char*,TYPE_1__*,int) ;
 int memset (TYPE_1__*,int ,int) ;
 unsigned char* push_string (unsigned char*,char*) ;
 scalar_t__ rand () ;
 int strcpy (int ,char*) ;
 int write (int,unsigned char*,int) ;

void
request_transaction (unsigned char *buffer, int fd)
{
  smb_header hdr;
  transaction_request transaction;
  parameters params;
  uint16_t proc_id, tree_id, user_id;
  unsigned char *p;

  proc_id = (uint16_t) rand ();
  tree_id = ((smb_header *) (buffer + 4))->tree_id;
  user_id = ((smb_header *) (buffer + 4))->user_id;

  build_smb_header (&hdr, SMB_COM_TRANSACTION, 0, 0, tree_id, proc_id,
                    user_id, 0);

  buffer[0] = SESSION_MESSAGE;
  buffer[1] = 0x0;

  memcpy (buffer + 4, &hdr, sizeof (smb_header));

  memset (&transaction, 0, sizeof (transaction_request));

  transaction.wct = 14;
  transaction.total_param_cnt = 19;
  transaction.param_cnt = 19;

  p = buffer + 4 + sizeof (smb_header) + sizeof (transaction_request);


  p = push_string (p, "\\PIPE\\LANMAN");

  transaction.param_offset = p - buffer - 4;

  params.function_code = (uint16_t) 0x68;
  strcpy (params.param_descriptor, "WrLeh");
  strcpy (params.return_descriptor, "B13BWz");
  params.detail_level = 1;
  params.recv_buffer_len = 50000;

  memcpy (p, &params, sizeof (parameters));

  p += transaction.param_cnt;

  transaction.data_offset = p - buffer - 4;

  transaction.bcc =
    p - buffer - 4 - sizeof (smb_header) - sizeof (transaction_request);

  memcpy (buffer + 4 + sizeof (smb_header), &transaction,
          sizeof (transaction_request));


  *(uint16_t *) (buffer + 2) =
    bswap16 ((uint16_t)
             (sizeof (transaction_request) + sizeof (smb_header) +
              transaction.bcc));

  write (fd, buffer,
         sizeof (transaction_request) + sizeof (smb_header) + 4 +
         transaction.bcc);
}
