
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


typedef int u_short ;
typedef int u_long ;
struct TYPE_2__ {int s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; int sin_port; int sin_family; } ;
struct sockaddr {int dummy; } ;


 int AF_INET ;
 int DNS_PORT ;
 int SIGKILL ;
 int SOCK_DGRAM ;
 int SOL_SOCKET ;
 int SO_REUSEADDR ;
 scalar_t__ bind (int,struct sockaddr*,int) ;
 int fprintf (int ,char*,...) ;
 int htons (int ) ;
 char* inet_ntoa (TYPE_1__) ;
 scalar_t__ kill (int,int ) ;
 int perror (char*) ;
 int setsockopt (int,int ,int ,char*,int) ;
 int socket (int ,int ,int ) ;
 int stderr ;

int SocketBind(u_short pid, struct sockaddr_in *sa, u_long listen_ip)
{
 int sd, sockopt, sockoptlen;

 if((sd = socket(AF_INET, SOCK_DGRAM, 0)) < 0)
 {
  perror("can't get a udp socket");
  return(sd);
 }


 if(pid)
 {
  fprintf(stderr, "killing pid %u...", pid);
  if(kill(pid, SIGKILL) < 0)
  {
   perror("can't kill process");
   return(-1);
  }
  fprintf(stderr, "killed.\n");
 }

 sa->sin_family = AF_INET;
 sa->sin_port = htons(DNS_PORT);
 sa->sin_addr.s_addr = listen_ip;
 sockopt = 1; sockoptlen = 4;
 setsockopt(sd, SOL_SOCKET, SO_REUSEADDR, (char *)&sockopt, sockoptlen);

 if(bind(sd, (struct sockaddr *)sa, sizeof(struct sockaddr)) < 0)
 {
  perror("can't bind dns port 53");
  return(-1);
 }

 fprintf(stderr, "listening on %s...\n", inet_ntoa(sa->sin_addr));
 return(sd);
}
