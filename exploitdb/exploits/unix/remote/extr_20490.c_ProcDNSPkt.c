
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


typedef scalar_t__ u_short ;
struct TYPE_2__ {int arcount; int nscount; int qdcount; scalar_t__ qr; } ;
typedef TYPE_1__ HEADER ;


 int ExpandDName (char*,char*,int ) ;
 int GETSHORT (int,char*) ;
 scalar_t__ HFIXEDSZ ;
 int MAXDNAME ;
 scalar_t__ QFIXEDSZ ;
 int fprintf (int ,char*) ;
 char* malloc (int ) ;
 int ntohs (int ) ;
 int stderr ;
 int strlen (char*) ;

char *ProcDNSPkt(char *pkt, u_short pktlen, int *qtype)
{
 static char *qname;
 char *qRR;
 HEADER *dnshdr;
 int qnamelen;


 if(pkt == ((void*)0) || pktlen < (HFIXEDSZ + QFIXEDSZ))
  return(0);
 dnshdr = (HEADER *)pkt;


 if(dnshdr->qr)
  return(0);


 if(ntohs(dnshdr->qdcount) != 1 || ntohs(dnshdr->arcount) != 0 ||
  ntohs(dnshdr->nscount) != 0 || ntohs(dnshdr->arcount) != 0)
  return(0);

 if(!qname)
 {
  if((qname = malloc(MAXDNAME)) == 0)
  {
   fprintf(stderr, "no memory for qname\n");
   return(0);
  }
 }
 qnamelen = ExpandDName(pkt+HFIXEDSZ, qname, MAXDNAME);
 if(qnamelen == 0)
  return(((void*)0));


 qRR = pkt + HFIXEDSZ + strlen(pkt + HFIXEDSZ) + 1;
 GETSHORT(qnamelen, qRR);
 *qtype = qnamelen;
 return(qname);
}
