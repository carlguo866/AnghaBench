
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


typedef int uint8_t ;
struct TYPE_2__ {int sa_data; } ;
struct ifreq {char* ifr_name; int ifr_mtu; int ifr_ifindex; TYPE_1__ ifr_hwaddr; } ;
typedef int ifr ;


 int AF_INET ;
 int ETH_P_ALL ;
 char* INTERFACE ;
 int IPPROTO_RAW ;
 int MIN_MTU ;
 int PF_PACKET ;
 int SIOCGIFHWADDR ;
 int SIOCGIFINDEX ;
 int SIOCGIFMTU ;
 int SOCK_RAW ;
 int SOL_SOCKET ;
 int SO_BINDTODEVICE ;
 int close (int) ;
 int die (char*) ;
 int htons (int ) ;
 int idx ;
 scalar_t__ ioctl (int,int ,struct ifreq*) ;
 int* mac ;
 int memcpy (int*,int ,int) ;
 int memset (struct ifreq*,int ,int) ;
 int printf (char*,...) ;
 int raw_socket ;
 scalar_t__ setsockopt (int,int ,int ,struct ifreq*,int) ;
 int snprintf (char*,int,char*,char*) ;
 int socket (int ,int ,int ) ;
 int srand (int ) ;
 int strcpy (char*,char*) ;
 int time (int *) ;

void initialize() {
   int sd;
   struct ifreq ifr;
   char interface[40];
   int mtu;

   srand(time(((void*)0)));
   strcpy (interface, INTERFACE);


  if ((sd = socket (AF_INET, SOCK_RAW, IPPROTO_RAW)) < 0) {
    die("socket() failed to get socket descriptor for using ioctl()");
  }

  memset (&ifr, 0, sizeof (ifr));
  strcpy (ifr.ifr_name, interface);
  if (ioctl (sd, SIOCGIFMTU, &ifr) < 0) {
    die("ioctl() failed to get MTU ");
  }
  mtu = ifr.ifr_mtu;
  printf ("MTU of interface %s : %i\n", interface, mtu);
  if (mtu < MIN_MTU) {
    printf("Run\n$ ip link set dev %s mtu 12000\n",interface);
    die("");
  }


  memset (&ifr, 0, sizeof (ifr));
  snprintf (ifr.ifr_name, sizeof (ifr.ifr_name), "%s", interface);
  if (ioctl (sd, SIOCGIFHWADDR, &ifr) < 0) {
    die("ioctl() failed to get source MAC address ");
  }
  memcpy (mac, ifr.ifr_hwaddr.sa_data, 6 * sizeof (uint8_t));
  printf ("MAC %s :", interface);
  for (int i=0; i<5; i++) {
    printf ("%02x:", mac[i]);
  }
  printf ("%02x\n", mac[5]);




  memset (&ifr, 0, sizeof (ifr));
  snprintf (ifr.ifr_name, sizeof (ifr.ifr_name), "%s", interface);
  if (ioctl (sd, SIOCGIFINDEX, &ifr) < 0) {
    die("ioctl() failed to find interface ");
  }

  close (sd);
  printf ("Index for interface %s : %i\n", interface, ifr.ifr_ifindex);
  idx = ifr.ifr_ifindex;

  if((raw_socket = socket(PF_PACKET, SOCK_RAW, htons (ETH_P_ALL)))==-1)
      die("socket() failed to obtain raw socket");



  if (setsockopt (raw_socket, SOL_SOCKET, SO_BINDTODEVICE, &ifr, sizeof (ifr)) < 0) {
    die("setsockopt() failed to bind to interface ");
  }

  printf("Initialized socket discriptors\n");
}
