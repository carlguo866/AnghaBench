
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int PAGE (void*) ;
 int PROT_EXEC ;
 int PROT_READ ;
 int PROT_WRITE ;
 void* malloc (int) ;
 int memcpy (void*,long*,int) ;
 int memset (void*,int,int) ;
 int mprotect (int ,int,int) ;

__attribute__((used)) static void *hook (void *hfunc, int len, void *wfunc) {
        void *newmem = malloc(len+5);
 long rel32;


        memcpy(newmem, hfunc, len);
 memset(newmem+len, 0xe9, 1);
 rel32 = hfunc - (newmem+5);
 memcpy(newmem+len+1, &rel32, sizeof rel32);


 mprotect(PAGE(hfunc), 4096, PROT_READ|PROT_WRITE|PROT_EXEC);


 memset(hfunc, 0xe9, 1);
        rel32 = wfunc - (hfunc+5);
 memcpy(hfunc+1, &rel32, sizeof rel32);

        return newmem;
}
