
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct iphdr {unsigned long saddr; int id; } ;


 int ICMP_ECHO ;
 int ICMP_ECHO_H ;
 int IPPROTO_ICMP ;
 int IP_H ;
 int build_icmp_echo (int ,int ,int ,int,int ,int ,char*) ;
 int build_ip (int,int ,int ,int ,int,int ,int ,unsigned long,int ,int ,char*) ;
 int do_checksum (char*,int ,int) ;
 int getpid () ;
 int icmp_sock ;
 int myaddr ;
 int ntohs (int ) ;
 int packid ;
 int read (int ,char*,int) ;
 int sock ;
 unsigned long target ;
 int write_ip (int ,char*,int) ;

int
  get_id ()
{
    char buf[200];
    char buf2[200];
    int n;
    unsigned long addr;
    build_icmp_echo (ICMP_ECHO, 0, getpid (), 1, 0, 0, buf + IP_H);
    build_ip (ICMP_ECHO_H, 0, packid++, 0, 64, IPPROTO_ICMP, myaddr,
              target, 0, 0, buf);
    do_checksum (buf, IPPROTO_ICMP, ICMP_ECHO_H);
    write_ip (sock, buf, IP_H + ICMP_ECHO_H);
    do
      {
        n = read (icmp_sock, buf2, 200);
        addr = ((struct iphdr *) buf2)->saddr;
      }
    while (addr != target);
    return ntohs (((struct iphdr *) buf2)->id);
}
