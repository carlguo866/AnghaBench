
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


struct TYPE_2__ {int s_addr; } ;
struct sockaddr_in {int sin_zero; TYPE_1__ sin_addr; int sin_port; int sin_family; } ;
struct sockaddr {int dummy; } ;
struct hostent {int dummy; } ;
typedef int socklen_t ;
typedef int reuseaddr ;
typedef int localaddr ;


 int AF_INET ;
 int INADDR_ANY ;
 int SOCK_STREAM ;
 int SOL_SOCKET ;
 int SO_REUSEADDR ;
 scalar_t__ bind (int,struct sockaddr*,int) ;
 int bzero (int *,int) ;
 int exit (int) ;
 int htons (unsigned short) ;
 scalar_t__ listen (int,int) ;
 int perror (char*) ;
 int printf (char*) ;
 scalar_t__ setsockopt (int,int ,int ,int*,int ) ;
 int socket (int ,int ,int ) ;

int socket_listen( unsigned short port )
{
  int s,reuseaddr=1;
  struct sockaddr_in localaddr;
  struct hostent* host_addr;

  localaddr.sin_family = AF_INET;
  localaddr.sin_port = htons(port);
  localaddr.sin_addr.s_addr = INADDR_ANY;
  bzero(&(localaddr.sin_zero), 8);

  if ( ( s = socket(AF_INET, SOCK_STREAM, 0) ) < 0 )
  {
   printf ( "[X] socket() failed!\n" );
   exit ( 1 );
  }
  if (setsockopt(s, SOL_SOCKET, SO_REUSEADDR, &reuseaddr,(socklen_t)sizeof(reuseaddr)) < 0)
  {
   printf("[X] setsockopt() failed!\n");
   exit ( 1 );
  }
  if (bind(s, (struct sockaddr *)&localaddr, sizeof(localaddr)) < 0)
  {
   perror("[X] bind() failed\n");
   exit ( 1 );
  }
  if (listen(s, 1) < 0)
  {
   perror("[X] listen() failed\n");
   exit ( 1 );
  }
  return ( s );
}
