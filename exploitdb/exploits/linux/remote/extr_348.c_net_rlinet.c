
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct timeval {int tv_sec; int tv_usec; } ;


 int NET_READTIMEOUT ;
 int gettimeofday (struct timeval*,int *) ;
 int memset (char*,char,int) ;
 int net_rtimeout (int,int ) ;
 int read (int,char*,int) ;

int
net_rlinet (int fd, char *buf, int bufsize, int sec)
{
        int n;
        unsigned long int rb = 0;
        struct timeval tv_start, tv_cur;

        memset(buf, '\0', bufsize);
        (void) gettimeofday(&tv_start, ((void*)0));

        do {
                (void) gettimeofday(&tv_cur, ((void*)0));
                if (sec > 0) {
                        if ((((tv_cur.tv_sec * 1000000) + (tv_cur.tv_usec)) -
                                ((tv_start.tv_sec * 1000000) +
                                (tv_start.tv_usec))) > (sec * 1000000))
                        {
                                return (-1);
                        }
                }
                n = net_rtimeout(fd, NET_READTIMEOUT);
                if (n <= 0) {
                        return (-1);
                }
                n = read(fd, buf, 1);
                if (n <= 0) {
                        return (n);
                }
                rb++;
                if (*buf == '\n')
                        return (rb);
                buf++;
                if (rb >= bufsize)
                        return (-2);
        } while (1);
}
