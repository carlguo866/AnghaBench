
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int out ;
typedef int in ;
typedef int fd_set ;


 scalar_t__ FD_ISSET (int,int *) ;
 int FD_SET (int,int *) ;
 int FD_ZERO (int *) ;
 char* SEND ;
 int close (int) ;
 int exit (int) ;
 int fileno (int ) ;
 int fprintf (int ,char*,...) ;
 int memset (char*,char,int) ;
 int quit (int) ;
 scalar_t__ read (int,char*,int) ;
 int select (int,int *,int *,int *,int *) ;
 int stderr ;
 int stdin ;
 int strlen (char*) ;
 int strncmp (char*,char*,int) ;
 scalar_t__ write (int,char*,int ) ;

void
handleshell(int closeme, int s)
{
        char in[512], out[512];
 fd_set fdset;

 close(closeme);

 if(write(s, SEND, strlen(SEND)) < 0 ) {
  fprintf(stderr, "write error\n");
  exit(1);
 }

        while(1) {

                FD_ZERO(&fdset);
                FD_SET(fileno(stdin), &fdset);
                FD_SET(s, &fdset);

                select(s+1, &fdset, ((void*)0), ((void*)0), ((void*)0));

                if(FD_ISSET(fileno(stdin), &fdset)) {
                        memset(out, '\0', sizeof(out));
                        if(read(0, out, (sizeof(out)-1)) < 0) {
    fprintf(stderr, "read error\n");
                                exit(1);
   }
   if(!strncmp(out, "exit", 4)) {
                                write(s, out, strlen(out));
                                quit(s);
    exit(0);
                        }
                        if(write(s, out, strlen(out)) < 0) {
                                fprintf(stderr, "write error\n");
                                exit(1);
                        }
                }

                if(FD_ISSET(s, &fdset)) {
                        memset(in, '\0', sizeof(in));
                        if(read(s, in, (sizeof(in)-1)) < 0) {
                                fprintf(stderr, "read error\n");
                                exit(1);
                        }
                 fprintf(stderr, "%s", in);
  }
        }
}
