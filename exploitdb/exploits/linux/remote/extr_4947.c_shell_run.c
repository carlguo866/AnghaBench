
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int rbuf ;
typedef int fd_set ;


 scalar_t__ FD_ISSET (int,int *) ;
 int FD_SET (int,int *) ;
 int FD_ZERO (int *) ;
 int STDIN_FILENO ;
 int perror (char*) ;
 int printf (char*,char*) ;
 int read (int,char*,int) ;
 int select (int,int *,int *,int *,int *) ;
 int strlen (char*) ;
 int write (int,char*,int) ;

__attribute__((used)) static void
shell_run (int sockfd)
{
    int rs;
    fd_set rset;
    char rbuf[1024], *cmd = "id; uname -a; uptime\n";

    write(sockfd, cmd, strlen(cmd));

    while (1) {
        FD_ZERO (&rset);
        FD_SET (sockfd, &rset);
        FD_SET (STDIN_FILENO, &rset);

 select (sockfd + 1, &rset, ((void*)0), ((void*)0), ((void*)0));
 if (FD_ISSET (sockfd, &rset)) {
     rs = read (sockfd, rbuf, sizeof(rbuf) - 1);
            if (rs <= 0) {
                perror("read");
  return;
            }
     rbuf[rs] = '\0';
            printf ("%s", rbuf);
        }

 if (FD_ISSET (STDIN_FILENO, &rset)) {
     rs = read(STDIN_FILENO, rbuf, sizeof(rbuf) - 1);
            if (rs > 0) {
         rbuf[rs] = '\0';
         write (sockfd, rbuf, rs);
            }
        }
    }
}
