
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct sockaddr_ll {scalar_t__ sll_halen; scalar_t__ sll_pkttype; scalar_t__ sll_hatype; int sll_ifindex; int sll_protocol; int sll_family; } ;
struct sockaddr {int dummy; } ;
typedef int sa ;


 int AF_PACKET ;
 int ETH_P_ALL ;
 int EXIT_FAILURE ;
 int PF_PACKET ;
 int SOCK_RAW ;
 int bind (int,struct sockaddr*,int) ;
 int dprintf (char*) ;
 int exit (int ) ;
 int htons (int ) ;
 int if_nametoindex (char*) ;
 int memset (struct sockaddr_ll*,int ,int) ;
 int packet_socket_rx_ring_init (int,unsigned int,unsigned int,unsigned int,unsigned int,int) ;
 int socket (int ,int ,int ) ;

int packet_socket_setup(unsigned int block_size, unsigned int frame_size,
  unsigned int block_nr, unsigned int sizeof_priv, int timeout) {
 int s = socket(AF_PACKET, SOCK_RAW, htons(ETH_P_ALL));
 if (s < 0) {
  dprintf("[-] socket(AF_PACKET)\n");
  exit(EXIT_FAILURE);
 }

 packet_socket_rx_ring_init(s, block_size, frame_size, block_nr,
  sizeof_priv, timeout);

 struct sockaddr_ll sa;
 memset(&sa, 0, sizeof(sa));
 sa.sll_family = PF_PACKET;
 sa.sll_protocol = htons(ETH_P_ALL);
 sa.sll_ifindex = if_nametoindex("lo");
 sa.sll_hatype = 0;
 sa.sll_pkttype = 0;
 sa.sll_halen = 0;

 int rv = bind(s, (struct sockaddr *)&sa, sizeof(sa));
 if (rv < 0) {
  dprintf("[-] bind(AF_PACKET)\n");
  exit(EXIT_FAILURE);
 }

 return s;
}
