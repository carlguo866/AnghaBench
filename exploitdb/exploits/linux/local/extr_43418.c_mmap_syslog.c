
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int EXIT_FAILURE ;
 int MAP_ANONYMOUS ;
 int MAP_PRIVATE ;
 int PROT_READ ;
 int PROT_WRITE ;
 int SYSLOG_ACTION_READ_ALL ;
 int SYSLOG_ACTION_SIZE_BUFFER ;
 int exit (int ) ;
 int getpagesize () ;
 int klogctl (int ,char*,int) ;
 scalar_t__ mmap (int *,int,int,int,int,int ) ;
 int perror (char*) ;

void mmap_syslog(char** buffer, int* size) {
 *size = klogctl(SYSLOG_ACTION_SIZE_BUFFER, 0, 0);
 if (*size == -1) {
  perror("[-] klogctl(SYSLOG_ACTION_SIZE_BUFFER)");
  exit(EXIT_FAILURE);
 }

 *size = (*size / getpagesize() + 1) * getpagesize();
 *buffer = (char*)mmap(((void*)0), *size, PROT_READ | PROT_WRITE,
       MAP_PRIVATE | MAP_ANONYMOUS, -1, 0);

 *size = klogctl(SYSLOG_ACTION_READ_ALL, &((*buffer)[0]), *size);
 if (*size == -1) {
  perror("[-] klogctl(SYSLOG_ACTION_READ_ALL)");
  exit(EXIT_FAILURE);
 }
}
