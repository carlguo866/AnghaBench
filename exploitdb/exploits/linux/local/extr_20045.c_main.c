
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


struct TYPE_2__ {int s_addr; } ;
struct sockaddr_in {int sin_port; TYPE_1__ sin_addr; int sin_family; } ;
struct sockaddr {int dummy; } ;
typedef int local_addr ;


 int AF_INET ;
 int INADDR_ANY ;
 int PF_INET ;
 int SOCK_STREAM ;
 int accept (int,struct sockaddr*,int*) ;
 int bind (int,struct sockaddr*,int) ;
 int htons (int) ;
 int listen (int,int) ;
 int memset (char*,char,int) ;
 int printf (char*,unsigned int) ;
 int read (int,char*,int) ;
 int socket (int ,int ,int) ;
 int write (int,...) ;

int
main(int argc, const char* argv[])
{
  static int port = 6000;

  char sendbuf[32768];
  char recvbuf[1024];
  struct sockaddr_in local_addr;
  struct sockaddr_in remote_addr;
  int remote_addrlen;
  int listen_fd;
  int accept_fd;
  char c;
  short s;
  int i;
  unsigned int bigsend;

  listen_fd = socket(PF_INET, SOCK_STREAM, 6);

  local_addr.sin_family = AF_INET;
  local_addr.sin_addr.s_addr = INADDR_ANY;
  local_addr.sin_port = htons(port);
  bind(listen_fd, (struct sockaddr*)&local_addr, sizeof(local_addr));

  listen(listen_fd, 1);

  accept_fd = accept(listen_fd, (struct sockaddr*)&remote_addr,
                     &remote_addrlen);


  read(accept_fd, recvbuf, 12);

  s = * ((short*)&recvbuf[6]);
  s += * ((short*)&recvbuf[8]);
  read(accept_fd, recvbuf, s);



  c = 1;
  write(accept_fd, &c, 1);
  c = 0;
  write(accept_fd, &c, 1);
  s = 11;
  write(accept_fd, &s, 2);
  s = 0;
  write(accept_fd, &s, 2);
  s = (32 + 40) >> 2;
  write(accept_fd, &s, 2);


  i = 0;
  write(accept_fd, &i, 4);
  i = 0;
  write(accept_fd, &i, 4);
  i = 1;
  write(accept_fd, &i, 4);
  i = 0;
  write(accept_fd, &i, 4);
  s = 0;
  write(accept_fd, &s, 2);
  s = 0;
  write(accept_fd, &s, 2);
  c = 1;
  write(accept_fd, &c, 1);
  c = 0;
  write(accept_fd, &c, 1);
  c = 0;
  write(accept_fd, &c, 1);
  c = 0;
  write(accept_fd, &c, 1);
  c = 0;
  write(accept_fd, &c, 1);
  c = 0;
  write(accept_fd, &c, 1);
  c = 0;
  write(accept_fd, &c, 1);
  c = 0;
  write(accept_fd, &c, 1);
  i = 0;
  write(accept_fd, &i, 4);



  memset(sendbuf, '\0', 40);
  write(accept_fd, sendbuf, 40);







  read(accept_fd, recvbuf, 64);


  c = 1;
  write(accept_fd, &c, 1);
  c = 0;
  write(accept_fd, &c, 1);
  s = 2;
  write(accept_fd, &s, 2);
  i = -17;
  write(accept_fd, &i, 4);
  i = 0x41414141;



  write(accept_fd, &i, 4);
  write(accept_fd, &i, 4);
  write(accept_fd, &i, 4);
  write(accept_fd, &i, 4);
  write(accept_fd, &i, 4);
  write(accept_fd, &i, 4);





  c = 0;
  bigsend = (unsigned int)-17;
  bigsend <<= 2;
  while (bigsend > 0)
  {
    unsigned int to_send = bigsend;
    if (to_send > 32768)
    {
      to_send = 32768;
    }

    write(accept_fd, sendbuf, to_send);
    bigsend -= to_send;

    if (!c)
    {
      printf("to_go: %u\n", bigsend);
    }
    c++;
  }
  memset(sendbuf, 'A', 28);
  write(accept_fd, sendbuf, 28);

  memset(sendbuf, '\0', 32);

  write(accept_fd, sendbuf, 32);

  while(1);
}
