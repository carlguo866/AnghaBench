
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int uint8 ;
typedef int uint16 ;
typedef int * STREAM ;


 int ISO_PDU_DT ;
 int error (char*,int) ;
 int in_uint16_be (int *,int) ;
 int in_uint8 (int *,int) ;
 int in_uint8s (int *,int) ;
 int * tcp_recv (int) ;

__attribute__((used)) static STREAM
iso_recv_msg(uint8 * code)
{
 STREAM s;
 uint16 length;
 uint8 version;

 s = tcp_recv(4);
 if (s == ((void*)0))
  return ((void*)0);

 in_uint8(s, version);
 if (version != 3)
 {
  error("TPKT v%d\n", version);
  return ((void*)0);
 }

 in_uint8s(s, 1);
 in_uint16_be(s, length);

 s = tcp_recv(length - 4);
 if (s == ((void*)0))
  return ((void*)0);

 in_uint8s(s, 1);
 in_uint8(s, *code);

 if (*code == ISO_PDU_DT)
 {
  in_uint8s(s, 1);
  return s;
 }

 in_uint8s(s, 5);
 return s;
}
