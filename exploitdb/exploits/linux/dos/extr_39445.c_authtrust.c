
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef scalar_t__ u_long ;
struct savekey {scalar_t__ keyid; struct savekey* next; int flags; scalar_t__ keylen; scalar_t__ type; scalar_t__ lifetime; } ;
typedef scalar_t__ keyid_t ;


 size_t KEYHASH (scalar_t__) ;
 int KEY_TRUSTED ;
 scalar_t__ auth_moremem () ;
 struct savekey* authfreekeys ;
 scalar_t__ authnumfreekeys ;
 int authnumkeys ;
 scalar_t__ cache_flags ;
 scalar_t__ cache_keyid ;
 scalar_t__ current_time ;
 struct savekey** key_hash ;

void
authtrust(
 keyid_t keyno,
 u_long trust
 )
{
 struct savekey *sk;





 sk = key_hash[KEYHASH(keyno)];
 while (sk != 0) {
  if (keyno == sk->keyid)
      break;

  sk = sk->next;
 }
 if (sk == 0 && !trust)
  return;






 if (sk != 0) {
  if (cache_keyid == keyno) {
   cache_flags = 0;
   cache_keyid = 0;
  }






  if (trust > 0) {
   sk->flags |= KEY_TRUSTED;
   if (trust > 1)
    sk->lifetime = current_time + trust;
   else
    sk->lifetime = 0;
   return;
  }
  sk->flags &= ~KEY_TRUSTED; {
   struct savekey *skp;

   skp = key_hash[KEYHASH(keyno)];
   if (skp == sk) {
    key_hash[KEYHASH(keyno)] = sk->next;
   } else {
    while (skp->next != sk)
        skp = skp->next;
    skp->next = sk->next;
   }
   authnumkeys--;

   sk->next = authfreekeys;
   authfreekeys = sk;
   authnumfreekeys++;
  }
  return;
 }






 if (authnumfreekeys == 0)
     if (auth_moremem() == 0)
  return;

 sk = authfreekeys;
 authfreekeys = sk->next;
 authnumfreekeys--;
 sk->keyid = keyno;
 sk->type = 0;
 sk->keylen = 0;
 sk->flags = KEY_TRUSTED;
 sk->next = key_hash[KEYHASH(keyno)];
 key_hash[KEYHASH(keyno)] = sk;
 authnumkeys++;
 return;
}
