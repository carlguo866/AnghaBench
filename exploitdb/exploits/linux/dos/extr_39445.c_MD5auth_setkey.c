
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


typedef int u_char ;
struct TYPE_2__ {scalar_t__ MD5_key; } ;
struct savekey {scalar_t__ keyid; int type; int keylen; struct savekey* next; TYPE_1__ k; scalar_t__ lifetime; scalar_t__ flags; } ;
typedef scalar_t__ keyid_t ;


 size_t KEYHASH (scalar_t__) ;
 int auth_moremem () ;
 struct savekey* authfreekeys ;
 scalar_t__ authnumfreekeys ;
 int authnumkeys ;
 scalar_t__ cache_flags ;
 scalar_t__ cache_keyid ;
 int debug ;
 struct savekey** key_hash ;
 int memcpy (scalar_t__,int const*,int) ;
 void* min (int const,int) ;
 int printf (char*,...) ;
 int strncpy (char*,char const*,int) ;

void
MD5auth_setkey(
 keyid_t keyno,
 int keytype,
 const u_char *key,
 const int len
 )
{
 struct savekey *sk;





 sk = key_hash[KEYHASH(keyno)];
 while (sk != ((void*)0)) {
  if (keyno == sk->keyid) {
   sk->type = keytype;
   sk->keylen = min(len, sizeof(sk->k.MD5_key));

   memcpy(sk->k.MD5_key, key, sk->keylen);




   if (cache_keyid == keyno) {
    cache_flags = 0;
    cache_keyid = 0;
   }
   return;
  }
  sk = sk->next;
 }




 if (0 == authnumfreekeys && !auth_moremem())
  return;

 sk = authfreekeys;
 authfreekeys = sk->next;
 authnumfreekeys--;

 sk->keyid = keyno;
 sk->type = keytype;
 sk->flags = 0;
 sk->lifetime = 0;
 sk->keylen = min(len, sizeof(sk->k.MD5_key));

 memcpy(sk->k.MD5_key, key, sk->keylen);




 sk->next = key_hash[KEYHASH(keyno)];
 key_hash[KEYHASH(keyno)] = sk;
 authnumkeys++;
}
