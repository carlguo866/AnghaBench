
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_3__ TYPE_1__ ;


typedef int uint32 ;
typedef int uint16 ;
struct TYPE_3__ {int scancode; int modifiers; } ;
typedef TYPE_1__ key_translation ;


 int KBD_FLAG_NUMLOCK ;
 scalar_t__ MASK_HAS_BITS (int ,int ) ;
 int MapAltGrMask ;
 int MapLeftShiftMask ;
 int MapNumLockMask ;
 int MapRightShiftMask ;
 int MapShiftMask ;
 int RDP_INPUT_SYNCHRONIZE ;
 int RDP_KEYPRESS ;
 int RDP_KEYRELEASE ;
 int True ;
 int rdp_send_input (int ,int ,int ,int ,int ) ;
 int rdp_send_scancode (int ,int ,int const) ;
 int remote_modifier_state ;
 int update_modifier_state (int const,int ) ;

void
ensure_remote_modifiers(uint32 ev_time, key_translation tr)
{

 switch (tr.scancode)
 {
  case 134:
  case 129:
  case 135:
  case 130:
  case 136:
  case 131:
  case 133:
  case 128:
  case 132:
   return;
  default:
   break;
 }


 if (MASK_HAS_BITS(tr.modifiers, MapShiftMask)
     != MASK_HAS_BITS(remote_modifier_state, MapShiftMask))
 {

  if (MASK_HAS_BITS(tr.modifiers, MapLeftShiftMask))
  {

   rdp_send_scancode(ev_time, RDP_KEYPRESS, 134);
  }
  else if (MASK_HAS_BITS(tr.modifiers, MapRightShiftMask))
  {

   rdp_send_scancode(ev_time, RDP_KEYPRESS, 129);
  }
  else
  {

   if (MASK_HAS_BITS(remote_modifier_state, MapLeftShiftMask))

    rdp_send_scancode(ev_time, RDP_KEYRELEASE, 134);
   else

    rdp_send_scancode(ev_time, RDP_KEYRELEASE, 129);
  }
 }


 if (MASK_HAS_BITS(tr.modifiers, MapAltGrMask)
     != MASK_HAS_BITS(remote_modifier_state, MapAltGrMask))
 {

  if (MASK_HAS_BITS(tr.modifiers, MapAltGrMask))
  {

   rdp_send_scancode(ev_time, RDP_KEYPRESS, 131);
  }
  else
  {

   rdp_send_scancode(ev_time, RDP_KEYRELEASE, 131);
  }
 }


 if (MASK_HAS_BITS(tr.modifiers, MapNumLockMask)
     != MASK_HAS_BITS(remote_modifier_state, MapNumLockMask))
 {

  uint16 new_remote_state = 0;

  if (MASK_HAS_BITS(tr.modifiers, MapNumLockMask))
  {

   new_remote_state |= KBD_FLAG_NUMLOCK;
  }
  else
  {

  }

  rdp_send_input(0, RDP_INPUT_SYNCHRONIZE, 0, new_remote_state, 0);
  update_modifier_state(132, True);
 }
}
