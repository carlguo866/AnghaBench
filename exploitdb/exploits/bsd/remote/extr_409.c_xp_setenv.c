
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 unsigned char ENV_USERVAR ;
 int EXIT_FAILURE ;
 unsigned char IAC ;
 unsigned char NEW_ENV_VALUE ;
 unsigned char SB ;
 unsigned char SE ;
 unsigned char TELOPT_NEW_ENVIRON ;
 unsigned char TELQUAL_IS ;
 int exit (int ) ;
 int perror (char*) ;
 int send (int,unsigned char*,int,int ) ;

void
xp_setenv (int fd, unsigned char *var, unsigned char *val)
{
        int n = 0;
        unsigned char buf[2048];

        buf[n++] = IAC;
        buf[n++] = SB;
        buf[n++] = TELOPT_NEW_ENVIRON;
        buf[n++] = TELQUAL_IS;
        buf[n++] = ENV_USERVAR;


        while (*var) {
                if (*var == IAC)
                        buf[n++] = *var;
                buf[n++] = *var++;
        }
        buf[n++] = NEW_ENV_VALUE;
        while (*val) {
                if (*val == IAC)
                        buf[n++] = *val;
                buf[n++] = *val++;
        }
        buf[n++] = IAC;
        buf[n++] = SE;

        if (send (fd, buf, n, 0) != n) {
                perror ("xp_setenv:send");
                exit (EXIT_FAILURE);
        }
}
