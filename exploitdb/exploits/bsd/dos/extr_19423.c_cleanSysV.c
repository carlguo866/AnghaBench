
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;






struct shmid_ds {int shm_nattch; } ;
struct shm_info {int dummy; } ;


 int IPC_RMID ;
 int IPC_SET ;
 int SHM_INFO ;
 int SHM_STAT ;
 int perror (char*) ;
 int printf (char*,int,...) ;
 int shmctl (int,int ,struct shmid_ds*) ;

void cleanSysV()
{
    struct shmid_ds shmid;
    struct shm_info shm_info;
    int id;
    int maxid;
    int ret;
    int shid;
    maxid = shmctl (0, SHM_INFO, (struct shmid_ds *) &shm_info);
    printf("maxid %d\n", maxid);
    for (id = 0; id <= maxid; id++)
    {
 if((shid = shmctl (id, SHM_STAT, &shmid)) < 0)
     continue;

 if (shmctl (shid, IPC_RMID, ((void*)0)))
 {
     perror("shmctl");
 }
 printf("id %d has %d attachments\n", shid, shmid.shm_nattch);
 shmid.shm_nattch = 0;
 shmctl(shid, IPC_SET, &shmid);
 if(shmctl(shid, SHM_STAT, &shmid) < 0)
 {
     printf("id %d deleted sucessfully\n", shid);
 }
 else if(shmid.shm_nattch == 0)
 {
     printf("Still able to stat id %d, but has no attachments\n", shid);
 }
 else
 {
     printf("Error, failed to remove id %d!\n", shid);
 }

    }
}
