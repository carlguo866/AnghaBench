
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;




typedef struct TYPE_4__ TYPE_2__ ;
typedef struct TYPE_3__ TYPE_1__ ;


typedef int ULONG64 ;
struct TYPE_4__ {int UniqueProcessIdOffset; } ;
struct TYPE_3__ {int Flink; } ;
typedef TYPE_1__ LIST_ENTRY ;
typedef int BYTE ;


 int GetCurrentProcessId () ;
 int PsInitialSystemProcess () ;
 int ReadFromAddress (int,int *,int) ;
 scalar_t__ TRUE ;
 TYPE_2__ gConfig ;

ULONG64 PsGetCurrentProcess()
{
 ULONG64 pEPROCESS = PsInitialSystemProcess();


 LIST_ENTRY ActiveProcessLinks;
 ReadFromAddress(pEPROCESS + gConfig.UniqueProcessIdOffset + sizeof(ULONG64), (BYTE *)&ActiveProcessLinks, sizeof(LIST_ENTRY));

 ULONG64 res = 0;

 while (TRUE) {
  ULONG64 UniqueProcessId = 0;


  pEPROCESS = (ULONG64)(ActiveProcessLinks.Flink) - gConfig.UniqueProcessIdOffset - sizeof(ULONG64);

  ReadFromAddress(pEPROCESS + gConfig.UniqueProcessIdOffset, (BYTE *)&UniqueProcessId, sizeof(ULONG64));

  if (GetCurrentProcessId() == UniqueProcessId) {
   res = pEPROCESS;
   break;
  }

  ReadFromAddress(pEPROCESS + gConfig.UniqueProcessIdOffset + sizeof(ULONG64), (BYTE *)&ActiveProcessLinks, sizeof(LIST_ENTRY));

  if (pEPROCESS == (ULONG64)(ActiveProcessLinks.Flink) - gConfig.UniqueProcessIdOffset - sizeof(ULONG64))
   break;
 }
 return res;
}
